# baseURI: https://data.elsevier.com/lifescience/schema/rdbs
# imports: http://datashapes.org/dash
# imports: http://topbraid.org/tosh

@prefix dash: <http://datashapes.org/dash#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdbs: <https://data.elsevier.com/lifescience/schema/rdbs/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix swa: <http://topbraid.org/swa#> .
@prefix tosh: <http://topbraid.org/tosh#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<https://data.elsevier.com/lifescience/schema/rdbs>
  a owl:Ontology ;
  rdfs:comment "Ontology for Relational Database System. Reworked from RDBS-OWL" ;
  owl:imports <http://datashapes.org/dash> ;
  owl:imports <http://topbraid.org/tosh> ;
  sh:declare [
      sh:namespace "http://www.w3.org/2000/01/rdf-schema#"^^xsd:anyURI ;
      sh:prefix "rdfs" ;
    ] ;
  sh:declare [
      sh:namespace "http://www.w3.org/2002/07/owl#"^^xsd:anyURI ;
      sh:prefix "owl" ;
    ] ;
  sh:declare [
      sh:namespace "https://data.elsevier.com/lifescience/schema/rdbs/"^^xsd:anyURI ;
      sh:prefix "rdbs" ;
    ] ;
.
rdbs:Aggregate
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Aggregate operation for Topologies."@en ;
  rdfs:label "Aggregate"@en ;
  rdfs:subClassOf rdbs:TopologyOperation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAlias ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:name "has alias" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasCollect ;
      sh:class rdbs:Collect ;
      sh:minCount 1 ;
      sh:name "has collect" ;
      sh:node rdbs:Collect ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasGroupBy ;
      sh:class rdbs:GroupBy ;
      sh:minCount 1 ;
      sh:name "has group by" ;
      sh:node rdbs:GroupBy ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:Alignment
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "Alignment" ;
  rdfs:subClassOf owl:Thing ;
.
rdbs:AnnotationCBE
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a CBE Table containing the Annotations of the Property Graph as Concise Bounded Entities."@en ;
  rdfs:label "AnnotationCBE"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasAggregate ?aggregate .
# The description of the aggregate element of the topology
   ?aggregate a rdbs:Aggregate ;
			rdbs:hasGroupBy ?group_by ;
			rdbs:hasCollect ?collect_id ;
			rdbs:hasCollect ?collect_source_id ;
			rdbs:hasCollect ?collect_target_id ;
			rdbs:hasCollect ?collect_other .
# The description of the group by element of the topology
	?group_by a rdbs:GroupBy ;
			rdbs:hasOrder 0 ;
			rdfs:label ?id_column_label .
# The description of the collect annotation id element of the topology
	?collect_id a rdbs:Collect ;
			rdbs:hasValue ?id_column_label ;
			rdbs:hasAlias ?id_column_alias .
# The description of the collect annotation id element of the topology
	?collect_source_id a rdbs:Collect ;
			rdbs:hasValue ?source_id_column_label ;
			rdbs:hasClassifier ?source_column_label ;
			rdbs:hasAlias ?source_id_column_alias .
# The description of the collect annotation id element of the topology
	?collect_target_id a rdbs:Collect ;
			rdbs:hasValue ?target_id_column_label ;
			rdbs:hasClassifier ?target_column_label ;
			rdbs:hasAlias ?target_id_column_alias .
# The description of the other column element of the topology
	?collect_other a rdbs:Collect ;
			rdbs:hasValue ?other_column_label .
# The description of the table or topic resulting from the aggregate
	?table a rdbs:AnnotationCBETable ;
			rdbs:createdWith ?topology ;
			rdfs:label ?table_label ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_id_column ;
			rdbs:hasColumn ?copied_source_id_by_source_type_column ;
			rdbs:hasColumn ?copied_target_id_by_target_type_column ;
			rdbs:hasColumn ?copied_other_column .
# Set up copies of the id columns
	?copied_id_column rdbs:belongsToTable ?table ;
		rdfs:label ?id_column_alias ;
		?id_predicate ?id_object .
# Set up copies of the source columns
	?copied_source_id_by_source_type_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:SourceVerticeIdPerVerticeTypeColumn ;
		a rdbs:ObjectPropertyColumn ;
		a rdbs:ForeignKeyColumn ;
		rdbs:refersToPrimaryKey ?vertice_primary_key_column ;
		rdfs:label ?source_id_column_alias ;
		rdbs:hasObjectSemanticName ?source_type_label ;
		rdbs:hasSemanticName ?source_id_column_alias ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up copies of the target columns
	?copied_target_id_by_target_type_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:TargetVerticeIdPerVerticeTypeColumn ;
		a rdbs:ObjectPropertyColumn ;
		a rdbs:ForeignKeyColumn ;
		rdbs:refersToPrimaryKey ?vertice_primary_key_column ;
		rdfs:label ?target_id_column_alias ;
		rdbs:hasObjectSemanticName ?target_type_label ;
		rdbs:hasSemanticName ?target_id_column_alias ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up copies of the other columns
	?copied_other_column a rdbs:DataPropertyColumn ;
		rdbs:belongsToTable ?table ;
		rdbs:hasSemanticName ?other_column_label ;
		?other_predicate ?other_object .
}
WHERE {
# Get Vertice table
	?vertice_table a rdbs:VerticeTable ;
		rdbs:hasColumn ?vertice_primary_key_column .
	?vertice_primary_key_column a rdbs:PrimaryKeyColumn .
# Get origin table
	?this a rdbs:AnnotationWithTypeTable ;
		rdfs:label ?origin .
# Get origin table columns
	?this rdbs:hasColumn ?id_column .
	?id_column a rdbs:PrimaryKeyColumn ;
		rdfs:label ?id_column_label ;
		?id_predicate ?id_object .
	FILTER ( ?id_predicate != rdfs:label && ?id_predicate != rdbs:belongsToTable) .
	?this rdbs:hasColumn ?source_column .
	?source_column a rdbs:AnnotationSourceVerticeColumn ;
		rdfs:label ?source_column_label .
	?this rdbs:hasColumn ?source_id_column .
	?source_id_column a rdbs:AnnotationSourceVerticeIdColumn ;
		rdfs:label ?source_id_column_label .
	?this rdbs:hasColumn ?target_column .
	?target_column a rdbs:AnnotationTargetVerticeColumn ;
		rdfs:label ?target_column_label .
	?this rdbs:hasColumn ?target_id_column .
	?target_id_column a rdbs:AnnotationTargetVerticeIdColumn ;
		rdfs:label ?target_id_column_label .
	?this rdbs:hasColumn ?other_column .
# Filter other columns
	FILTER (?other_column != ?id_column  
		&& ?other_column !=?source_column 
		&& ?other_column !=?source_id_column 
		&& ?other_column !=?target_column 
		&& ?other_column !=?target_id_column
) .
	FILTER NOT EXISTS { ?other_column a rdbs:ForeignKeyColumn } .
	?other_column rdfs:label ?other_column_label ;
		?other_predicate ?other_object .
	FILTER ( ?other_predicate != rdbs:belongsToTable) .
# Declare Aliases
	BIND ( \"annotationID\" AS ?id_column_alias ) .
	BIND ( \"hasAnnotatedSource\" AS ?source_id_column_alias ) .
	BIND ( \"hasAnnotatedTarget\" AS ?target_id_column_alias ) .
# Create output
	BIND ( \"Annotations-{Ontologys}\" AS ?output) .
# Create Topology
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\") AS ?topology ) .
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\", \"\", \"\" ) AS ?aggregate ) .
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\", \"\", \"\", ?id_column_label ) AS ?group_by) .
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\", \"\", \"\", ?id_column_label, ?id_column_label,  ?id_column_alias) AS ?collect_id ) .
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\", \"\", \"\", ?id_column_label, ?source_id_column_label,  ?source_id_column_alias) AS ?collect_source_id ) .
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\", \"\", \"\", ?id_column_label, ?target_id_column_label,  ?target_id_column_alias) AS ?collect_target_id ) .
	BIND ( rdbs:mintTopologyAggregate(\"annotation-CBE\", \"\", \"\", ?id_column_label, ?other_column_label) AS ?collect_other ) .
# Get all the Ontology Types
	?ontology a rdbs:Ontology ;
		rdfs:label ?ontology_label .
# Create table label
	BIND ( rdbs:mintGraphCBEDescriptionTable( ?ontology_label, rdbs:AnnotationCBETable ) AS ?table_label ) .
	BIND ( rdbs:createIRIFromString( ?table_label, \"base\" ) AS ?table ) .
	FILTER NOT EXISTS { ?table a rdbs:AnnotationCBETable }
# Create copy of static columns
	BIND (  rdbs:mintCopyOfColumn(?id_column, ?table_label, ?id_column_alias) AS ?copied_id_column ) .
	BIND (  rdbs:mintCopyOfColumn(?other_column, ?table_label) AS ?copied_other_column ) .
# Get the related associations
	?annotation_type_association a rdbs:AnnotationTypeAssociation ;
		rdbs:hasAnnotationSourceType ?source_type ;
		rdbs:hasAnnotationTargetType ?target_type ;
		rdbs:hasOntology ?ontology .
	?source_type rdfs:label ?source_type_label .
	?target_type rdfs:label ?target_type_label .
# Create Classified Columns
	BIND ( rdbs:mintClassifiedColumn(?table_label, ?source_id_column_alias, ?source_type) AS ?copied_source_id_by_source_type_column ) .
	BIND ( rdbs:mintClassifiedColumn(?table_label, ?target_id_column_alias, ?target_type) AS ?copied_target_id_by_target_type_column ) .
	BIND ( rdbs:mintClassifiedColumnLabel(?source_id_column_alias, ?source_type) AS ?copied_source_id_by_source_type_column_label ) .
	BIND ( rdbs:mintClassifiedColumnLabel(?target_id_column_alias, ?target_type) AS ?copied_target_id_by_target_type_column_label ) .
}""" ;
  sh:deactivated false ;
  sh:order "10"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:AnnotationCBETable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Table containging the Annotations of the Property Graph as Concise Bounded Entities."@en ;
  rdfs:label "Annotation CBE Table "@en ;
  rdfs:subClassOf rdbs:GraphCBE ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has ontology type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:OntologyColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has primary key column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:PrimaryKeyColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has relationship type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationRelationshipColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has source vertice id per vertice type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:SourceVerticeIdPerVerticeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has target vertice id per vertice type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:TargetVerticeIdPerVerticeTypeColumn ;
        ] ;
    ] ;
.
rdbs:AnnotationRelationIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of relations between a source Vertice and a target Vertice of an Annotation."@en ;
  rdfs:label "Annotation Relation Vertice Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:AnnotationRelationshipColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the type of relationship between a source Vertice and a target Vertice in an Ontology Annotation."@en ;
  rdfs:label "Annotation Relationship Column "@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:AnnotationSourceVerticeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the type of Vertice having a relation with another target Vertice in an Ontology Annotation."@en ;
  rdfs:label "Annotation Source Vertice Column "@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:AnnotationSourceVerticeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of the source Vertice of an Annotation."@en ;
  rdfs:label "Annotation Source Vertice Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:AnnotationTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Table containing Annotations i.e information between a source Vertice and a target Vertice and their relation."@en ;
  rdfs:label "Annotation Table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation relation Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationRelationIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation source vertice Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationSourceVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation target vertice Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationTargetVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has ontology Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:OntologyIdColumn ;
        ] ;
    ] ;
.
rdbs:AnnotationTargetVerticeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the type of Vertice having a relation with another source Vertice in an Ontology Annotation."@en ;
  rdfs:label "Annotation Target Vertice Column "@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:AnnotationTargetVerticeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of the target Vertice of an Annotation."@en ;
  rdfs:label "Annotation Target Vertice Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:AnnotationType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Type of Annotation in the Schema of a Graph"@en ;
  rdfs:label "Annotation Type"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:AnnotationTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "An Annotation Type Schema Association associates exactly one Source of Type Vertice, and exactly one Target of Type Vertice through a relation of Type Annotation, for an Ontology"@en ;
  rdfs:label "Annotation Type Association"@en ;
  rdfs:subClassOf rdbs:GraphSchemaTypeAssociation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAnnotationSourceType ;
      sh:class rdbs:VerticeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Annotation Source Type"@en ;
      sh:node rdbs:VerticeType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAnnotationTargetType ;
      sh:class rdbs:VerticeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Annotation Target Type"@en ;
      sh:node rdbs:VerticeType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAnnotationType ;
      sh:class rdbs:AnnotationType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Annotation Type"@en ;
      sh:node rdbs:AnnotationType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasOntology ;
      sh:class rdbs:Ontology ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Ontology"@en ;
      sh:node rdbs:Ontology ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:AnnotationWithType
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the annotations relating two types of Vertices in an ontology."@en ;
  rdfs:label "AnnotationWithType"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?source_join ;
			rdbs:hasJoin ?target_join ;
			rdbs:hasJoin ?relationship_join ;
			rdbs:hasJoin ?ontology_join .
# The description of the source join element of the topology
    ?source_join a rdbs:Join ;
			rdbs:hasTopic ?vertice_topic ;
			rdbs:hasForeignKey ?vertice_source_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_source .
# The description of the target join element of the topology
    ?target_join a rdbs:Join ;
			rdbs:hasTopic ?vertice_topic ;
			rdbs:hasForeignKey ?vertice_target_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_target .
# The description of the relationship join element of the topology
    ?relationship_join a rdbs:Join ;
			rdbs:hasTopic ?dictionary_topic ;
			rdbs:hasForeignKey ?dictionary_relationship_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_relationship .
# The description of the ontology join element of the topology
    ?ontology_join a rdbs:Join ;
			rdbs:hasTopic ?dictionary_topic ;
			rdbs:hasForeignKey ?dictionary_ontology_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_ontology .
# The description of the select source element of the join
	?select_source a rdbs:Select ;
		rdbs:hasValue ?vertice_column_label ;
		rdbs:hasAlias ?source_column_alias .
# The description of the select target element of the join
	?select_target a rdbs:Select ;
		rdbs:hasValue ?vertice_column_label ;
		rdbs:hasAlias ?target_column_alias .
# The description of the select relationship element of the join
	?select_relationship a rdbs:Select ;
		rdbs:hasValue ?dictionary_column_label ;
		rdbs:hasAlias ?relationship_column_alias .
# The description of the select ontology element of the join
	?select_ontology a rdbs:Select ;
		rdbs:hasValue ?dictionary_column_label ;
		rdbs:hasAlias ?ontology_column_alias .
# The description of the table or topic resulting from the join
	?table a rdbs:AnnotationWithTypeTable ;
			rdbs:createdWith ?topology ;
			rdfs:label ?output ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_origin_column ;
			rdbs:hasColumn ?copied_source_column ;
			rdbs:hasColumn ?copied_target_column ;
			rdbs:hasColumn ?copied_relationship_column ;
			rdbs:hasColumn ?copied_ontology_column .
# Set up copies of the origin columns
	?copied_origin_column rdbs:belongsToTable ?table ;
		?origin_predicate ?origin_object .
# Set up copies of the source container columns
	?copied_source_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:AnnotationSourceVerticeColumn ;
		rdfs:label ?source_column_alias ;
		?vertice_predicate ?vertice_object .
# Set up copies of the target container columns
	?copied_target_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:AnnotationTargetVerticeColumn ;
		rdfs:label ?target_column_alias ;
		?vertice_predicate ?vertice_object .
# Set up copies of the relationship container columns
	?copied_relationship_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:AnnotationRelationshipColumn ;
		rdfs:label ?relationship_column_alias ;
		?dictionary_predicate ?dictionary_object .
# Set up copies of the ontology container columns
	?copied_ontology_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:OntologyColumn ;
		rdfs:label ?ontology_column_alias ;
		?dictionary_predicate ?dictionary_object .
}
WHERE {
# Pattern to match in order to create join topology
    ?this a rdbs:AnnotationTable ;
		rdbs:hasColumn ?vertice_source_key ;
		rdbs:hasColumn ?vertice_target_key ;
		rdbs:hasColumn ?dictionary_relationship_key ;
		rdbs:hasColumn ?dictionary_ontology_key .
# Create the new description table and its name as the output
	BIND( rdbs:mintGraphTemporaryDescriptionTable( ?this, rdbs:AnnotationWithTypeTable ) AS ?output ) .
	BIND( rdbs:createIRIFromString( ?output, \"base\" ) AS ?table ) .
# Filter topologies already processed
	FILTER NOT EXISTS { ?table a rdbs:AnnotationWithTypeTable }
# Identify target foreign column
	?vertice_source_key	a rdbs:AnnotationSourceVerticeIdColumn .
	?vertice_target_key	a rdbs:AnnotationTargetVerticeIdColumn .
	?dictionary_relationship_key a rdbs:AnnotationRelationIdColumn .
	?dictionary_ontology_key a rdbs:OntologyIdColumn .
	?vertice_table a rdbs:VerticeWithTypeTable ;
		rdbs:hasColumn ?vertice_column .
	?dictionary_table a rdbs:DictionaryTable ;
		rdbs:hasColumn ?dictionary_column .
	?vertice_column a rdbs:ObjectTypeColumn .
	?dictionary_column a rdbs:DictionaryValueColumn .
# Find the different columns of the origin topic 
	?this rdfs:label ?origin ;
		rdbs:hasColumn ?origin_column .
# Get the label of the foreign keys
	?vertice_source_key	rdfs:label ?vertice_source_key_label .
	?vertice_target_key	rdfs:label ?vertice_target_key_label .
	?dictionary_relationship_key rdfs:label ?dictionary_relationship_key_label .
	?dictionary_ontology_key rdfs:label ?dictionary_ontology_key_label .
# Get the labels of the foreign tables
	?vertice_table rdfs:label ?vertice_topic .
	?dictionary_table rdfs:label ?dictionary_topic .
# Get the labels of the foreign columns
	?vertice_column rdfs:label ?vertice_column_label .
	?dictionary_column rdfs:label ?dictionary_column_label .
	BIND ( \"nodeType\" AS ?source_column_alias )
	BIND ( \"groupNodeType\" AS ?target_column_alias )
	BIND ( \"relationshipType\" AS ?relationship_column_alias )
	BIND ( \"Ontology\" AS ?ontology_column_alias )
# Get the predicates and objects of the copied columns
	?origin_column ?origin_predicate ?origin_object .
	?vertice_column ?vertice_predicate ?vertice_object .
	?dictionary_column ?dictionary_predicate ?dictionary_object .
# Skip the predicates referencing the belonging of the columns
	FILTER (?origin_predicate != rdbs:belongsToTable )
	FILTER (?vertice_predicate != rdbs:belongsToTable )
	FILTER (?vertice_predicate != rdfs:label )
	FILTER (?vertice_predicate != rdf:type )
	FILTER (?dictionary_predicate != rdbs:belongsToTable )
	FILTER (?dictionary_predicate != rdfs:label )
	FILTER (?dictionary_predicate != rdf:type )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyJoin( ?output ) AS ?topology ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_source_key_label ) ) AS ?source_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_target_key_label ) ) AS ?target_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?dictionary_topic, \"-on-\", ?dictionary_relationship_key_label ) ) AS ?relationship_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?dictionary_topic, \"-on-\", ?dictionary_ontology_key_label ) ) AS ?ontology_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_source_key_label ), ?vertice_column_label, ?source_column_alias ) AS ?select_source ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_target_key_label ), ?vertice_column_label, ?target_column_alias ) AS ?select_target ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?dictionary_topic, \"-on-\", ?dictionary_relationship_key_label ), ?dictionary_column_label, ?relationship_column_alias ) AS ?select_relationship ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?dictionary_topic, \"-on-\", ?dictionary_ontology_key_label ), ?dictionary_column_label, ?ontology_column_alias ) AS ?select_ontology ) .
# Create the different columns that are copies of the origin columns
	BIND (rdbs:mintCopyOfColumn(?origin_column, ?output) AS ?copied_origin_column) .
# Create the different columns that are copies of the foreign columns
	BIND (rdbs:mintCopyOfColumn(?vertice_column, ?output, ?source_column_alias) AS ?copied_source_column) .
	BIND (rdbs:mintCopyOfColumn(?vertice_column, ?output, ?target_column_alias) AS ?copied_target_column) .
	BIND (rdbs:mintCopyOfColumn(?dictionary_column, ?output, ?relationship_column_alias) AS ?copied_relationship_column) .
	BIND (rdbs:mintCopyOfColumn(?dictionary_column, ?output, ?ontology_column_alias) AS ?copied_ontology_column) .
}""" ;
  sh:deactivated false ;
  sh:order "9"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:AnnotationWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Table containing annotations about relations between concepts of the Property Graph, in the shape of a source (Vertice) having a relation (RelationshipType) with a target (Vertice) in an Ontology (OntologyType)."@en ;
  rdfs:label "Annotation With Type Table "@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation relation Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationRelationIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation relationship column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationRelationshipColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation source vertice Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationSourceVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation source vertice column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationSourceVerticeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation target vertice Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationTargetVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has annotation target vertice column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AnnotationTargetVerticeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has ontology Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:OntologyIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has ontology column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:OntologyColumn ;
        ] ;
    ] ;
.
rdbs:Association
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "Association" ;
  rdfs:subClassOf owl:Thing ;
.
rdbs:AttributeDataType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "DataType of AttributeType in the Schema of a Graph"@en ;
  rdfs:label "Attribute Data Type"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:AttributeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of an Attribute of the Property Graph."@en ;
  rdfs:label "Attribute Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:AttributeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that identify attributes in a Graph and the Graph Object (i.e. Vertice or Edges) to which the attribute belong"@en ;
  rdfs:label "AttributeTable"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute type Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
.
rdbs:AttributeType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Type of Attribute in the Schema of a Graph"@en ;
  rdfs:label "Attribute Type"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:AttributeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the name of the Attribute Types of the Property Graph."@en ;
  rdfs:label "Attribute Type Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:AttributeTypeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of an Attribute Type of the Property Graph."@en ;
  rdfs:label "Attribute Type Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:AttributeTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that contains the Type of the Attributes of the Property Graph."@en ;
  rdfs:label "Attribute Type Table"@en ;
  rdfs:subClassOf rdbs:TypeTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute type Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute type column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeTypeColumn ;
        ] ;
    ] ;
.
rdbs:AttributeWithType
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the attributes of a property graph and their associated classes."@en ;
  rdfs:label "AttributeWithType"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?join .
# The description of the join element of the topology
    ?join a rdbs:Join ;
			rdbs:hasTopic ?foreign_topic ;
			rdbs:hasForeignKey ?fk  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select .
# The description of the select element of the join
	?select a rdbs:Select ;
		rdbs:hasValue ?selected_property_label .
# The description of the table or topic resulting from the join
	?table a ?output_type ;
			rdbs:createdWith ?topology ;
			rdfs:label ?output ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_origin_column ;
			rdbs:hasColumn ?copied_foreign_column .
# Set up copies of the origin columns
	?copied_origin_column rdbs:belongsToTable ?table ;
		?origin_predicate ?origin_object .
# Set up copies of the foreign columns
	?copied_foreign_column rdbs:belongsToTable ?table ;
		?foreign_predicate ?foreign_object .
}
WHERE {
# Define the valid object types to match
	VALUES (?origin_type ?output_type) {
		( rdbs:EdgeAttributeTable rdbs:EdgeAttributeWithTypeTable )
		( rdbs:VerticeAttributeTable rdbs:VerticeAttributeWithTypeTable )
	}
# Pattern to match in order to create join topology
    ?this a ?origin_type ;
		rdbs:hasColumn ?foreign_key_column .
# Create the new description table and its name as the output
	BIND(rdbs:mintGraphTemporaryDescriptionTable(?this, rdbs:AttributeWithTypeTable) AS ?output) .
	BIND(rdbs:createIRIFromString(?output, \"base\") AS ?table) .
# Filter topologies already processed
	FILTER NOT EXISTS { ?table a ?output_type }
# Identify target foreign column
	?foreign_key_column	a rdbs:AttributeTypeIdColumn .
	?foreign_table a rdbs:AttributeTypeTable ;
		rdbs:hasColumn ?selected_property .
	?selected_property a rdbs:AttributeTypeColumn .
# Find the different columns of the origin topic 
	?this rdfs:label ?origin ;
		rdbs:hasColumn ?origin_column ;
		rdbs:hasColumn ?object_column .
# Get the different objects for the predicates of our constructed nodes
	?foreign_key_column rdfs:label ?fk .
	?foreign_table rdfs:label ?foreign_topic .
	?selected_property rdfs:label ?selected_property_label .
# Get the predicates and objects of the copied columns
	?origin_column ?origin_predicate ?origin_object .
	?selected_property ?foreign_predicate ?foreign_object .
# Skip the predicates referencing the belonging of the columns
	FILTER (?origin_predicate != rdbs:belongsToTable )
	FILTER (?foreign_predicate != rdbs:belongsToTable )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyJoin(?output) AS ?topology) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic) AS ?join) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic, ?selected_property_label) AS ?select) .
# Create the different columns that are copies of the origin columns
	BIND (rdbs:mintCopyOfColumn(?origin_column, ?output) AS ?copied_origin_column) .
# Create the different columns that are copies of the foreign columns
	BIND (rdbs:mintCopyOfColumn(?selected_property, ?output) AS ?copied_foreign_column) .
}""" ;
  sh:deactivated false ;
  sh:order "2"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:AttributeWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table containing the Attributes of the Property Graph Objects and their associated Attribute Types."@en ;
  rdfs:label "Attribute With Type Table"@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute type Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute type column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
.
rdbs:BOOLEAN
  a rdbs:DataType ;
  rdfs:label "BOOLEAN" ;
.
rdbs:CLOB
  a rdbs:DataType ;
  rdfs:label "CLOB" ;
.
rdbs:ClassifyingColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:subClassOf rdbs:Column ;
.
rdbs:Collect
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Collect operation for Topologies."@en ;
  rdfs:label "Collect"@en ;
  rdfs:subClassOf rdbs:TopologyOperation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAlias ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:name "has alias {@en}" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasClassifier ;
      sh:datatype xsd:string ;
      sh:name "has classifier" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasValue ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
    ] ;
.
rdbs:Column
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column is the field of a table line type."@en ;
  rdfs:label "Column"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdfs:label ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:belongsToTable ;
      sh:class rdbs:Table ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "belongs to table" ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasDataType ;
      sh:class rdbs:DataType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "defined by data type" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:isNullable ;
      sh:datatype xsd:boolean ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "is nullable" ;
    ] ;
.
rdbs:ContaineeEdgeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Types of Contained Edges."@en ;
  rdfs:label "Containee Edge Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:ContaineeEdgeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of the Contained Edge of a Membership."@en ;
  rdfs:label "Containee Edge Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ContaineeEdgeIdPerEdgeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "The Contained Edge ids classified by Edge Types."@en ;
  rdfs:label "Container Edge Id Per Edge Type Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ContaineeEdgeType
  a owl:ObjectProperty ;
  rdfs:comment "The type of Edge contained by a Type of Vertice in a Property Graph Membership."@en ;
  rdfs:label "Containee Edge Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:ContaineeVerticeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Types of Contained Vertices."@en ;
  rdfs:label "Containee Vertice Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:ContaineeVerticeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of the Contained Vertice of a Membership."@en ;
  rdfs:label "Containee Vertice Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ContaineeVerticeIdPerVerticeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "The Contained Vertice ids classified by Vertice Types."@en ;
  rdfs:label "Container Vertice Id Per Vertice Type Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ContaineeVerticeType
  a owl:ObjectProperty ;
  rdfs:comment "The type of Vertice contained by another Type of Vertice in a Property Graph Membership."@en ;
  rdfs:label "Containee Vertice Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:ContainerVerticeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Types of Container Vertices."@en ;
  rdfs:label "Container Vertice Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:ContainerVerticeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of the Containing Vertice of a Membership."@en ;
  rdfs:label "Container Vertice Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ContainerVerticeIdPerVerticeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "The Containing Vertice ids classified by Vertice Types."@en ;
  rdfs:label "Container Vertice Id Per Vertice Type Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ContainerVerticeType
  a owl:ObjectProperty ;
  rdfs:comment "The type of Vertice containing a Type of Edge or another Type of Vertice in a Property Graph Membership."@en ;
  rdfs:label "Container Vertice Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:CreateAlignmentForGraphDataTypeProperties
  a sh:SPARQLRule ;
  rdfs:label "Map a Data Type Property to its Column." ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
 ?alignment a rdbs:Alignment ;
	rdbs:topic ?table_label ;
	rdbs:field ?column_label ;
	rdbs:datatype ?data_type ;	
	rdbs:uri ?property ;
# DEPRECATED
	rdbs:atype \"DTP\" .
}
WHERE {
	?this a rdbs:GraphCBE ;
		rdfs:label ?table_label ;
		rdbs:hasColumn ?column .
	?column rdfs:label ?column_label ;
		rdbs:hasDataType ?data_type .
	?property a owl:DatatypeProperty ;
		rdbs:mapsToColumn ?column .
	BIND (rdbs:mintGraphAlignment(?this, ?column) AS ?alignment)
}""" ;
  sh:deactivated true ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:CreateAlignmentForGraphObjectProperties
  a sh:SPARQLRule ;
  rdfs:label "Map an Object Property to its Column." ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
 ?alignment a rdbs:Alignment ;
	rdbs:topic ?table_label ;
	rdbs:field ?column_label ;
	rdbs:targetClass ?target_class ;
	rdbs:uri ?property ;
# DEPRECATED
	rdbs:atype \"OTP\" .
}
WHERE {
	?this a rdbs:GraphCBE ;
		rdfs:label ?table_label ;
		rdbs:hasColumn ?column .
	?column rdfs:label ?column_label .
	?property a owl:ObjectProperty ;
		rdfs:range ?target_class ;
		rdbs:mapsToColumn ?column .
	BIND (rdbs:mintGraphAlignment(?this, ?column) AS ?alignment)
}""" ;
  sh:deactivated true ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:CreateAlignmentForManyToManyWithoutClassifier
  a sh:SPARQLRule ;
  rdfs:label "Map an Object property from a many to many relationship." ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT{
  ?alignment a rdbs:Alignment ;
      rdbs:atype \"OTP\" ;
      rdbs:topic ?origin ;
      rdbs:field ?ascollect ;
      rdbs:targetClass ?range ;
      rdbs:uri ?puri ;
      rdbs:generatedBy rdbs:CreateAlignmentForManyToManyWithoutClassifier ;
      .
}
WHERE {
   $this      rdbs:topic ?origin ;
      rdbs:relation ?relation ;
      rdbs:groupby ?groupby ;
      rdbs:collect [
          rdbs:value ?collect ;
          rdbs:as ?ascollect ;
          rdbs:extendTable ?domaint ;
          rdbs:withValuesFromTable ?ranget ;
          rdbs:property ?puri ;
      ].

   FILTER NOT EXISTS { $this rdbs:classifier []}
   BIND( BNODE() AS ?alignment)
}
""" ;
  sh:deactivated false ;
  sh:order "2"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:CreateAlignmentForTableColumns
  a sh:SPARQLRule ;
  rdfs:label "Map an datatype property from an entity table." ;
  sh:condition rdbs:EntityTable ;
  sh:condition rdbs:TaxonomyTable ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT{
  ?alignment a rdbs:Alignment ;
      rdbs:atype \"DTP\" ;
      rdbs:topic ?topic ;
      rdbs:field ?field ;
      rdbs:datatype ?dt ;
      rdbs:uri ?puri ;
      rdbs:generatedBy rdbs:CreateAlignmentForTableColumns ;
      .
}
WHERE {
  $this rdbs:hasColumn ?column;
        rdfs:label ?topic.
  ?column a rdbs:Column ;
      rdbs:hasDataType ?dt ;
      rdfs:label ?field.
  ?puri rdbs:mapsToColumn ?column .
  BIND( BNODE() AS ?alignment)
}
""" ;
  sh:deactivated false ;
  sh:order "2"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:CreateAlignmentForTableFKColumns
  a sh:SPARQLRule ;
  rdfs:label "Map an object property from an entity table." ;
  sh:condition rdbs:EntityTable ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT{
  ?alignment a rdbs:Alignment ;
      rdbs:topic ?topic ;
      rdbs:atype \"OTP\" ;
      rdbs:field ?field ;
      rdbs:targetClass ?target ;
      rdbs:uri ?puri ;
      rdbs:generatedBy rdbs:CreateAlignmentForTableFKColumns ;
      .
}
WHERE {
  $this      rdbs:hasColumn ?column;
        rdfs:label ?topic.
  ?column a rdbs:ForeignKeyColumn;
      rdfs:label ?field.
  ?puri rdbs:mapsToColumn ?column ;
        rdfs:range ?target .
  BIND( BNODE() AS ?alignment)
}
""" ;
  sh:deactivated false ;
  sh:order "2"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:CreateAlignmentForTableInverseFKColumns
  a sh:SPARQLRule ;
  rdfs:label "Map an object property from a foreign key to an entity table." ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT{
  ?alignment a rdbs:Alignment ;
      rdbs:atype \"OTP\" ;
      rdbs:topic ?topic ;
      rdbs:field ?field ;
      rdbs:targetClass ?target ;
      rdbs:uri ?puri ;
      rdbs:generatedBy rdbs:CreateAlignmentForTableInverseFKColumns ;
      .
}
WHERE {

  $this        rdbs:topic ?topic ;
        rdbs:relation ?targetTable ;
        rdbs:collect [
          rdbs:as ?field ;
          rdbs:extendTable ?entity
        ].
   ?puri rdfs:range ?target ;
        rdfs:domain ?origin;
        .
  ?origin rdbs:fromTable ?entity.
  ?target rdbs:fromTable [rdfs:label ?targetTable].

  BIND( BNODE() AS ?alignment)
}
""" ;
  sh:deactivated false ;
  sh:order "2"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:CreateOntoDocument
  a sh:SPARQLRule ;
  rdfs:label "Create Target Ontology Document i.e. URI declaration @en" ;
  sh:construct """CONSTRUCT {
    ?schema a owl:Ontology .
    ?schema rdfs:label ?schemaLabel .
}
WHERE {
   ?this sh:declare [
			sh:namespace  ?namespace;
			sh:prefix \"schema\";
	].
	BIND (IRI(REPLACE (STR(?namespace), \"/$\", \"\" ) )  AS ?schema)
	BIND (STRLANG(rdbs:toPascalCase(STRAFTER(STR(?schema), \"/schema/\")), \"en\") AS ?schemaLabel )
}""" ;
  sh:order "100"^^xsd:decimal ;
  sh:prefixes <https://data.elsevier.com/lifescience/schema/rdbs> ;
.
rdbs:DATE
  a rdbs:DataType ;
  rdfs:label "DATE" ;
.
rdbs:DATETIME
  a rdbs:DataType ;
  rdfs:label "DATETIME" ;
.
rdbs:DCGJSLibrary
  a sh:JSLibrary ;
  rdfs:label "Data-Config-Generator JavaScript Library"@en ;
  sh:jsLibraryURL "https://entellect-dataconfig-generator/js/functions/encase.js"^^xsd:anyURI ;
.
rdbs:DOUBLE
  a rdbs:DataType ;
  rdfs:label "DOUBLE" ;
.
rdbs:DataPropertyColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column mapping to a Data Property of the Graph Ontology."@en ;
  rdfs:label "Data Property Column"@en ;
  rdfs:subClassOf rdbs:PropertyColumn ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasSemanticName ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has semantic name {@en}" ;
    ] ;
.
rdbs:DataType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Collection of primitive and atomic values."@en ;
  rdfs:label "Data type"@en ;
  rdfs:subClassOf owl:Thing ;
.
rdbs:DictionaryIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of a Dictionary Value of the Property Graph."@en ;
  rdfs:label "Dictionary Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:DictionaryTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that identifies the Dictionary values and their relations in the Property Graph Abstraction."@en ;
  rdfs:label "Dictionary Table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has dictionary Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:DictionaryIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has dictionary value column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:DictionaryValueColumn ;
        ] ;
    ] ;
.
rdbs:DictionaryValueColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Dictionary Values of the Property Graph."@en ;
  rdfs:label "Dictionary Value Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:DiscardedColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Instances of this class shall be discarded by the analysis and import process."@en ;
  rdfs:label "Discarded column"@en ;
  rdfs:subClassOf rdbs:Column ;
.
rdbs:DiscardedTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Instances of this class shall be discarded from the analysis and import."@en ;
  rdfs:label "Discarded table"@en ;
  rdfs:subClassOf rdbs:Table ;
.
rdbs:EdgeAttributeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that identify attributes in a Graph and the Graph Edge to which the attribute belong"@en ;
  rdfs:label "Edge Attribute Table"@en ;
  rdfs:subClassOf rdbs:AttributeTable ;
.
rdbs:EdgeAttributeTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Edge Attribute Type Schema Association associates one Edge Attribute Type with an AttributeData"@en ;
  rdfs:label "Edge Attribute Type Association"@en ;
  rdfs:subClassOf rdbs:GraphSchemaTypeAssociation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAttributeDataType ;
      sh:class rdbs:AttributeDataType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has attribute data type {@en}" ;
      sh:node rdbs:AttributeDataType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAttributeType ;
      sh:class rdbs:AttributeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has attribute type {@en}" ;
      sh:node rdbs:AttributeType ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:EdgeAttributeWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table containing the Attributes of the Property Graph Edges and their associated Attribute Types."@en ;
  rdfs:label "Edge Attribute With Type Table "@en ;
  rdfs:subClassOf rdbs:AttributeWithTypeTable ;
.
rdbs:EdgeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents an Edge of the Property Graph. It represents a relation between two Entities in the Property Graph Abstraction."@en ;
  rdfs:label "Edge Table"@en ;
  rdfs:subClassOf rdbs:ObjectTable ;
.
rdbs:EdgeType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Type of Edge in the Schema of Graph"@en ;
  rdfs:label "Edge Type"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:EdgeTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Edge Type Schema Association associates an Edge Type, an AttributeType, an AttributeDataType and two Vertices Types A and B, through two respective Links of Types A and B"@en ;
  rdfs:label "Edge Type Association"@en ;
  rdfs:subClassOf rdbs:GraphSchemaTypeAssociation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasEdgeType ;
      sh:class rdbs:EdgeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has edge type {@en}" ;
      sh:node rdbs:EdgeType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasVerticeALinkType ;
      sh:class rdbs:LinkType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has vertice A Link type {@en}" ;
      sh:node rdbs:LinkType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasVerticeAType ;
      sh:class rdbs:VerticeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has vertice A Type {@en}" ;
      sh:node rdbs:VerticeType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasVerticeBLinkType ;
      sh:class rdbs:LinkType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has vertice B Link type {@en}" ;
      sh:node rdbs:LinkType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasVerticeBType ;
      sh:class rdbs:VerticeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has vertice B Type {@en}" ;
      sh:node rdbs:VerticeType ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:EdgeTypedAttributeValueTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that contains the Attribute Values of a specific AttributeDataType of an Edge Attribute of the Property Graph."@en ;
  rdfs:label "Edge Typed Attribute Value Table"@en ;
  rdfs:subClassOf rdbs:TypedAttributeValueTable ;
.
rdbs:EdgeWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table containing the Edges of the Property Graph and their associated Object Types."@en ;
  rdfs:label "Edge With Type Table "@en ;
  rdfs:subClassOf rdbs:ObjectWithTypeTable ;
.
rdbs:EntityClassification
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "Entity classification"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasClassifyingColumn ;
      sh:class rdbs:Column ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has classifying column" ;
    ] ;
.
rdbs:EntityRelationKarmaAlignmentRulesShape
  a sh:NodeShape ;
  rdfs:label "Entity alignment shape generated from CBE Topology" ;
  rdfs:subClassOf rdbs:KarmaAlignmentRulesShape ;
  sh:order "2"^^xsd:decimal ;
  sh:rule rdbs:CreateAlignmentForManyToManyWithoutClassifier ;
  sh:rule rdbs:CreateAlignmentForTableColumns ;
  sh:rule rdbs:CreateAlignmentForTableFKColumns ;
  sh:rule rdbs:CreateAlignmentForTableInverseFKColumns ;
  sh:targetClass rdbs:EntityTable ;
  sh:targetClass rdbs:TaxonomyTable ;
.
rdbs:EntityRelationProxyOntologyRulesShape
  a sh:NodeShape ;
  rdfs:comment "Shape grouping all rules to generate Proxy ontology entities (e.g. concepts and properties) from a main artefact." ;
  rdfs:label "Entity concept shape" ;
  rdfs:subClassOf rdbs:ProxyOntologyRulesShape ;
  sh:order "1"^^xsd:decimal ;
  sh:rule rdbs:MapColumnToDatatypeProperty ;
  sh:rule rdbs:MapColumnToDatatypePropertyFromPropertyTable ;
  sh:rule rdbs:MapEntityClassifierToSubClass ;
  sh:rule rdbs:MapEntityTableToClass ;
  sh:rule rdbs:MapForeignKeyColumnFromPropertyTableToObjectProperty ;
  sh:rule rdbs:MapForeignKeyColumnToObjectProperty ;
  sh:rule rdbs:MapInverseForeignKeyColumnToObjectProperty ;
  sh:rule rdbs:MapManyToManyLinkToObjectProperty ;
  sh:rule rdbs:MapPropertyClassifierToSubProperty ;
  sh:targetClass rdbs:EntityTable ;
.
rdbs:EntityRelationTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Tables i.e. Tags of the Entity Relation Abstraction"@en ;
  rdfs:subClassOf rdbs:Table ;
.
rdbs:EntityRelationTagRulesShape
  a sh:NodeShape ;
  rdfs:comment "Automating the tagging of entity relationship database items "@en ;
  rdfs:label "Entity Relation Tag Rules Shape "@en ;
  rdfs:subClassOf rdbs:TagRulesShape ;
.
rdbs:EntityRelationTopologyRulesShape
  a sh:NodeShape ;
  rdfs:comment "Shape grouping all rules in the EntityRelation Abstraction to generate CBE Topology"@en ;
  rdfs:label "EntityRelationRulesShape"@en ;
  rdfs:subClassOf rdbs:TopologyRulesShape ;
  sh:order "0"^^xsd:decimal ;
  sh:rule rdbs:ManyToManyRelationship ;
  sh:rule rdbs:MergeTable ;
  sh:rule rdbs:OneToManyRelationship ;
  sh:targetClass rdbs:EntityTable ;
  sh:targetClass rdbs:PropertyTable ;
.
rdbs:EntityTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Table which will generate an entity type in the automated ingestion process."@en ;
  rdfs:label "Entity table"@en ;
  rdfs:subClassOf rdbs:EntityRelationTable ;
.
rdbs:FLOAT
  a rdbs:DataType ;
  rdfs:label "FLOAT" ;
.
rdbs:ForeignColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Look up a number of foreign columns, all belonging to a single table, and associate them to a target table."@en ;
  rdfs:label "Foreign column"@en ;
  rdfs:subClassOf rdbs:Column ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasForeignColumn ;
      sh:class rdbs:Column ;
      sh:minCount 1 ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:viaForeignKeyColumn ;
      sh:class rdbs:ForeignKeyColumn ;
      sh:name "has foreign key column" ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:ForeignKeyColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column of a referencing table whose values must correspond to values of some primary key column in some referenced table."@en ;
  rdfs:label "Foreign key column"@en ;
  rdfs:subClassOf rdbs:Column ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:belongsToTable ;
      sh:class rdbs:Table ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:refersToPrimaryKey ;
      sh:class rdbs:PrimaryKeyColumn ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
    ] ;
.
rdbs:GraphCBE
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents a Concise Bounded Entity (Vertice or Edge) of the Property Graph with its different Attributes and relations."@en ;
  rdfs:label "Graph CBE"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has data property column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:DataPropertyColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object property column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectPropertyColumn ;
        ] ;
    ] ;
.
rdbs:GraphKarmaAlignmentRulesShape
  a sh:NodeShape ;
  rdfs:subClassOf rdbs:KarmaAlignmentRulesShape ;
  sh:rule rdbs:CreateAlignmentForGraphDataTypeProperties ;
  sh:rule rdbs:CreateAlignmentForGraphObjectProperties ;
  sh:targetClass rdbs:GraphCBE ;
.
rdbs:GraphProxyOntologyRulesShape
  a sh:NodeShape ;
  rdfs:subClassOf rdbs:ProxyOntologyRulesShape ;
  sh:rule rdbs:CreateOntoDocument ;
  sh:rule rdbs:MapGraphColumnToConstraintMultiple ;
  sh:rule rdbs:MapGraphColumnToConstraintOr ;
  sh:rule rdbs:MapGraphColumnToConstraintPath ;
  sh:rule rdbs:MapGraphColumnToDataTypeProperty ;
  sh:rule rdbs:MapGraphColumnToObjectProperty ;
  sh:rule rdbs:MapGraphTableToClass ;
  sh:targetClass owl:Ontology ;
  sh:targetClass rdbs:GraphCBE ;
  sh:targetClass rdbs:SourceCBETable ;
  sh:targetClass rdbs:VerticeCBETable ;
.
rdbs:GraphSchemaType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment """The Super Class of the Types that makes up (i.e. defines) the Schema of a Graph.
Note that it is assumed that the type of Graph for which we enable the description of their schema with this modeling, are those found in the Biochemistry domain. 
Hence we can find types like Annotation or ontology where people would mostly expect EdgeType or VerticeType"""@en ;
  rdfs:label "Graph Schema Type"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdfs:label ;
      sh:datatype xsd:string ;
      sh:description "The Types must come imperatively with a label"@en ;
      sh:name "Type Label"@en ;
    ] ;
.
rdbs:GraphSchemaTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Schema Description of a Type in a Graph Schema"@en ;
  rdfs:label "Graph Schema Type Association"@en ;
  rdfs:subClassOf owl:Thing ;
.
rdbs:GraphTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Tables i.e. Tags of the Graph Abstraction"@en ;
  rdfs:label "Graph Table"@en ;
  rdfs:subClassOf rdbs:Table ;
.
rdbs:GraphTagRulesShape
  a sh:NodeShape ;
  rdfs:comment "Automating the tagging of property graph database items "@en ;
  rdfs:label "Graph Tag Rules Shape "@en ;
  rdfs:subClassOf rdbs:TagRulesShape ;
  sh:rule rdbs:TagSchemaIdColumns ;
  sh:targetClass owl:Ontology ;
.
rdbs:GraphTopologyRulesShape
  a sh:NodeShape ;
  rdfs:comment "Shape grouping all rules in the Graph Abstraction to generate CBE Topology"@en ;
  rdfs:label "GraphTopologyRulesShape"@en ;
  rdfs:subClassOf rdbs:TopologyRulesShape ;
  sh:order "1"^^xsd:decimal ;
  sh:rule rdbs:AnnotationCBE ;
  sh:rule rdbs:AnnotationWithType ;
  sh:rule rdbs:AttributeWithType ;
  sh:rule rdbs:MembershipWithType ;
  sh:rule rdbs:ObjectWithType ;
  sh:rule rdbs:SourceCBE ;
  sh:rule rdbs:TypedAttributeValueWithTypeWithIdObject ;
  sh:rule rdbs:TypedAttributeValueWithTypeWithIdObjectWithDictionary ;
  sh:rule rdbs:TypedEdgesAttributeValuePerAttributeType ;
  sh:rule rdbs:TypedVerticesAttributeValuePerAttributeType ;
  sh:rule rdbs:VerticeCBE ;
  sh:rule rdbs:VerticeWithTypeWithMembership ;
  sh:targetClass owl:Ontology ;
  sh:targetClass rdbs:AnnotationTable ;
  sh:targetClass rdbs:AnnotationWithTypeTable ;
  sh:targetClass rdbs:EdgeAttributeTable ;
  sh:targetClass rdbs:EdgeAttributeWithTypeTable ;
  sh:targetClass rdbs:EdgeTable ;
  sh:targetClass rdbs:EdgeTypedAttributeValueTable ;
  sh:targetClass rdbs:MembershipTable ;
  sh:targetClass rdbs:TypedEdgeAttributeValueWithTypeWithIdObjectTable ;
  sh:targetClass rdbs:TypedEdgeValuePerAttributeTypeTable ;
  sh:targetClass rdbs:TypedVerticeAttributeValueWithTypeWithIdObjectTable ;
  sh:targetClass rdbs:TypedVerticeValuePerAttributeTypeTable ;
  sh:targetClass rdbs:VerticeAttributeTable ;
  sh:targetClass rdbs:VerticeAttributeWithTypeTable ;
  sh:targetClass rdbs:VerticeTable ;
  sh:targetClass rdbs:VerticeTypedAttributeValueTable ;
  sh:targetClass rdbs:VerticeWithTypeTable ;
.
rdbs:GroupBy
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Group By operation for Topologies."@en ;
  rdfs:label "Group By"@en ;
  rdfs:subClassOf rdbs:TopologyOperation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdfs:label ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasOrder ;
      sh:datatype xsd:integer ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has order" ;
    ] ;
.
rdbs:INT
  a rdbs:DataType ;
  rdfs:label "INT" ;
.
rdbs:IdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the identifier of an Object."@en ;
  rdfs:label "Id Column"@en ;
  rdfs:subClassOf rdbs:Column ;
  sh:deactivated true ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdf:type ;
      sh:description "Second Type of the Id Column (either ForeignKeyColumn or PrimaryKeyColumn). {@en}" ;
      sh:minCount 2 ;
      sh:name "Id Column Type {@en}" ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:in (
              rdbs:ForeignKeyColumn
              rdbs:PrimaryKeyColumn
            ) ;
        ] ;
    ] ;
.
rdbs:IndexValueColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Index Values of the Property Graph."@en ;
  rdfs:label "Index Value Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:InnerJoin
  a rdbs:JoinKind ;
  rdfs:comment "A SQL Inner Join."@en ;
  rdfs:label "InnerJoin"@en ;
.
rdbs:InverseOf
  a sh:SPARQLRule ;
  rdfs:comment "Creates a owl:inverseOf between properties that are inverse of each others in the proxy ontology."@en ;
  rdfs:label "Inverse Of"@en ;
  sh:construct """PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>


CONSTRUCT {
# Property 1 is the inverse of Property 2	
	?property_1 owl:inverseOf ?property_2 .	
}
WHERE {
# Get the pairs of relations (A B) between CBEs for which there are triples x A y and y B x where x and y being CBEs
	{
# Count 2 should be equal to Count 1 - this gives the number of relations of that type
		SELECT ?relation_1 ?relation_2 (COUNT(?relation_1) AS ?count_1) (COUNT(?relation_2) AS ?count_2)
		WHERE {
			?v1 rdfs:label ?this ;
				rdbs:hasColumn [
					rdbs:hasSemanticName ?relation_1 ;
					rdbs:hasObjectSemanticName ?that 
				] .
			?v2 rdfs:label ?that ;
				rdbs:hasColumn [ 
					rdbs:hasSemanticName ?relation_2 ;
					rdbs:hasObjectSemanticName ?this 
				] .
		} GROUP BY ?relation_1 ?relation_2
	}
# Select the set of triples x1 A y1 and count how many they are
	{
		SELECT ?relation_3 (COUNT(?relation_3) AS ?count_3)
		WHERE {
			?v1 rdbs:hasColumn [
					rdbs:hasSemanticName ?relation_3 ;
					rdbs:hasObjectSemanticName ?that 
				] .
# We can forget about edges until their CBEs are created
#			FILTER NOT EXISTS {?vt a rdbs:EdgeType ; rdfs:label ?that}
		} GROUP BY ?relation_3
	}
	FILTER (?relation_1 = ?relation_3)
# Select the set of triples x2 B y2 and count how many they are
{
		SELECT ?relation_4 (COUNT(?relation_4) AS ?count_4)
		WHERE {
			?v2 rdbs:hasColumn [
					rdbs:hasSemanticName ?relation_4 ;
					rdbs:hasObjectSemanticName ?that 
				] .
# We can forget about edges until their CBEs are created
#			FILTER NOT EXISTS {?vt a rdbs:EdgeType ; rdfs:label ?that}
		} GROUP BY ?relation_4
	}
	FILTER (?relation_2 = ?relation_4)
# We want to get the relations where the three sets have the same cardinality (which proves the inverse relation)
	FILTER (?count_1 = ?count_3)
	FILTER (?count_1 = ?count_4)
# Get the two properties corresponding to the inverse relations	
	?property_1 a owl:ObjectProperty ;
		rdfs:label ?relation_1 .
	?property_2 a owl:ObjectProperty ;
		rdfs:label ?relation_2 .
}""" ;
  sh:deactivated false ;
  sh:order "0"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:Join
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Join operation for Topologies."@en ;
  rdfs:label "Join"@en ;
  rdfs:subClassOf rdbs:TopologyOperation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasForeignKey ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:name "has foreign key" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasKind ;
      sh:class rdbs:JoinKind ;
      sh:maxCount 1 ;
      sh:name "has kind" ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasSelect ;
      sh:class rdbs:Select ;
      sh:name "has select" ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasTopic ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has topic" ;
    ] ;
.
rdbs:JoinKind
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Kind of SQL Join used in a Topology."@en ;
  rdfs:label "Join Kind"@en ;
  rdfs:subClassOf rdbs:DataType ;
.
rdbs:KarmaAlignmentRulesShape
  a sh:NodeShape ;
  rdfs:label "Karma alignment rules shape" ;
.
rdbs:LeftJoin
  a rdbs:JoinKind ;
  rdfs:comment "A SQL Left Join."@en ;
  rdfs:label "LeftJoin"@en ;
.
rdbs:LinkType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Type of Link between a Vertex and an Edge in the Schema of a Graph"@en ;
  rdfs:label "Link Type"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:LookupTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "Lookup table"@en ;
  rdfs:subClassOf rdbs:EntityRelationTable ;
.
rdbs:ManyToManyRelationship
  a sh:SPARQLRule ;
  rdfs:label "Many to many symmetric relationship" ;
  sh:construct """
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>

CONSTRUCT {
    ?topology a rdbs:Topology;
        rdbs:topic ?origin ;
        rdbs:relation ?relation ;
        rdbs:groupby ?groupby ;
        rdbs:classifier ?classifier ;
        rdbs:collect [
          rdbs:value ?collect ;
          rdbs:as ?relation ;
          rdbs:classifyingValuesFrom ?ccolumn ;
          rdbs:extendTable ?entity ;
          rdbs:withValuesFromTable ?oentity ;
        ];
    rdbs:generatedBy rdbs:ManyToManyRelationship ;
    .

}
WHERE {
    $this rdfs:label ?origin .
   ?oentity a ?oet .
   FILTER(?oet = rdbs:EntityTable || ?oet = rdbs:TaxonomyTable)
   ?link a rdbs:RelationshipTable; rdfs:label ?relation ; rdbs:hasColumn ?efk , ?tfk.
   FILTER(?efk != ?tfk)
   ?efk a rdbs:ForeignKeyColumn ;  rdbs:refersToPrimaryKey ?epk;  rdfs:label ?groupby.
   ?tfk a rdbs:ForeignKeyColumn  ;  rdbs:refersToPrimaryKey ?tpk ; rdfs:label ?collect.
   ?epk rdbs:belongsToTable $this.
   ?tpk rdbs:belongsToTable ?oentity.
  FILTER NOT EXISTS {
   $this rdbs:inhibitRelationTo ?oentity
  }
  OPTIONAL
  {
    ?pc a rdbs:PropertyClassification;
           rdbs:hasClassifyingTable $this ;
           rdbs:hasClassifyingColumn ?ccolumn.
    ?ccolumn  rdbs:belongsToTable ?link ;
              rdfs:label ?classifier .

  }
  BIND(BNODE() AS ?topology)
  BIND($this AS ?entity)
}""" ;
  sh:deactivated true ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapColumnToDatatypeProperty
  a sh:SPARQLRule ;
  rdfs:label "Map an Column in an Entity Table to an owl:DatatypeProperty" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
   ?puri a owl:DatatypeProperty ;
      rdfs:label ?cname ;
      rdfs:domain ?euri ;
      rdbs:mapsToColumn ?column .

  ?euri sh:property [
       a sh:PropertyShape ;
       sh:path ?puri ;
       sh:maxCount ?max ;
       sh:minCount ?min ;
       sh:nodeKind sh:Literal ;
  ].
}
WHERE {
  $this rdfs:label ?ename ;
      rdbs:hasColumn ?column.
    ?column a rdbs:Column ;
         rdfs:label ?cname;
         rdbs:isNullable ?nullable
    .
    OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
    OPTIONAL { ?column rdbs:hasPropertyLocalName ?plname.}

    rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.

    BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
    BIND(rdbs:mintDTPropertyURI(?lname , ?ename ,?plname , ?cname , ?namespace) AS ?puri)

    BIND( IF(?nullable , 0, 1) AS ?min)
    BIND( 1 AS ?max)
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapColumnToDatatypePropertyFromPropertyTable
  a sh:SPARQLRule ;
  rdfs:label "Map an Column in an Entity Table to an owl:DatatypeProperty" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
   ?puri a owl:DatatypeProperty ;
      rdfs:label ?cname ;
      rdfs:domain ?euri ;
      rdbs:mapsToColumn ?column ;
      rdbs:generatedBy rdbs:MapColumnToDatatypePropertyFromPropertyTable;
      .

  ?euri sh:property [
       a sh:PropertyShape ;
       sh:path ?puri ;
       sh:maxCount ?max ;
       sh:minCount ?min ;
       sh:nodeKind sh:Literal ;
       rdbs:generatedBy rdbs:MapColumnToDatatypePropertyFromPropertyTable;
  ].
  ?alignment a rdbs:Alignment ;
        rdbs:atype \"DTP\" ;
        rdbs:topic ?ename ;
        rdbs:field ?fieldname ;
        rdbs:datatype ?dt ;
        rdbs:uri ?puri ;
        rdbs:generatedBy rdbs:MapColumnToDatatypePropertyFromPropertyTable ;
        .
  ?topology a rdbs:Topology;
          rdbs:topic ?origin ;
          rdbs:relation ?relation ;
          rdbs:groupby ?groupby ;
          rdbs:collect [
             rdbs:value ?cname ;
             rdbs:as ?fieldname ;
             rdbs:extendTable ?entity ;
             rdbs:property ?puri ;
          ]  ;
          rdbs:generatedBy rdbs:MapColumnToDatatypePropertyFromPropertyTable ;
          .

}
WHERE {

  $this a rdbs:EntityTable ;
         rdfs:label ?ename .

   ?oentity a rdbs:PropertyTable  ;
         rdbs:hasColumn [
              a rdbs:ForeignKeyColumn , rdbs:PrimaryKeyColumn ;
              rdbs:refersToPrimaryKey [
                 rdbs:belongsToTable $this
              ];
              rdfs:label ?groupby
         ] ;
      rdbs:hasColumn ?column.

    ?column a rdbs:Column ;
         rdfs:label ?cname;
         rdbs:hasDataType ?dt ;
         rdbs:isNullable ?nullable
    .
    OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
    OPTIONAL { ?column rdbs:hasPropertyLocalName ?plname.}

    rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.
    BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
    BIND(rdbs:mintDTPropertyURI(?lname , ?ename ,?plname , ?cname , ?namespace) AS ?puri)

    BIND( IF(?nullable , 0, 1) AS ?min)
    BIND(BNODE() AS ?alignment)
    BIND(BNODE() AS ?topology)
    BIND( IF(BOUND(?plname),?plname , ?cname) AS ?fieldname)
    BIND( 1 AS ?max)
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapEntityClassifierToSubClass
  a sh:SPARQLRule ;
  rdfs:label "Map an Entity classifier to a set of owl:Class" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
  ?suburi a owl:Class , sh:NodeShape;
           rdfs:subClassOf ?euri ;
           rdfs:label ?name.
}
WHERE {

    ?pc a rdbs:EntityClassification;
           rdbs:hasClassifyingColumn ?classifier.
    ?classifier rdbs:belongsToTable $this ;
           rdbs:hasDistinctValue ?classifyingValue ;
           rdbs:hasAssociation [
            rdbs:hasValue ?classifyingValue ;
            rdbs:hasAssociatedName ?name
           ]
    .
    $this rdfs:label ?ename.
    OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
    rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.
    BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
    BIND(rdbs:mintEntityURI(?name , ?classifyingValue , ?namespace) AS ?suburi)
  }""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapEntityTableToClass
  a sh:SPARQLRule ;
  rdfs:label "Map an Entity Table to an owl:Class" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
  ?euri a owl:Class , sh:NodeShape;
           rdfs:subClassOf owl:Thing ;
           rdfs:label ?ename ;
           rdbs:fromTable ?table.
}
WHERE {
   $this rdfs:label ?ename.
   OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
   rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.
   BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
   BIND(  $this as ?table )
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapForeignKeyColumnFromPropertyTableToObjectProperty
  a sh:SPARQLRule ;
  rdfs:label "Map an Column in an Property Table to an owl:ObjectProperty" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
   ?puri a owl:ObjectProperty ;
      rdfs:label ?cname ;
      rdfs:domain ?euri ;
      rdfs:range ?turi ;
      rdbs:mapsToColumn ?column ;
      rdbs:generatedBy rdbs:MapForeignKeyColumnFromPropertyTableToObjectProperty ;
      .

  ?euri sh:property [
       a sh:PropertyShape ;
       sh:path ?puri ;
       sh:maxCount ?max ;
       sh:minCount ?min ;
       sh:class ?turi ;
       sh:node ?turi ;
       rdbs:generatedBy rdbs:MapForeignKeyColumnFromPropertyTableToObjectProperty ;
      sh:nodeKind sh:IRI ;
  ].
}
WHERE {

  $this a rdbs:EntityTable ;
         rdfs:label ?origin .
   ?pentity a rdbs:PropertyTable  ;
         rdfs:label ?relation ;
         rdbs:hasColumn ?fpk , ?column;
         .
         ?fpk a rdbs:ForeignKeyColumn , rdbs:PrimaryKeyColumn ;
              rdbs:refersToPrimaryKey [
                 rdbs:belongsToTable $this
              ];
         .
         FILTER(?fpk != ?column)

         ?column a rdbs:ForeignKeyColumn ;
             rdfs:label ?cname;
             rdbs:isNullable ?nullable;
             rdbs:refersToPrimaryKey [ rdbs:belongsToTable ?oentity];
         .
     ?oentity  rdfs:label ?oename ;
     OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
     OPTIONAL { ?oentity rdbs:hasEntityLocalName ?loname.}
     OPTIONAL { ?column rdbs:hasPropertyLocalName ?plname.}

    rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.

    BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
    BIND(rdbs:mintEntityURI(?loname , ?oename , ?namespace) AS ?turi)
    BIND(rdbs:mintOBJPropertyURI(?lname , ?ename ,?loname , ?oename , ?plname, ?namespace) AS ?puri)

    BIND( IF(?nullable , 0, 1) AS ?min)
    BIND( 1 AS ?max)
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapForeignKeyColumnToObjectProperty
  a sh:SPARQLRule ;
  rdfs:label "Map an Column in an Entity Table to an owl:ObjectProperty" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
   ?puri a owl:ObjectProperty ;
      rdfs:label ?cname ;
      rdfs:domain ?euri ;
      rdfs:range ?turi ;
      rdbs:mapsToColumn ?column ;
      rdbs:generatedBy rdbs:MapForeignKeyColumnToObjectProperty ;
.

  ?euri sh:property [
       a sh:PropertyShape ;
       sh:path ?puri ;
       sh:maxCount ?max ;
       sh:minCount ?min ;
       sh:class ?turi ;
       sh:node ?turi ;
       rdbs:generatedBy rdbs:MapForeignKeyColumnToObjectProperty ;
      sh:nodeKind sh:IRI ;
  ].
}
WHERE {
  $this rdfs:label ?ename ;
      rdbs:hasColumn ?column.
    ?column a rdbs:ForeignKeyColumn ;
         rdfs:label ?cname;
         rdbs:isNullable ?nullable;
         rdbs:refersToPrimaryKey [ rdbs:belongsToTable ?oentity]
    .
  ?oentity  rdfs:label ?oename ;
     OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
     OPTIONAL { ?oentity rdbs:hasEntityLocalName ?loname.}
     OPTIONAL { ?column rdbs:hasPropertyLocalName ?plname.}

    rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.

    BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
    BIND(rdbs:mintEntityURI(?loname , ?oename , ?namespace) AS ?turi)
    BIND(rdbs:mintOBJPropertyURI(?lname , ?ename ,?loname , ?oename , ?plname, ?namespace) AS ?puri)

    BIND( IF(?nullable , 0, 1) AS ?min)
    BIND( 1 AS ?max)
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapGraphColumnToConstraintMultiple
  a sh:SPARQLRule ;
  rdfs:label "Set the Class and Node constraints on Property Shapes according to whether or not there are multiple possibilities" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
	?property ?to_add_property ?to_add_object ;
		sh:minCount ?min .
}
#SELECT *
WHERE {
	{
		SELECT DISTINCT ?this ?class ?property ?name (COUNT(?object_name) AS ?count)
		WHERE {
# Get the CBE
			?this a rdbs:VerticeCBETable ;
				rdbs:hasColumn ?object .
# Get its class
			BIND (rdbs:mintGraphClass(?this) AS ?class )
# Find the semantic names
			?object a rdbs:ObjectPropertyColumn ;
				rdbs:hasSemanticName ?name ;
				rdbs:hasObjectSemanticName ?object_name .
# Find the property paths
			?class sh:property ?property .
			?property a sh:PropertyShape ;
				sh:path [
					a owl:ObjectProperty ;
						rdfs:label ?name 
					] .
		} GROUP BY ?property ?this ?class ?name
	}
	OPTIONAL {
# Get corresponding columns
		BIND (BNODE() AS ?to_add_object)
		BIND (sh:or AS ?to_add_property)
		FILTER (?count > 1)
	}
	OPTIONAL {
		?this rdbs:hasColumn ?object .
		?object a rdbs:ObjectPropertyColumn ;
			rdbs:hasSemanticName ?name ;
			rdbs:isNullable ?nullable .
		BIND (rdbs:mintGraphPropertyObject(?object) AS ?to_add_object)
		BIND ( IF(?nullable, 0, 1) AS ?min )
		VALUES ?to_add_property {sh:node sh:class}
		FILTER (?count = 1)
	}
	FILTER NOT EXISTS {?property sh:or ?forbidden}
	FILTER NOT EXISTS {?property sh:or ?forbidden . ?property sh:class ?forbidden}
}
""" ;
  sh:deactivated false ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapGraphColumnToConstraintOr
  a sh:SPARQLRule ;
  rdfs:label "Set the Class and Node constraints of a Property Shape in the case where they have to be listed in a SH:OR" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX sh:<http://www.w3.org/ns/shacl#>

# Build the next node
CONSTRUCT {
	?root rdf:first ?or_constraint ;
		rdf:rest ?rest .
	?or_constraint sh:class ?object ;
		sh:node ?object ;
		sh:min ?min .
}
WHERE {
	{
		SELECT ?property ?list ?last ?new_list (SAMPLE(?object_column) AS ?value) (COUNT(?object_column) AS ?count)
		WHERE {
# Get instance to add list to 
			?this a rdbs:VerticeCBETable .
			BIND (rdbs:mintGraphClass(?this) AS ?class )
			?class sh:property ?property .
			?property a sh:PropertyShape ;
				sh:path [
					a owl:ObjectProperty ;
					rdfs:label ?object_name 
				] .
# Find the list root that indicates the list should be updated
			?property sh:or ?list .
# Check for the last open branch of the list (root if there are none)
			OPTIONAL {
				?list rdf:rest* ?existing_last .
				FILTER NOT EXISTS {?existing_last rdf:rest ?forbidden}
			}
			BIND ( COALESCE( ?existing_last, ?list ) AS ?last )
# Get a random item from the set that is not already in the list, and the size of that set
			?this rdbs:hasColumn ?object_column .
			?object_column a rdbs:ObjectPropertyColumn ;
				rdbs:hasSemanticName ?object_name .
			BIND ( rdbs:mintGraphPropertyObject(?object_column) AS ?object )
			FILTER NOT EXISTS { ?list (rdf:first|rdf:rest)*/sh:class ?object }
		} GROUP BY ?property ?list ?last ?new_list
	}
# Create property constraint
	BIND (BNODE() AS ?or_constraint )
# Get min count
	?value rdbs:isNullable ?nullable .
	BIND ( IF(?nullable, 0, 1) AS ?min )
# Get class / node	
	BIND ( rdbs:mintGraphPropertyObject(?value) AS ?object )
# Infer the root, first value and rest value of the next node to build in our list
	BIND (?last AS ?root)
	BIND (?or_constraint  AS ?first)
	BIND ( IF (?count < 2, rdf:nil, BNODE() ) AS ?rest)
	FILTER NOT EXISTS {?list rdf:rest* rdf:nil} 
}""" ;
  sh:deactivated false ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapGraphColumnToConstraintPath
  a sh:SPARQLRule ;
  rdfs:label "Map the Foreign Keys Columns of a Property Graph CBEs to a new Path for Object Property Constraints" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
	?property a owl:ObjectProperty ;
		rdfs:label ?label ;
#		rdfs:range ?range ;
#		rdfs:domain ?class ;
		rdbs:mapsToColumn ?property_column .
}
WHERE {
# Get the CBEs and their columns
	?this a rdbs:VerticeCBETable ;
		rdbs:hasColumn ?property_column .
# Get the columns that are related to Data Properties
	?property_column a rdbs:ObjectPropertyColumn ;
# Create the URI of the Class generated by the current CBE
	BIND ( rdbs:mintGraphClass(?this) AS ?class )
# Check if the column is nullable
	?property_column rdbs:hasSemanticName ?label .
# Create the new property URI
	BIND(rdbs:mintGraphProperty(?property_column) as ?property)
# Find the domain
	BIND(rdbs:mintGraphPropertyObject(?property_column) as ?range )
# Filter existance
	FILTER NOT EXISTS { ?class sh:property/sh:path ?property  }
}""" ;
  sh:deactivated false ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapGraphColumnToDataTypeProperty
  a sh:SPARQLRule ;
  rdfs:label "Map the non Foreign Keys Columns of a Property Graph CBEs to a new Data Type Property" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
	?property a owl:DatatypeProperty ;
		rdfs:label ?label ;
#		rdfs:domain ?class ;
		rdbs:mapsToColumn ?property_column .
	?class sh:property [
		a sh:PropertyShape ;
		sh:nodeKind sh:Literal ;
		sh:path ?property ;
		sh:minCount ?min
	]
}
WHERE {
# List the CBE Table Classes
	VALUES ?cbe_table {rdbs:VerticeCBETable rdbs:SourceCBETable }
# Get the CBEs and their columns
	?this a ?cbe_table ;
		rdbs:hasColumn ?property_column .
# Get the columns that are related to Data Properties
	?property_column a rdbs:DataPropertyColumn ;
# Create the URI of the Class generated by the current CBE
	BIND ( rdbs:mintGraphClass(?this) AS ?class )
# Check if the column is nullable
	?property_column rdfs:label ?label ;
		rdbs:isNullable ?nullable .
# Create the new property URI
	BIND(rdbs:mintGraphProperty(?property_column) as ?property)
# Set nullability
    BIND( IF(?nullable , 0, 1) AS ?min)
# Filter existance
	FILTER NOT EXISTS { ?class sh:property/sh:path ?property  }
}
""" ;
  sh:deactivated false ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapGraphColumnToObjectProperty
  a sh:SPARQLRule ;
  rdfs:label "Map the Foreign Keys Columns of a Property Graph CBEs to a new Object Property" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
	?class sh:property ?property_shape .
	?property_shape	a sh:PropertyShape ;
		sh:nodeKind sh:IRI ;
		sh:path ?path .
}
WHERE {
	{ 
		SELECT ?class ?path
		WHERE {
			?this a rdbs:VerticeCBETable ;
				rdbs:hasColumn ?object_column .
				?object_column a rdbs:ObjectPropertyColumn .
			BIND ( rdbs:mintGraphProperty(?object_column) AS ?path )
			BIND ( rdbs:mintGraphClass(?this) AS ?class )
		} GROUP BY ?class ?path
	}
	BIND (BNODE() AS ?property_shape)
	FILTER NOT EXISTS {?class sh:property/sh:path ?path}
}""" ;
  sh:deactivated false ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapGraphTableToClass
  a sh:SPARQLRule ;
  rdfs:label "Map the CBE tables of a Property Graph to a new Classe" ;
  sh:construct """PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
 ?class a owl:Class, sh:NodeShape ;
	rdfs:label ?label ;
	rdfs:subClassOf owl:Thing .
}
WHERE {
# List the CBE Table Classes
	VALUES ?cbe_table {rdbs:VerticeCBETable rdbs:SourceCBETable }
# Get the Entities that need to be represented by a class in the proxy ontology	
	?this a ?cbe_table;
		rdfs:label ?label .
# We create an URI for our entity (either based on the semantic label of the entity, or on its label by default)
# Basing the URI on the entity label can mean reusing the entity as a class
	BIND ( rdbs:mintGraphClass(?this) AS ?class )
# Filter the existing classes
	FILTER NOT EXISTS { ?class a owl:Class }
}
""" ;
  sh:deactivated false ;
  sh:order "9"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapInverseForeignKeyColumnToObjectProperty
  a sh:SPARQLRule ;
  rdfs:label "Generate the inverse property to an Entity Table, if this does not exist, to an owl:ObjectProperty" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
   ?puri a owl:ObjectProperty ;
      rdfs:label ?localTargetEntityClassName ;
      rdfs:domain ?euri ;
      rdfs:range ?turi ;
      rdbs:generatedBy rdbs:MapInverseForeignKeyColumnToObjectProperty ;
 .

  ?euri sh:property [
       a sh:PropertyShape ;
       sh:path ?puri ;
       sh:maxCount ?max ;
       sh:minCount ?min ;
       sh:class ?turi ;
       sh:node ?turi ;
       rdbs:generatedBy rdbs:MapInverseForeignKeyColumnToObjectProperty ;
      sh:nodeKind sh:IRI ;
  ].
}
WHERE {
  $this a rdbs:EntityTable ; rdfs:label ?ename .
  ?oentity  a rdbs:EntityTable ; rdfs:label ?oename ;
        rdbs:hasColumn ?column ;
  .

  ?column a rdbs:ForeignKeyColumn ;
         rdfs:label ?cname;
         rdbs:isNullable ?nullable;
         rdbs:refersToPrimaryKey [ rdbs:belongsToTable $this]
  .

 FILTER NOT EXISTS {
  ?ocolumn a rdbs:ForeignKeyColumn ;
     rdbs:belongsToTable $this ;
     rdbs:refersToPrimaryKey [ rdbs:belongsToTable ?oentity]
  .
 }

  OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
  OPTIONAL { ?oentity rdbs:hasEntityLocalName ?loname.}

  rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.

  BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
  BIND(rdbs:mintEntityURI(?loname , ?oename , ?namespace) AS ?turi)
  BIND(rdbs:mintOBJPropertyURI(?lname , ?ename ,?loname , ?oename , ?plname, ?namespace) AS ?puri)

  BIND( IF(?nullable , 0, 1) AS ?min)
  BIND( 1 AS ?max)
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapManyToManyLinkToObjectProperty
  a sh:SPARQLRule ;
  rdfs:label "Map a M:N relationship to an owl:ObjectProperty" ;
  sh:construct """
           PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
           PREFIX owl: <http://www.w3.org/2002/07/owl#>
           PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
           PREFIX sh:<http://www.w3.org/ns/shacl#>
           CONSTRUCT {
              ?puri a owl:ObjectProperty ;
                 rdfs:label ?cname ;
                 rdfs:domain ?euri ;
                 rdfs:range ?turi ;
                 rdbs:generatedBy rdbs:MapManyToManyLinkToObjectProperty ;
                 .
             ?euri sh:property [
                  a sh:PropertyShape ;
                  sh:path ?puri ;
                  sh:maxCount ?max ;
                  sh:minCount ?min ;
                  sh:class ?turi ;
                  sh:node ?turi ;
                  rdbs:generatedBy rdbs:MapManyToManyLinkToObjectProperty ;
                 sh:nodeKind sh:IRI ;
             ].

             ?topology a rdbs:Topology;
                   rdbs:topic ?origin ;
                   rdbs:relation ?relation ;
                   rdbs:groupby ?groupby ;
                   rdbs:classifier ?classifier ;
                   rdbs:collect [
                     rdbs:value ?collect ;
                     rdbs:as ?relation ;
                     rdbs:classifyingValuesFrom ?ccolumn ;
                     rdbs:extendTable ?entity ;
                     rdbs:withValuesFromTable ?oentity ;
                     rdbs:property ?puri
                   ];
               rdbs:generatedBy rdbs:MapManyToManyLinkToObjectProperty ;
               .
           } WHERE {
             SELECT DISTINCT * {
              $this  a rdbs:EntityTable ; rdfs:label ?origin .
              ?oentity a ?ttype ; rdfs:label ?oename  .
              FILTER (?ttype = rdbs:EntityTable || ?ttype = rdbs:TaxonomyTable)
              ?link a rdbs:RelationshipTable; rdfs:label ?relation ; rdbs:hasColumn ?efk , ?tfk.
              FILTER(?efk != ?tfk)
              ?efk a rdbs:ForeignKeyColumn ;  rdbs:refersToPrimaryKey ?epk;  rdfs:label ?groupby.
              ?tfk a rdbs:ForeignKeyColumn  ;  rdbs:refersToPrimaryKey ?tpk ; rdfs:label ?collect.
              ?epk rdbs:belongsToTable $this.
              ?tpk rdbs:belongsToTable ?oentity.

              FILTER NOT EXISTS {
               $this rdbs:inhibitRelationTo ?oentity
              }
              OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
              OPTIONAL { ?oentity rdbs:hasEntityLocalName ?loname.}
              OPTIONAL { ?tfk rdbs:hasPropertyLocalName ?plname .}


              OPTIONAL
              {
                ?pc a rdbs:PropertyClassification;
                      rdbs:hasClassifyingTable $this ;
                      rdbs:hasClassifyingColumn ?ccolumn.
                ?ccolumn  rdbs:belongsToTable ?link ;
                         rdfs:label ?classifier .
              }

              rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.

              BIND(rdbs:mintEntityURI(?lname , ?origin , ?namespace) AS ?euri)
              BIND(rdbs:mintEntityURI(?loname , ?oename , ?namespace) AS ?turi)
              BIND(rdbs:mintOBJPropertyURI(?lname , ?origin ,?loname , ?oename , ?plname ,?namespace) AS ?puri)
              BIND( 0 AS ?min)
              BIND( 1 AS ?max)
              BIND(BNODE() AS ?topology)
              BIND($this AS ?entity)
             }
           }""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapPropertyClassifierToSubProperty
  a sh:SPARQLRule ;
  rdfs:comment "This rule not only creates the subproperties but also the CBE topology and the alignments." ;
  rdfs:label "Map a Property classifier to a sub property" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>
CONSTRUCT {
  ?alignment a rdbs:Alignment ;
      rdbs:atype \"OTP\" ;
      rdbs:topic ?origin ;
      rdbs:field ?subfield ;
      rdbs:uri ?spuri ;
      rdbs:targetClass ?turi ;
      rdbs:generatedBy  rdbs:MapPropertyClassifierToSubProperty ;
      .

  ?topology a rdbs:Topology;
        rdbs:topic ?origin ;
        rdbs:relation ?relation ;
        rdbs:groupby ?groupby ;
        rdbs:classifier ?classifier ;
        rdbs:collect [
          rdbs:value ?collect ;
          rdbs:as ?relation ;
          rdbs:classifyingValuesFrom ?ccolumn ;
          rdbs:extendTable ?entity ;
          rdbs:property ?spuri
        ] ;
        rdbs:generatedBy rdbs:MapPropertyClassifierToSubProperty ;
        .

  ?spuri a owl:ObjectProperty ;
      rdfs:label ?localSubPropertyName ;
      rdfs:domain ?euri ;
      rdfs:range ?turi ;
     rdfs:subPropertyOf ?puri ;
     rdbs:generatedBy rdbs:MapPropertyClassifierToSubProperty ;
   .

  ?euri sh:property [
       a sh:PropertyShape ;
       sh:path ?spuri ;
       sh:maxCount ?max ;
       sh:minCount ?min ;
       sh:node ?turi ;
       sh:nodeKind sh:IRI ;
       rdbs:generatedBy rdbs:MapPropertyClassifierToSubProperty ;
       ]
   .
}  WHERE {
    $this  rdfs:label ?origin .
   ?oentity a ?ttype ; rdfs:label ?oename.
   FILTER( ?ttype = rdbs:EntityTable || ?ttype = rdbs:TaxonomyTable)
   ?link a rdbs:RelationshipTable; rdfs:label ?relation ; rdbs:hasColumn ?efk , ?tfk.
   FILTER(?efk != ?tfk)
   ?efk a rdbs:ForeignKeyColumn ;  rdbs:refersToPrimaryKey ?epk;  rdfs:label ?groupby.
   ?tfk a rdbs:ForeignKeyColumn  ;  rdbs:refersToPrimaryKey ?tpk ; rdfs:label ?collect.
   ?epk rdbs:belongsToTable $this.
   ?tpk rdbs:belongsToTable ?oentity.

   FILTER NOT EXISTS {
    $this rdbs:inhibitRelationTo ?oentity
   }
   OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
   OPTIONAL { ?oentity rdbs:hasEntityLocalName ?loname.}
   OPTIONAL { ?tfk rdbs:hasPropertyLocalName ?plname. }

   rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.

   ?pc a rdbs:PropertyClassification;
           rdbs:hasClassifyingColumn ?classifyingColumn;
           .
   ?classifyingColumn rdbs:belongsToTable ?link ;
      rdfs:label ?ccolumn ;
      rdbs:hasDistinctValue ?classifyingValue ;
       rdbs:hasAssociation [
        rdbs:hasValue ?classifyingValue ;
        rdbs:hasAssociatedName ?name
       ]
      .


    BIND( CONCAT(CONCAT(?relation,\"_\"),str(?classifyingValue)) AS ?subfield)

    BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
    BIND(rdbs:mintEntityURI(?loname , ?oename , ?namespace) AS ?turi)
    BIND(rdbs:mintOBJPropertyURI(?lname , ?ename ,?loname , ?oename , ?plname ,?namespace) AS ?puri)
    BIND(rdbs:mintOBJSubPropertyURI(?lname , ?ename ,?loname , ?oename , ?plname ,?name, ?namespace) AS ?spuri)

    BIND( 0 AS ?min)
    BIND( 1 AS ?max)
    BIND(BNODE() AS ?topology)
    BIND(BNODE() AS ?alignment)
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MapTaxonomyTableToClass
  a sh:SPARQLRule ;
  rdfs:label "Map an Taxonomy Table to an owl:Class subclass of skos:Concept" ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
  ?euri a owl:Class , sh:NodeShape;
           rdfs:subClassOf skos:Concept ;
           rdfs:label ?ename ;
           skos:prefLabel ?ename ;
           rdbs:fromTable ?table.
}
WHERE {
   $this rdfs:label ?ename.
   OPTIONAL { $this rdbs:hasEntityLocalName ?lname.}
   rdbs:target sh:namespace ?namespace ; sh:prefix ?prefix.
   BIND(rdbs:mintEntityURI(?lname , ?ename , ?namespace) AS ?euri)
   BIND(  $this as ?table )
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MembershipTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents the Membership of an Edge or a Vertice Type to another Vertice Type from the Property Graph."@en ;
  rdfs:label "Membership Table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee edge Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeEdgeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee vertice Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has container vertice Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContainerVerticeIdColumn ;
        ] ;
    ] ;
.
rdbs:MembershipTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Memebership Type Schema Association associates exactly one Container of Type Vertice, and exactly one Containee of Type either Vertice or Edge (see sh:xnone associated to this shape)"@en ;
  rdfs:label "Membership Type Association"@en ;
  rdfs:subClassOf rdbs:GraphSchemaTypeAssociation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:ContainerVerticeType ;
      sh:class rdbs:VerticeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "Container Vertice Type"@en ;
      sh:node rdbs:VerticeType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:xone (
      [
        sh:property [
            a sh:PropertyShape ;
            sh:path rdbs:ContaineeEdgeType ;
            sh:class rdbs:EdgeType ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:name "Containee Edge Type {@en}" ;
            sh:nodeKind sh:IRI ;
          ] ;
      ]
      [
        sh:property [
            a sh:PropertyShape ;
            sh:path rdbs:ContaineeVerticeType ;
            sh:class rdbs:VerticeType ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:name "Containee Vertice Type {@en}" ;
            sh:nodeKind sh:IRI ;
          ] ;
      ]
    ) ;
.
rdbs:MembershipWithType
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the memberships between Vertices and Edges of a property graph."@en ;
  rdfs:label "MembershipWithType"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?vertice_container_join ;
			rdbs:hasJoin ?vertice_containee_join ;
			rdbs:hasJoin ?edge_containee_join .
# The description of the vertice container join element of the topology
    ?vertice_container_join a rdbs:Join ;
			rdbs:hasTopic ?vertice_topic ;
			rdbs:hasForeignKey ?vertice_container_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_vertice_container .
# The description of the vertice containee join element of the topology
    ?vertice_containee_join a rdbs:Join ;
			rdbs:hasTopic ?vertice_topic ;
			rdbs:hasForeignKey ?vertice_containee_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_vertice_containee .
# The description of the edge container join element of the topology
    ?edge_containee_join a rdbs:Join ;
			rdbs:hasTopic ?edge_topic ;
			rdbs:hasForeignKey ?edge_containee_key_label  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select_edge_containee .
# The description of the select vertice container element of the join
	?select_vertice_container a rdbs:Select ;
		rdbs:hasValue ?vertice_column_label ;
		rdbs:hasAlias ?vertice_column_alias .
# The description of the select vertice containee element of the join
	?select_vertice_containee a rdbs:Select ;
		rdbs:hasValue ?vertice_column_label .
# The description of the select edge containee element of the join
	?select_edge_containee a rdbs:Select ;
		rdbs:hasValue ?edge_column_label .
# The description of the table or topic resulting from the join
	?table a rdbs:MembershipWithTypeTable ;
			rdbs:createdWith ?topology ;
			rdfs:label ?output ;
# Adding the key column
		rdbs:hasColumn ?key_column ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_origin_column ;
			rdbs:hasColumn ?copied_vertice_container_column ;
			rdbs:hasColumn ?copied_vertice_containee_column ;
			rdbs:hasColumn ?copied_edge_containee_column .
# Set up copies of the origin columns
	?copied_origin_column rdbs:belongsToTable ?table ;
		?origin_predicate ?origin_object .
# Set up copies of the vertice container columns
	?copied_vertice_container_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:ContainerVerticeColumn ;
		rdfs:label ?vertice_column_alias ;
		?vertice_container_predicate ?vertice_container_object .
# Set up key column
	?key_column a rdbs:PrimaryKeyColumn ;
		rdfs:label \"Key\" ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up copies of the vertice containee columns
	?copied_vertice_containee_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:ContaineeVerticeColumn ;
		?vertice_containee_predicate ?vertice_containee_object .
# Set up copies of the edge containee columns
	?copied_edge_containee_column rdbs:belongsToTable ?table ;
		rdf:type rdbs:ContaineeEdgeColumn ;
		?edge_containee_predicate ?edge_containee_object .
}
WHERE {
# Pattern to match in order to create join topology
    ?this a rdbs:MembershipTable ;
		rdbs:hasColumn ?vertice_container_key ;
		rdbs:hasColumn ?vertice_containee_key ;
		rdbs:hasColumn ?edge_containee_key .
# Create the new description table and its name as the output
	BIND( rdbs:mintGraphTemporaryDescriptionTable( ?this, rdbs:MembershipWithTypeTable ) AS ?output ) .
	BIND( rdbs:createIRIFromString( ?output, \"base\" ) AS ?table ) .
# Filter topologies already processed
	FILTER NOT EXISTS { ?table a rdbs:MembershipWithTypeTable }
# Identify target foreign column
	?vertice_container_key	a rdbs:ContainerVerticeIdColumn .
	?vertice_containee_key	a rdbs:ContaineeVerticeIdColumn .
	?edge_containee_key	a rdbs:ContaineeEdgeIdColumn .
	?vertice_table a rdbs:VerticeWithTypeTable ;
		rdbs:hasColumn ?vertice_column .
	?edge_table a rdbs:EdgeWithTypeTable ;
		rdbs:hasColumn ?edge_column .
	?vertice_column a rdbs:ObjectTypeColumn .
	?edge_column a rdbs:ObjectTypeColumn .
# Find the different columns of the origin topic 
	?this rdfs:label ?origin ;
		rdbs:hasColumn ?origin_column .
# Get the label of the foreign keys
	?vertice_container_key rdfs:label ?vertice_container_key_label .
	?vertice_containee_key rdfs:label ?vertice_containee_key_label .
	?edge_containee_key rdfs:label ?edge_containee_key_label .
# Get the labels of the foreign tables
	?vertice_table rdfs:label ?vertice_topic .
	?edge_table rdfs:label ?edge_topic .
# Get the labels of the foreign columns
	?vertice_column rdfs:label ?vertice_column_label .
	?edge_column rdfs:label ?edge_column_label .
	BIND ( \"complexNodeType\" AS ?vertice_column_alias )
# Get the predicates and objects of the copied columns
	?origin_column ?origin_predicate ?origin_object .
	?vertice_column ?vertice_container_predicate ?vertice_container_object ;
		?vertice_containee_predicate ?vertice_containee_object .
	?edge_column ?edge_containee_predicate ?edge_containee_object .
# Skip the predicates referencing the belonging of the columns
	FILTER (?origin_predicate != rdbs:belongsToTable )
	FILTER (?vertice_container_predicate != rdbs:belongsToTable )
	FILTER (?vertice_container_predicate != rdfs:label )
	FILTER (?vertice_container_predicate != rdf:type )
	FILTER (?vertice_containee_predicate != rdbs:belongsToTable )
	FILTER (?vertice_containee_predicate != rdf:type )
	FILTER (?edge_containee_predicate != rdbs:belongsToTable )
	FILTER (?edge_containee_predicate != rdf:type )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyJoin( ?output ) AS ?topology ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_container_key_label ) ) AS ?vertice_container_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_containee_key_label ) ) AS ?vertice_containee_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?edge_topic, \"-on-\", ?edge_containee_key_label ) ) AS ?edge_containee_join ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_container_key_label ), ?vertice_column_label, ?vertice_column_alias ) AS ?select_vertice_container ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?vertice_topic, \"-on-\", ?vertice_containee_key_label ), ?vertice_column_label ) AS ?select_vertice_containee ) .
	BIND ( rdbs:mintTopologyJoin( ?output, CONCAT( ?edge_topic, \"-on-\", ?edge_containee_key_label ), ?edge_column_label ) AS ?select_edge_containee ) .
# Create the Key Column
	BIND ( rdbs:mintKeyColumn(?output) AS ?key_column )
# Create the different columns that are copies of the origin columns
	BIND (rdbs:mintCopyOfColumn(?origin_column, ?output) AS ?copied_origin_column) .
# Create the different columns that are copies of the foreign columns
	BIND (rdbs:mintCopyOfColumn(?vertice_column, ?output, ?vertice_column_alias) AS ?copied_vertice_container_column) .
	BIND (rdbs:mintCopyOfColumn(?vertice_column, ?output) AS ?copied_vertice_containee_column) .
	BIND (rdbs:mintCopyOfColumn(?edge_column, ?output) AS ?copied_edge_containee_column) .
}""" ;
  sh:deactivated false ;
  sh:order "6"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:MembershipWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table with the Memberships between the Vertices and the Edges of a Property Graph."@en ;
  rdfs:label "Membership With Type Table."@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee edge Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeEdgeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee edge column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeEdgeColumn ;
        ] ;
      sh:qualifierMinCount 1 ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee vertice Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee vertice column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeVerticeColumn ;
        ] ;
      sh:qualifierMinCount 1 ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has container vertice Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContainerVerticeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has container vertice column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContainerVerticeColumn ;
        ] ;
      sh:qualifierMinCount 1 ;
    ] ;
.
rdbs:MergeTable
  a sh:SPARQLRule ;
  rdfs:label "Merge a table into another." ;
  sh:construct """
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
CONSTRUCT {
    ?topology a rdbs:Topology;
        rdbs:topic ?origin ;
        rdbs:relation ?relation ;
        rdbs:groupby ?groupby ;
        rdbs:collect [
           rdbs:value ?collect ;
           rdbs:as ?fieldname ;
           rdbs:extendTable ?entity ;
           rdbs:property ?puri ;
        ]  ;
        rdbs:generatedBy rdbs:MergeTable ;
        .
}
WHERE {
   $this a rdbs:EntityTable ;
         rdfs:label ?origin .
   ?oentity a rdbs:PropertyTable  ;
         rdfs:label ?relation ;
         rdbs:hasColumn [
              a rdbs:ForeignKeyColumn , rdbs:PrimaryKeyColumn ;
              rdbs:refersToPrimaryKey [
                 rdbs:belongsToTable $this
              ];
              rdfs:label ?groupby
         ] ;
         rdbs:hasColumn ?column .
   ?column a rdbs:Column ;
                rdfs:label ?collect;
   .
   OPTIONAL { ?column rdbs:hasPropertyLocalName ?plname.}
   BIND( IF(BOUND(?plname),?plname , ?collect) AS ?fieldname)
   BIND(BNODE() AS ?topology)
   BIND($this AS ?entity)
}""" ;
  sh:deactivated true ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:NonKeyJoinOneHop
  a sh:SPARQLRule ;
  rdfs:label "Non-key join to a foreign column which does require one intermediate topic." ;
  sh:construct """
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>

CONSTRUCT {
    ?topology1 a owl:Thing;
        rdbs:topic ?origin ;
        rdbs:join ?join ;
        rdbs:fk ?fk ;
        rdbs:select [rdbs:value ?select];
        .
}
WHERE {
  ?a1 a rdbs:ForeignColumn ;
  rdbs:belongsToTable $this ;
  rdbs:belongsToTable/rdfs:label ?label_a ;
  rdbs:viaForeignKeyColumn ?a2 ;
  rdbs:hasForeignColumn ?b1 .
  ?b1 a rdbs:ForeignColumn ;
  rdbs:belongsToTable/rdfs:label ?label_b ;
  rdbs:viaForeignKeyColumn ?b2 ;
  rdbs:hasForeignColumn ?c1 .
  NOT EXISTS { ?c1 a rdbs:ForeignColumn . }
  ?c1 rdbs:belongsToTable/rdfs:label ?label_c .
  BIND(BNODE() AS ?topology1)
  BIND(BNODE() AS ?topology2)

}""" ;
  sh:deactivated true ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:ObjectIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of an Object (Vertice or Edge) of the Property Graph."@en ;
  rdfs:label "Object Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ObjectPropertyColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column mapping to an Object Property of the Graph Ontology."@en ;
  rdfs:label "Object Property Column"@en ;
  rdfs:subClassOf rdbs:PropertyColumn ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasObjectSemanticName ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has object semantic name {@en}" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasSemanticName ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has semantic name {@en}" ;
    ] ;
.
rdbs:ObjectTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents an Object (Vertice or Edge) of the Property Graph."@en ;
  rdfs:label "Object Table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeIdColumn ;
        ] ;
    ] ;
.
rdbs:ObjectTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the name of the Object Types of the Property Graph."@en ;
  rdfs:label "Object Type Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:ObjectTypeIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of an Object Type of the Property Graph."@en ;
  rdfs:label "Object Type Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:ObjectTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that contains the Type of the Objects (Edges and Vertices) of the Property Graph."@en ;
  rdfs:label "Object Type Table"@en ;
  rdfs:subClassOf rdbs:TypeTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeColumn ;
        ] ;
    ] ;
.
rdbs:ObjectWithType
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the objects of a property graph (either its vertices or edges) and their associated classes."@en ;
  rdfs:label "ObjectWithType"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?join .
# The description of the join element of the topology
    ?join a rdbs:Join ;
			rdbs:hasTopic ?foreign_topic ;
			rdbs:hasForeignKey ?fk  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select .
# The description of the select element of the join
	?select a rdbs:Select ;
			rdbs:hasValue ?selected_property_label ;
			rdbs:hasAlias ?selected_property_alias .
# The description of the table or topic resulting from the join
	?table a ?output_type ;
			rdbs:createdWith ?topology ;
			rdfs:label ?output ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_origin_column ;
			rdbs:hasColumn ?copied_foreign_column .
# Set up copies of the origin columns
	?copied_origin_column rdbs:belongsToTable ?table ;
		?origin_predicate ?origin_object .
# Set up copies of the foreign columns
	?copied_foreign_column a rdbs:ClassifyingColumn ;
		rdbs:belongsToTable ?table ;
		?foreign_predicate ?foreign_object ;
		rdfs:label ?selected_property_alias .
}
WHERE {
# Define the valid object types to match
	VALUES (?origin_type ?output_type) {
		( rdbs:EdgeTable rdbs:EdgeWithTypeTable )
		( rdbs:VerticeTable rdbs:VerticeWithTypeTable )
	}
# Get the pattern to match in order to create the new table
	?this a ?origin_type ;
		rdbs:hasColumn ?foreign_key_column .
# Create the new description table and its name as the output
	BIND(rdbs:mintGraphTemporaryDescriptionTable(?this, rdbs:ObjectWithTypeTable) AS ?output) .
	BIND(rdbs:createIRIFromString(?output, \"base\") AS ?table) .
# Filter topologies already processed
	FILTER NOT EXISTS {?table a ?output_type}
# Identify the target foreign column
	?foreign_key_column a rdbs:ObjectTypeIdColumn .
	?foreign_table a rdbs:ObjectTypeTable ;
		rdbs:hasColumn ?selected_property .
	?selected_property a rdbs:ObjectTypeColumn .
# Find the different columns of the origin topic 
	?this rdfs:label ?origin ;
		rdbs:hasColumn ?origin_column .
# Get the different objects for the predicates of our constructed nodes
	?foreign_key_column rdfs:label ?fk .
	?foreign_table rdfs:label ?foreign_topic .
	?selected_property rdfs:label ?selected_property_label .
# Get the predicates and objects of the copied columns
	?origin_column ?origin_predicate ?origin_object .
	?selected_property ?foreign_predicate ?foreign_object .
# Filter the label of the foreign column since it is renamed
	FILTER (?origin_predicate != rdbs:belongsToTable )
	FILTER (?foreign_predicate != rdbs:belongsToTable )
	FILTER (?foreign_predicate != rdfs:label )
# Create the new name of the selected property
 	BIND(CONCAT(REPLACE(?origin, \"s\", \"\"), \"Type\") AS ?selected_property_alias) .
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyJoin(?output) AS ?topology) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic) AS ?join) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic, ?selected_property_label, ?selected_property_alias) AS ?select) .
# Create the different columns that are copies of the origin columns
	BIND (rdbs:mintCopyOfColumn(?origin_column, ?output) AS ?copied_origin_column) .
# Create the different columns that are copies of the foreign columns
	BIND (rdbs:mintCopyOfColumn(?selected_property, ?output) AS ?copied_foreign_column) .
}""" ;
  sh:deactivated false ;
  sh:order "1"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:ObjectWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table containing the Edges of the Property Graph and their associated Object Types."@en ;
  rdfs:label "Description Table containing the Objects of the Property Graph and their associated Object Types."@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeColumn ;
        ] ;
    ] ;
.
rdbs:OneToManyRelationship
  a sh:SPARQLRule ;
  rdfs:label "One to many relationship" ;
  sh:construct """
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>

CONSTRUCT {
    ?topology a rdbs:Topology;
        rdbs:topic ?origin ;
        rdbs:relation ?relation ;
        rdbs:groupby ?groupby ;
        rdbs:classifier ?classifier ;
        rdbs:collect [
          rdbs:value ?collect ;
          rdbs:as ?relation ;
          rdbs:classifyingValuesFrom ?ccolumn ;
          rdbs:extendTable ?oentity
        ] ;
        rdbs:generatedBy rdbs:OneToManyRelationship ;
        .
}
WHERE {
  $this rdbs:hasColumn [
           a rdbs:ForeignKeyColumn ;
              rdbs:refersToPrimaryKey ?epk;
              rdfs:label ?groupby
         ] ,
         [
           a rdbs:PrimaryKeyColumn ;
              rdfs:label ?collect
         ];
         rdfs:label ?relation .
   ?oentity a rdbs:EntityTable  ;
         rdbs:hasColumn ?epk ;
         rdfs:label ?origin .
  FILTER NOT EXISTS {
    $this rdbs:inhibitRelationTo ?oentity
   }

  OPTIONAL
  {
    ?pc a rdbs:PropertyClassification;
           rdbs:hasClassifyingTable $this ;
           rdbs:hasClassifyingColumn ?ccolumn.
    ?ccolumn   rdbs:belongsToTable ?oentity ;
                      rdfs:label ?classifier .
  }
  BIND(BNODE() AS ?topology)
  BIND($this AS ?entity)
}""" ;
  sh:deactivated false ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:Ontology
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Ontology in the Schema of a Graph"@en ;
  rdfs:label "Ontology"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:OntologyColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Ontology where a source Vertice has a relation with a target Vertice as an Annotation."@en ;
  rdfs:label "Ontology Column "@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:OntologyIdColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the id of the Ontology Type of a Membership."@en ;
  rdfs:label "Ontology Vertice Id Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:OuterJoin
  a rdbs:JoinKind ;
  rdfs:comment "A SQL Outer Join."@en ;
  rdfs:label "OuterJoin"@en ;
.
rdbs:ParameterAggregateAggregate
  a owl:DatatypeProperty ;
  rdfs:comment "The name of the Aggregate operation of a Topology."@en ;
  rdfs:label "Aggregate Aggregate"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterAggregateAlias
  a owl:DatatypeProperty ;
  rdfs:comment "The alias for the value(s) that are used to group columns in an Aggregate Operation of a Topology."@en ;
  rdfs:label "Aggregate Alias"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterAggregateAs
  a owl:DatatypeProperty ;
  rdfs:comment "The Alias of a selected Value in an Aggregate Operation of a Topology."@en ;
  rdfs:label "Aggregate As"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterAggregateCollect
  a owl:DatatypeProperty ;
  rdfs:comment "The Columns to collect in the group by of an Aggregate Operation of a Topology."@en ;
  rdfs:label "Aggregate Collect"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterAggregateGroupBy
  a owl:DatatypeProperty ;
  rdfs:comment "The Values that are used to group Columns in the Aggregate Operation of a Topology."@en ;
  rdfs:label "Aggregate Group By"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterAggregateTopology
  a owl:DatatypeProperty ;
  rdfs:comment "The name of the aggregate operation of a Topology which the function should create the IRI."@en ;
  rdfs:label "Aggregate Topology"@en ;
  rdfs:range rdbs:Topology ;
.
rdbs:ParameterClassifier
  a owl:DatatypeProperty ;
  rdfs:comment "The Classifier used to create the second par of the Column IRI."@en ;
  rdfs:label "Parameter Classifier"@en ;
.
rdbs:ParameterColumn
  a owl:ObjectProperty ;
  rdfs:comment "A column which label, semantic name or property should be used to mint an IRI."@en ;
  rdfs:label "A Column "@en ;
.
rdbs:ParameterIRI
  a owl:DatatypeProperty ;
  rdfs:comment "The IRI of an element from the ontology that is used to mint a new IRI."@en ;
  rdfs:label "Any IRI "@en ;
  rdfs:range xsd:anyURI ;
.
rdbs:ParameterIRILocalName
  a owl:DatatypeProperty ;
  rdfs:comment "The local name (String) of an IRI, to provide to a function that mints IRIs."@en ;
  rdfs:label "Local Name of an IRI "@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterIRIPrefix
  a owl:DatatypeProperty ;
  rdfs:comment "The Prefix of an IRI that should be a declared prefix (sh:prefix declared with a namespace in a sh:declare)."@en ;
  rdfs:label "Prefix of an IRI"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterIRISuffix
  a owl:DatatypeProperty ;
  rdfs:comment "A Suffix to an IRI's local name."@en ;
  rdfs:label "IRI Suffix"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterInputTable
  a owl:ObjectProperty ;
  rdfs:comment "A table that is the origin topic of a topology, used to mint an IRI."@en ;
  rdfs:label "An Input Table"@en ;
.
rdbs:ParameterJoinAs
  a owl:DatatypeProperty ;
  rdfs:comment "The Alias of a value selected in a Join Operation of a Topology."@en ;
  rdfs:label "Join As"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterJoinJoin
  a owl:DatatypeProperty ;
  rdfs:comment "The name of the join that joins to Table through a Join Operation of a Topology."@en ;
  rdfs:label "Join Join"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterJoinSelect
  a owl:DatatypeProperty ;
  rdfs:comment "Column that is selected to be part of the Output Description Table of a Join Operation of a Topology."@en ;
  rdfs:label "Join Select"@en ;
  rdfs:range xsd:string ;
.
rdbs:ParameterJoinTopology
  a owl:DatatypeProperty ;
  rdfs:comment "The name of the join operation of a Topology which the function should create the IRI."@en ;
  rdfs:label "Join Topology"@en ;
  rdfs:range rdbs:Topology ;
.
rdbs:ParameterOutputTable
  a owl:ObjectProperty ;
  rdfs:comment "A Table that is created by the set of operations of a Topology, used to mint an IRI."@en ;
  rdfs:label "An Output Table"@en ;
.
rdbs:ParameterRelationAs
  a owl:DatatypeProperty ;
  rdfs:label "" ;
.
rdbs:ParameterRelationCollect
  a owl:DatatypeProperty ;
  rdfs:label "" ;
.
rdbs:ParameterRelationGroupBy
  a owl:DatatypeProperty ;
  rdfs:label "" ;
.
rdbs:ParameterRelationRelation
  a owl:DatatypeProperty ;
  rdfs:label "" ;
.
rdbs:ParameterRelationTopology
  a owl:DatatypeProperty ;
  rdfs:comment "The name of the relation operation of a Topology which the function should create the IRI."@en ;
  rdfs:label "Relation Topology"@en ;
  rdfs:range rdbs:Topology ;
.
rdbs:ParameterTable
  a owl:ObjectProperty ;
  rdfs:comment "A Table which label, semantic name or property is used to mint an IRI."@en ;
  rdfs:label "A Table "@en ;
.
rdbs:ParameterValue
  a owl:ObjectProperty ;
  rdfs:comment "The Value used to create the second part of the Column IRI."@en ;
  rdfs:label "Parameter Value"@en ;
.
rdbs:PrimaryKeyColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column defined from a Primary Key Constraint that identifies a single, non-null value for any instance of the table."@en ;
  rdfs:label "Primary key column"@en ;
  rdfs:subClassOf rdbs:Column ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:refersToColumn ;
      sh:class rdbs:Column ;
    ] ;
  sh:property [
      sh:path rdbs:isNullable ;
      sh:hasValue false ;
    ] ;
.
rdbs:PropertyClassification
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "All classifying columns must belong to the same table, that table would be one part of the join."@en ;
  rdfs:label "Property classification"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasClassifyingColumn ;
      sh:class rdbs:Column ;
      sh:minCount 1 ;
      sh:name "has classifying column" ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasClassifyingTable ;
      sh:class rdbs:Table ;
      sh:maxCount 2 ;
      sh:minCount 1 ;
      sh:name "has classifying table" ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:PropertyColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "The Columns of a CBE that are mapped to Properties."@en ;
  rdfs:label "Property Column "@en ;
  rdfs:subClassOf rdbs:Column ;
.
rdbs:PropertyTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "Property table" ;
  rdfs:subClassOf rdbs:EntityRelationTable ;
.
rdbs:ProxyOntologyRulesShape
  a sh:NodeShape ;
  rdfs:label "Proxy ontology rules shape" ;
.
rdbs:ProxyTaxonomyShape
  a sh:NodeShape ;
  rdfs:label "Proxy taxonomy shape" ;
  sh:order "1"^^xsd:decimal ;
  sh:rule rdbs:MapColumnToDatatypeProperty ;
  sh:rule rdbs:MapForeignKeyColumnToObjectProperty ;
  sh:rule rdbs:MapTaxonomyTableToClass ;
  sh:targetClass rdbs:TaxonomyTable ;
.
rdbs:Relation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "A Relation Join between two Tables. "@en ;
  rdfs:subClassOf rdbs:TopologyOperation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasCollect ;
      sh:class rdbs:Collect ;
      sh:minCount 1 ;
      sh:name "has collect" ;
      sh:node rdbs:Collect ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasGroupBy ;
      sh:class rdbs:GroupBy ;
      sh:minCount 1 ;
      sh:name "has group by" ;
      sh:node rdbs:GroupBy ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasTopic ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has topic" ;
    ] ;
.
rdbs:RelationshipTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A link table will not yield an entity in itself but will relate two other entities instead."@en ;
  rdfs:label "Link table"@en ;
  rdfs:subClassOf rdbs:EntityRelationTable ;
.
rdbs:STRING
  a rdbs:DataType ;
  rdfs:label "STRING" ;
.
rdbs:Select
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Select operation for Topologies."@en ;
  rdfs:label "Select"@en ;
  rdfs:subClassOf rdbs:TopologyOperation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAlias ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:name "has alias" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasValue ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
    ] ;
.
rdbs:SourceCBE
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a CBE Table containing the Sources of the Property Graph as Concise Bounded Entities."@en ;
  rdfs:label "Source CBE"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?source_join .
# The description of the membership join element of the topology
    ?source_join a rdbs:Join ;
			rdbs:hasTopic ?remaining_topic ;
			rdbs:hasKind rdbs:OuterJoin .
# The description of the table or topic resulting from the join
	?table a rdbs:SourceCBETable ;
			rdbs:createdWith ?topology ;
			rdfs:label \"Source\" ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_source_id_column ;
			rdbs:hasColumn ?copied_object_id_column ;
			rdbs:hasColumn ?dynamic_attribute_type_column .
# Set up Typed Attribute Value Per Attribute Type Columns
	?dynamic_attribute_type_column a rdbs:TypedAttributeValuePerAttributeTypeColumn ;
		a rdbs:DataPropertyColumn ;
		rdfs:label ?dynamic_attribute_type_column_label ;
		rdbs:hasSemanticName ?attribute_type_label ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType ?dynamic_attribute_type_column_data_type ;
		rdbs:isNullable true .
# Set up the copied columns
	?copied_source_id_column rdbs:belongsToTable ?table ;
		?source_id_predicate ?source_id_object .
	?copied_object_id_column rdbs:belongsToTable ?table ;
		?object_id_predicate ?object_id_object .
}
WHERE {
?this a owl:Ontology .
# Get one of the typed edges attribute value per attribute type table at random
	{
		SELECT ?target
		WHERE {
			?target a rdbs:TypedEdgeValuePerAttributeTypeTable .
		} LIMIT 1
	}
# Get label of table
	?target rdfs:label ?origin .
# Mint table
	?edge_table a rdbs:EdgeTable ;
		rdfs:label ?edge_label .
	BIND ( rdbs:mintGraphCBEDescriptionTable( ?edge_label, rdbs:SourceCBETable ) AS ?output ) .
	BIND( rdbs:createIRIFromString( ?output, \"base\" ) AS ?table ) .
	FILTER NOT EXISTS {?table a rdbs:SourceCBETable}
# Mint topology
	BIND ( rdbs:mintTopologyJoin(?output) AS ?topology  )
# Get static data from that table
	?target rdbs:hasColumn ?source_id_column .
	?source_id_column a rdbs:PrimaryKeyColumn ;
		?source_id_predicate ?source_id_object .
	FILTER ( ?source_id_predicate != rdbs:belongsToTable )
	?target rdbs:hasColumn ?object_id_column .
	?object_id_column a rdbs:ObjectIdColumn ;
		?object_id_predicate ?object_id_object .
	FILTER ( ?object_id_predicate != rdbs:belongsToTable )
# Create copies of static data
	BIND ( rdbs:mintCopyOfColumn( ?source_id_column, ?output ) AS ?copied_source_id_column ) .
	BIND ( rdbs:mintCopyOfColumn( ?object_id_column, ?output ) AS ?copied_object_id_column ) .
# Get remaining tables
	?other a rdbs:TypedEdgeValuePerAttributeTypeTable .
	FILTER (?target != ?other)
# Get label
	?other rdfs:label ?remaining_topic .
# Create a join
	BIND ( rdbs:mintTopologyJoin(?output, ?remaining_topic) AS ?source_join  ) 
# Get the associated Vertice Type Associations and mint related IRIs
	?edge_type_association a rdbs:EdgeAttributeTypeAssociation ;
		rdbs:hasAttributeType ?attribute_type ;
		rdbs:hasAttributeDataType ?attribute_data_type .
	?attribute_type rdfs:label ?attribute_type_label .
	?attribute_data_type rdfs:label ?attribute_data_type_label .
# Find Associated Data Type
	?typed_attribute_value_table a rdbs:EdgeTypedAttributeValueTable ;
		rdbs:hasColumn [
			a rdbs:TypedAttributeValueColumn ;
			rdfs:label ?attribute_data_type_label ;
			rdbs:hasDataType ?dynamic_attribute_type_column_data_type 
		] .
# Create the Attribute Type columns
	BIND ( rdbs:mintClassifiedColumn(?output, ?attribute_data_type_label, ?attribute_type ) AS ?dynamic_attribute_type_column )
# Create the Attribute Type column labels
	BIND ( rdbs:mintClassifiedColumnLabel(?attribute_data_type_label, ?attribute_type ) AS ?dynamic_attribute_type_column_label )
}""" ;
  sh:deactivated false ;
  sh:order "11"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:SourceCBETable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents a Concise Bounded Entity of an Edge of a given Source from the Property Graph."@en ;
  rdfs:label "Source CBE Table"@en ;
  rdfs:subClassOf rdbs:GraphCBE ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:description "an ObjectIdColumn that contains the ID of the related Edges."@en ;
      sh:name "Object Id Column. {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
.
rdbs:SourceVerticeIdPerVerticeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Id of source Vertices of an Annotation of the Property Graph, of a specific Vertice Type."@en ;
  rdfs:label "Source Vertice Id Per Vertice Type Column"@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:Subentity
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Implement the subentity generation in a table to implement the \"evaluation patterns in ChEMBL and RMC\"."@en ;
  rdfs:label "Subentity"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasParticipatingColumn ;
      sh:class rdbs:Column ;
      sh:minCount 1 ;
      sh:name "has participating column" ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasSubentityType ;
      sh:class owl:Class ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has subentity type" ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:Table
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Logical structure of an RDBMS that is an abstraction of how the data is physically stored."@en ;
  rdfs:label "Table"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdfs:label ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:class rdbs:Column ;
      sh:minCount 1 ;
    ] ;
.
rdbs:TagRulesShape
  a sh:NodeShape ;
  rdfs:comment "Automating the tagging of database items"@en ;
  rdfs:label "Tag Rules Shape"@en ;
.
rdbs:TagSchemaIdColumns
  a sh:SPARQLRule ;
  rdfs:comment "Adding their specific IdColumn Class to all Primary Keys and Foreign Keys columns that can be automatically identified"@en ;
  rdfs:label "Tag Schema Id Columns "^^rdf:langString ;
  sh:construct """PREFIX rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# ObjectIdColumns
	?object_id_column_pk a rdbs:ObjectIdColumn .
	?object_id_column_fk a rdbs:ObjectIdColumn .
# AttributeIdColumns
	?attribute_id_column_pk a rdbs:AttributeIdColumn .
	?attribute_id_column_fk a rdbs:AttributeIdColumn .
# ObjectTypeIdColumns
	?object_typed_id_column_pk a rdbs:ObjectTypeIdColumn .
	?object_typed_id_column_fk a rdbs:ObjectTypeIdColumn .
# AttributeTypedIdColumns
	?attribute_typed_id_column_pk a rdbs:AttributeTypeIdColumn .
	?attribute_typed_id_column_fk a rdbs:AttributeTypeIdColumn .
# DictionaryIdColumns
	?dictionary_id_column_pk a rdbs:DictionaryIdColumn .
	?dictionary_id_column_fk a rdbs:DictionaryIdColumn .
}
WHERE {
# Values
VALUES ?object_table {rdbs:EdgeTable rdbs:VerticeTable}
VALUES ?attribute_table {rdbs:EdgeAttributeTable rdbs:VerticeAttributeTable}
VALUES ?typed_attribute_value_table {rdbs:EdgeTypedAttributeValueTable rdbs:VerticeTypedAttributeValueTable}
# Primary Key Query
	?object_id_column_pk a rdbs:PrimaryKeyColumn ;
		rdbs:belongsToTable/a ?object_table .
	?attribute_id_column_pk a rdbs:PrimaryKeyColumn ;
		rdbs:belongsToTable/a ?attribute_table .
	?object_typed_id_column_pk a rdbs:PrimaryKeyColumn ;
		rdbs:belongsToTable/a rdbs:ObjectTypeTable .
	?attribute_typed_id_column_pk a rdbs:PrimaryKeyColumn ;
		rdbs:belongsToTable/a rdbs:AttributeTypeTable .
	?dictionary_id_column_pk a rdbs:PrimaryKeyColumn ;
		rdbs:belongsToTable/a rdbs:DictionaryTable .
# Foreign Key Query (restricted to our current scope of Resnet)
	?object_id_column_fk rdbs:refersToPrimaryKey ?object_id_column_pk ;
		rdbs:belongsToTable/a ?attribute_table .
	?attribute_id_column_fk rdbs:refersToPrimaryKey ?attribute_id_column_pk ;
		rdbs:belongsToTable/a ?typed_attribute_value_table .
	?object_typed_id_column_fk rdbs:refersToPrimaryKey ?object_typed_id_column_pk ;
		rdbs:belongsToTable/a ?object_table .
	?attribute_typed_id_column_fk rdbs:refersToPrimaryKey ?attribute_typed_id_column_pk ;
		rdbs:belongsToTable/a ?attribute_table .
	?dictionary_id_column_fk rdbs:refersToPrimaryKey ?dictionary_id_column_pk ;
		rdbs:belongsToTable/a ?typed_attribute_value_table .
}""" ;
  sh:deactivated false ;
  sh:order "0"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:TargetVerticeIdPerVerticeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Id of source Vertices of an Annotation of the Property Graph, of a specific Vertice Type."@en ;
  rdfs:label "Ontology Column "@en ;
  rdfs:subClassOf rdbs:IdColumn ;
.
rdbs:TaxonomyTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "Taxonomy table" ;
  rdfs:subClassOf rdbs:EntityRelationTable ;
.
rdbs:TemporaryTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Description Table that represents an intermediary step between the raw tables of the Property Graph and the Concise Bounded Entity derived from them."@en ;
  rdfs:label "Temporary table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:description "a TypedAttributeValuePerAttributeTypeColumn that has the same Attribute Data Type as the Table."@en ;
      sh:name "All Temporary Tables should have a Primary Key Column. {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:PrimaryKeyColumn ;
        ] ;
    ] ;
.
rdbs:Topology
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Set of operations leading to the creation of a new Table."@en ;
  rdfs:label "Topology"@en ;
  rdfs:subClassOf owl:Thing ;
  sh:or (
      [
        sh:property [
            a sh:PropertyShape ;
            sh:path rdbs:hasAggregate ;
            sh:class rdbs:Aggregate ;
            sh:name "has aggregate" ;
            sh:nodeKind sh:IRI ;
          ] ;
      ]
      [
        sh:property [
            a sh:PropertyShape ;
            sh:path rdbs:hasJoin ;
            sh:class rdbs:Join ;
            sh:name "has join" ;
            sh:nodeKind sh:IRI ;
          ] ;
      ]
      [
        sh:property [
            a sh:PropertyShape ;
            sh:path rdbs:hasRelation ;
            sh:class rdbs:Relation ;
            sh:name "has relation" ;
            sh:nodeKind sh:IRI ;
          ] ;
      ]
    ) ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasOutput ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has output" ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasTopic ;
      sh:datatype xsd:string ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has topic" ;
    ] ;
.
rdbs:TopologyOperation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Single operation that is part of a Topology."@en ;
  rdfs:label "Topology Operation"@en ;
  rdfs:subClassOf owl:Thing ;
.
rdbs:TopologyRulesShape
  a sh:NodeShape ;
  rdfs:comment """RulesShape represent shapes that only contains rules as opposed to Constraints Shapes. 
This the Topology SuperRuleShape of the Abstraction Specific Topology RulesShape
As a superShape it does not contain rules, it serve the purpose of knowledge organization.
Note there is no inferencing between nodeShape, neither instance of node shape. Should not be confused with Shacl Class which are target of shape including the implicit Shacl Class.
Hence this is purely for ontology organization purpose"""@en ;
.
rdbs:TypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that contains the Type of an element of the Property Graph."@en ;
  rdfs:label "Type Table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
.
rdbs:TypedAttributeValueColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Attribute Values of a specific AttributeDataType."@en ;
  rdfs:label "Attribute Value Column"@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:TypedAttributeValuePerAttributeTypeColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column containing the Values of a specific Type of Attribute."@en ;
  rdfs:label "Typed Attribute Value Per Attribute Type Column "@en ;
  rdfs:subClassOf rdbs:ValueColumn ;
.
rdbs:TypedAttributeValuePerAttributeTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Typed Table containing the Attribute Values of each Attribute Type of a specific Attribute DataType."@en ;
  rdfs:label "Typed Attribute Value Per Attribute Table"@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:description "a TypedAttributeValuePerAttributeTypeColumn that has the same Attribute Data Type as the Table."@en ;
      sh:name "typed attribute value per attribute type Column. {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:TypedAttributeValuePerAttributeTypeColumn ;
        ] ;
    ] ;
.
rdbs:TypedAttributeValueTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that contains the Attribute Values of a specific AttributeDataType of the Property Graph."@en ;
  rdfs:label "Typed Attribute Value Table"@en ;
  rdfs:subClassOf rdbs:GraphTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has dictionary Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:DictionaryIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has typed attribute value column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:TypedAttributeValueColumn ;
        ] ;
    ] ;
.
rdbs:TypedAttributeValueWithTypeWithIdObject
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the attributes of a property graph, their values, their associated classes and a pointer to their associated objects."@en ;
  rdfs:label "Typed Attribute Value With Type With ID Object"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?join .
# The description of the join element of the topology
    ?join a rdbs:Join ;
			rdbs:hasTopic ?foreign_topic ;
			rdbs:hasForeignKey ?fk  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?object ;
			rdbs:hasSelect ?property .
# The description of the select element of the join
	?object a rdbs:Select ;
			rdbs:hasValue ?object_column_label .
	?property a rdbs:Select ;
			rdbs:hasValue ?property_column_label .
# The description of the table or topic resulting from the join
	?table a ?output_type ;
			rdbs:createdWith ?topology ;
			rdfs:label ?output ;
# Adding Attribute Data Type
#			rdbs:hasAttributeDataType ?attribute_data_type ;
# Adding the key column
		rdbs:hasColumn ?key_column ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_origin_column ;
			rdbs:hasColumn ?copied_object_column ;
			rdbs:hasColumn ?copied_property_column .
# Set up key column
	?key_column a rdbs:PrimaryKeyColumn ;
		rdfs:label \"Key\" ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up copies of the origin columns
	?copied_origin_column rdbs:belongsToTable ?table ;
		?origin_predicate ?origin_object .
# Set up copies of the foreign columns
	?copied_object_column rdbs:belongsToTable ?table ;
		?object_predicate ?object_object .
# Set up copies of the foreign columns
	?copied_property_column rdbs:belongsToTable ?table ;
		?property_predicate ?property_object .
}
WHERE {
# Define the valid object types to match
	VALUES (?origin_type ?foreign_type ?output_type) {
		( rdbs:EdgeTypedAttributeValueTable rdbs:EdgeAttributeWithTypeTable  rdbs:TypedEdgeAttributeValueWithTypeWithIdObjectTable )
		( rdbs:VerticeTypedAttributeValueTable rdbs:VerticeAttributeWithTypeTable rdbs:TypedVerticeAttributeValueWithTypeWithIdObjectTable )
	}
# Pattern to match in order to create join topology
    ?this a ?origin_type ;
		rdbs:hasColumn ?foreign_key_column ;
#		rdbs:hasAttributeDataType ?attribute_data_type .
# Create the new description table and its name as the output
	BIND(rdbs:mintGraphTemporaryDescriptionTable(?this, rdbs:TypedAttributeValueWithTypeWithIdObjectTable) AS ?output) .
	BIND(rdbs:createIRIFromString(?output, \"base\") AS ?table) .
# Filter topologies already processed
    FILTER NOT EXISTS { ?table a ?output_type }
# Identify target foreign columns
    ?foreign_key_column a rdbs:AttributeIdColumn .
	?foreign_table a ?foreign_type ;
		rdbs:hasColumn ?object_column ;
		rdbs:hasColumn ?property_column .
# Find property and object columns
	?property_column a rdbs:AttributeTypeColumn .
	?object_column a rdbs:ObjectIdColumn .
# Find the different columns of the origin topic 
	?this rdfs:label ?origin ;
		rdbs:hasColumn ?origin_column .
# Get the different objects for the predicates of our constructed nodes
	?foreign_key_column rdfs:label ?fk .
	?foreign_table rdfs:label ?foreign_topic .
	?object_column rdfs:label ?object_column_label .
	?property_column rdfs:label ?property_column_label .
# Get the predicates and objects of the copied columns
	?origin_column ?origin_predicate ?origin_object .
	?object_column ?object_predicate ?object_object .
	?property_column ?property_predicate ?property_object .
# Filter the label of the foreign column since it is renamed
	FILTER (?origin_predicate != rdbs:belongsToTable )
	FILTER (?object_predicate != rdbs:belongsToTable )
	FILTER (?property_predicate != rdbs:belongsToTable )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyJoin(?output) AS ?topology) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic) AS ?join) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic, ?object_column_label) AS ?object) .
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic, ?property_column_label) AS ?property) .
# Create the Key Column
	BIND ( rdbs:mintKeyColumn(?output) AS ?key_column )
# Create the different columns that are copies of the origin columns
	BIND (rdbs:mintCopyOfColumn(?origin_column, ?output) AS ?copied_origin_column) .
# Create the different columns that are copies of the foreign columns
	BIND (rdbs:mintCopyOfColumn(?object_column, ?output) AS ?copied_object_column) .
	BIND (rdbs:mintCopyOfColumn(?property_column, ?output) AS ?copied_property_column) .
}""" ;
  sh:deactivated false ;
  sh:order "3"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:TypedAttributeValueWithTypeWithIdObjectTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Typed Table containing the Attribute Values of a specific Attribute DataType and the Objects of the Property Graph having these Attributes and Attribute Values ."@en ;
  rdfs:label "Typed Attribute Value With Type With Id Object Table."@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has attribute type column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:AttributeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has dictionary Id column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:DictionaryIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has typed attribute value column"@en ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:TypedAttributeValueColumn ;
        ] ;
    ] ;
.
rdbs:TypedAttributeValueWithTypeWithIdObjectWithDictionary
  a sh:SPARQLRule ;
  rdfs:comment "Adding a dictionary value to the description of an Attribute with Type with ID Object Temporary Table containing a pointer to such values."@en ;
  rdfs:label "Typed Attribute Value With Type With ID Object With Dictionary"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
	?join a rdbs:Join ;
			rdbs:hasTopic ?foreign_topic ;
			rdbs:hasForeignKey ?fk  ;
			rdbs:hasKind rdbs:InnerJoin ;
			rdbs:hasSelect ?select .
	?select a rdbs:Select ;
		rdbs:hasValue ?dictionary_column_label .
	?origin_topology rdbs:hasJoin ?join.
# Adding the copy of the dictionary value column
	?this rdbs:hasColumn ?copied_dictionary_column .
# Set up copies of the dictionary value column
	?copied_dictionary_column rdbs:belongsToTable ?this ;
		?dictionary_predicate ?dictionary_object ;
		rdbs:isCopyOf ?dictionary_column .
}
WHERE {
# Define the valid object types to match
	VALUES ?origin_type { rdbs:TypedEdgeAttributeValueWithTypeWithIdObjectTable rdbs:TypedVerticeAttributeValueWithTypeWithIdObjectTable }
# Match pattern to add dictionary value
	?this a ?origin_type ;
		rdfs:label ?origin_table_label ;
		rdbs:createdWith ?origin_topology ;
		rdbs:hasColumn ?foreign_key_column .
	?foreign_key_column a rdbs:DictionaryIdColumn .
	?dictionary_table a rdbs:DictionaryTable ;
		rdbs:hasColumn ?dictionary_column .
	?dictionary_column a rdbs:DictionaryValueColumn .
# Get the output of the topology
	?origin_topology rdbs:hasOutput ?output .
# Get the attached labels
	?dictionary_table rdfs:label ?foreign_topic .
	?foreign_key_column rdfs:label ?fk .
	?dictionary_column rdfs:label ?dictionary_column_label .
# Create the join with the dictionary table
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic) AS ?join) .
	FILTER NOT EXISTS {?origin_topology rdbs:hasJoin ?join}
# Get the predicates and objects of the copied columns
	?dictionary_column ?dictionary_predicate ?dictionary_object  .
# Filter the label of the foreign column since it is renamed
	FILTER (?dictionary_predicate != rdbs:belongsToTable )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyJoin(?output, ?foreign_topic, ?dictionary_column_label) AS ?select) 
# Create the different columns that are copies of the foreign columns
	BIND (rdbs:mintCopyOfColumn(?dictionary_column, ?origin_table_label) AS ?copied_dictionary_column) .
}""" ;
  sh:deactivated false ;
  sh:order "4"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:TypedEdgeAttributeValueWithTypeWithIdObjectTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Typed Table containing the Attribute Values of a specific Attribute DataType and the Edges of the Property Graph having these Attributes and Attribute Values ."@en ;
  rdfs:label "Edge Attribute With Type With Id Object Table"@en ;
  rdfs:subClassOf rdbs:TypedAttributeValueWithTypeWithIdObjectTable ;
.
rdbs:TypedEdgeValuePerAttributeTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Typed Table containing the Attribute Values of each Edge Attribute Type of a specific Edge Attribute DataType."@en ;
  rdfs:label "Typed Edge Attribute Value Per Attribute Table"@en ;
  rdfs:subClassOf rdbs:TypedAttributeValuePerAttributeTypeTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:description "an ObjectIdColumn that contains the ID of the related Edges."@en ;
      sh:name "Object Id Column. {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
.
rdbs:TypedEdgesAttributeValuePerAttributeType
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the Typed Attribute Values of the Edges of the Property Graph, organized by Attribute Types."@en ;
  rdfs:label "Typed Edge Attribute Value Per Attribute Type"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>
CONSTRUCT {
# The base node to describe topologies of temporary topics
?topology a rdbs:Topology ;
  rdbs:hasOutput ?output ;
  rdbs:hasTopic ?origin ;
  rdbs:hasAggregate ?aggregate .
# The description of the aggregate element of the topology
?aggregate a rdbs:Aggregate ;
  rdbs:hasGroupBy ?group_by_object ;
  rdbs:hasGroupBy ?group_by_index ;
  rdbs:hasAlias ?group_by_alias ;
  rdbs:hasCollect ?collect_object ;
  rdbs:hasCollect ?collect_typed_attribute_value .
# The description of the group by element of the join
?group_by_object a rdbs:GroupBy ;
  rdbs:hasOrder 0 ;
  rdfs:label ?object_column_label .
# The description of the group by element of the join
?group_by_index a rdbs:GroupBy ;
  rdbs:hasOrder 1 ;
  rdfs:label ?index_column_label .
# The description of the collect element of the join
?collect_object a rdbs:Collect ;
  rdbs:hasValue ?object_column_label ;
  rdbs:hasAlias ?object_column_alias .
# The description of the collect element of the join
?collect_typed_attribute_value a rdbs:Collect ;
  rdbs:hasClassifier ?attribute_type_column_label ;
  rdbs:hasValue ?typed_attribute_value_column_label .
# The description of the table or topic resulting from the join
  ?table a rdbs:TypedEdgeValuePerAttributeTypeTable ;
    rdbs:createdWith ?topology ;
    rdfs:label ?output ;
# Adding the key column
    rdbs:hasColumn ?key_column ;
# Adding the Typed Attribute Value Per Attribute Type Columns
    rdbs:hasColumn ?typed_attribute_value_per_attribute_type_column ;
    rdbs:hasColumn ?copied_object_column .
# Set up key column
  ?key_column a rdbs:PrimaryKeyColumn ;
    rdfs:label ?group_by_alias ;
    rdbs:belongsToTable ?table ;
    rdbs:hasDataType rdbs:INT ;
    rdbs:isNullable false .
# Set up Typed Attribute Value Per Attribute Type Columns
  ?typed_attribute_value_per_attribute_type_column a rdbs:TypedAttributeValuePerAttributeTypeColumn ;
    rdfs:label ?typed_attribute_value_per_attribute_type_column_label ;
    rdbs:belongsToTable ?table ;
    rdbs:hasDataType ?column_data_type ;
    rdbs:isNullable true .
# Set up copy of Object Column
  ?copied_object_column rdbs:belongsToTable ?table ;
    rdfs:label ?object_column_alias ;
    ?object_predicate ?object_object .
}
WHERE {
# Pattern to match in order to create join topology
    ?this a rdbs:TypedEdgeAttributeValueWithTypeWithIdObjectTable ;
    rdfs:label ?origin .
# Get the Attribute Type column
  ?this rdbs:hasColumn ?attribute_type_column.
  ?attribute_type_column a rdbs:AttributeTypeColumn ;
      rdfs:label ?attribute_type_column_label .
# Get the Object Type column
  ?this rdbs:hasColumn ?object_column .
  ?object_column a rdbs:ObjectIdColumn ;
      rdfs:label ?object_column_label .
# Get the Index column
  ?this rdbs:hasColumn ?index_column .
  ?index_column a rdbs:IndexValueColumn ;
      rdfs:label ?index_column_label .
# Deal with the two possible typed attribute columns that can be classified
  OPTIONAL { ?this rdbs:hasColumn ?typed_attribute_value_column_non_dict .
  ?typed_attribute_value_column_non_dict a rdbs:TypedAttributeValueColumn . }
  OPTIONAL { ?this rdbs:hasColumn ?typed_attribute_value_column_dict .
  ?typed_attribute_value_column_dict a rdbs:DictionaryValueColumn . }
# Use the selected column (dict if it exists, the other otherwise)
  BIND ( COALESCE( ?typed_attribute_value_column_dict, ?typed_attribute_value_column_non_dict ) AS ?typed_attribute_value_column  )
  ?typed_attribute_value_column  rdfs:label ?typed_attribute_value_column_label ;
      rdbs:hasDataType ?column_data_type .
# Create the new description table and its name as the output
  BIND ( rdbs:mintGraphTemporaryDescriptionTable( ?this, rdbs:TypedEdgeValuePerAttributeTypeTable ) AS ?output ) .
  BIND (rdbs:createIRIFromString(?output, \"base\") AS ?table) .
# Filter topologies already processed
  FILTER NOT EXISTS { ?table a rdbs:TypedEdgeValuePerAttributeTypeTable }
# Create the aliases
  BIND ( \"sourceId\" AS ?group_by_alias ) .
  BIND (  \"controlId\" AS ?object_column_alias ) .
# Create the Key Column
  BIND ( rdbs:mintColumn(?output, ?group_by_alias ) AS ?key_column ) .
# Get object column predicates and objects
  ?object_column ?object_predicate ?object_object .
# Filter label and belonging
  FILTER ( ?object_predicate != rdfs:label && ?object_predicate != rdbs:belongsToTable )
# Find the VerticeAttributeTypeAssociations
  ?edge_attribute_type_association a rdbs:EdgeAttributeTypeAssociation ;
    rdbs:hasAttributeDataType/rdfs:label ?typed_attribute_value_column_label ;
    rdbs:hasAttributeType ?data_type .
  ?data_type rdfs:label ?data_type_label .
# Create the Attribute Type columns
  BIND ( rdbs:mintClassifiedColumn(?output, ?typed_attribute_value_column_label, ?data_type ) AS ?typed_attribute_value_per_attribute_type_column )
# Create the Attribute Type column labels
  BIND ( rdbs:mintClassifiedColumnLabel(?typed_attribute_value_column_label, ?data_type ) AS ?typed_attribute_value_per_attribute_type_column_label )
# Create the different subject nodes for each matched Pattern
  BIND ( rdbs:mintTopologyAggregate(?output) AS ?topology ) .
  BIND ( rdbs:mintTopologyAggregate(?output, \"\", ?group_by_alias ) AS ?aggregate ) .
  BIND ( rdbs:mintTopologyAggregate(?output, \"\", ?group_by_alias, ?object_column_label ) AS ?group_by_object) .
  BIND ( rdbs:mintTopologyAggregate(?output, \"\", ?group_by_alias, ?index_column_label ) AS ?group_by_index) .
  BIND ( rdbs:mintTopologyAggregate(?output, \"\", ?group_by_alias, ?group_by_alias, ?typed_attribute_value_column_label ) AS ?collect_typed_attribute_value ) .
  BIND ( rdbs:mintTopologyAggregate(?output, \"\", ?group_by_alias, ?group_by_alias, ?object_column_label, ?object_column_alias ) AS ?collect_object ) .
# Create the copy of the object column
  BIND ( rdbs:mintCopyOfColumn(?object_column, ?output, ?object_column_alias ) AS ?copied_object_column ) .
}""" ;
  sh:deactivated false ;
  sh:order "5"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:TypedVerticeAttributeValueWithTypeWithIdObjectTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Typed Table containing the Attribute Values of a specific Attribute DataType and the Vertices of the Property Graph having these Attributes and Attribute Values ."@en ;
  rdfs:label "Vertice Attribute With Type With Id Object Table"@en ;
  rdfs:subClassOf rdbs:TypedAttributeValueWithTypeWithIdObjectTable ;
.
rdbs:TypedVerticeValuePerAttributeTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Typed Table containing the Vertice Attribute Values of each Attribute Type of a specific Vertice Attribute DataType."@en ;
  rdfs:label "Typed Vertice Attribute Value Per Attribute Table"@en ;
  rdfs:subClassOf rdbs:TypedAttributeValuePerAttributeTypeTable ;
.
rdbs:TypedVerticesAttributeValuePerAttributeType
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the Typed Attribute Values of the Vertices of the Property Graph, organized by Attribute Types."@en ;
  rdfs:label "Typed Vertice Attribute Value Per Attribute Type"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
?topology a rdbs:Topology ;
	rdbs:hasOutput ?output ;
	rdbs:hasTopic ?origin ;
	rdbs:hasAggregate ?aggregate .
# The description of the aggregate element of the topology
?aggregate a rdbs:Aggregate ;
	rdbs:hasGroupBy ?group_by ;
 	rdbs:hasCollect ?collect .
# The description of the group by element of the join
?group_by a rdbs:GroupBy ;
	rdbs:hasOrder 0 ;
	rdfs:label ?object_column_label .
# The description of the collect element of the join
?collect a rdbs:Collect ;
	rdbs:hasClassifier ?attribute_type_column_label ;
	rdbs:hasValue ?typed_attribute_value_column_label .
# The description of the table or topic resulting from the join
	?table a rdbs:TypedVerticeValuePerAttributeTypeTable ;
		rdbs:createdWith ?topology ;
		rdfs:label ?output ;
# Adding the key column
		rdbs:hasColumn ?key_column ;
# Adding the Typed Attribute Value Per Attribute Type Columns
		rdbs:hasColumn ?typed_attribute_value_per_attribute_type_column .
# Set up key column
	?key_column a rdbs:PrimaryKeyColumn ;
		rdfs:label \"Key\" ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up Typed Attribute Value Per Attribute Type Columns
	?typed_attribute_value_per_attribute_type_column a rdbs:TypedAttributeValuePerAttributeTypeColumn ;
		rdfs:label ?typed_attribute_value_per_attribute_type_column_label ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType ?column_data_type ;
		rdbs:isNullable false .
}
WHERE {
# Pattern to match in order to create join topology
    ?this a rdbs:TypedVerticeAttributeValueWithTypeWithIdObjectTable ;
		rdfs:label ?origin ;
#		rdbs:hasAttributeDataType ?attribute_data_type ;
		rdbs:hasColumn ?attribute_type_column ;
#		rdbs:hasColumn ?typed_attribute_value_column ;
		rdbs:hasColumn ?object_column .
	?attribute_type_column a rdbs:AttributeTypeColumn ;
			rdfs:label ?attribute_type_column_label .
#	?typed_attribute_value_column	a rdbs:TypedAttributeValueColumn ;
#			rdfs:label ?typed_attribute_value_column_label ;
#			rdbs:hasDataType ?column_data_type .
	?object_column a rdbs:ObjectIdColumn ;
			rdfs:label ?object_column_label .
# Deal with the two possible typed attribute columns that can be classified
	OPTIONAL { ?this rdbs:hasColumn ?typed_attribute_value_column_non_dict .
	?typed_attribute_value_column_non_dict a rdbs:TypedAttributeValueColumn . }
	OPTIONAL { ?this rdbs:hasColumn ?typed_attribute_value_column_dict .
	?typed_attribute_value_column_dict a rdbs:DictionaryValueColumn . }
# Use the selected column (dict if it exists, the other otherwise)
	BIND ( COALESCE( ?typed_attribute_value_column_dict, ?typed_attribute_value_column_non_dict ) AS ?typed_attribute_value_column  )
	?typed_attribute_value_column	 rdfs:label ?typed_attribute_value_column_label ;
			rdbs:hasDataType ?column_data_type .
# Create the new description table and its name as the output
	BIND ( rdbs:mintGraphTemporaryDescriptionTable( ?this, rdbs:TypedVerticeValuePerAttributeTypeTable ) AS ?output ) .
	BIND (rdbs:createIRIFromString(?output, \"base\") AS ?table) .
# Filter topologies already processed
	FILTER NOT EXISTS { ?table a rdbs:TypedVerticeValuePerAttributeTypeTable }
# Create the Key Column
	BIND ( rdbs:mintKeyColumn(?output) AS ?key_column )
# Find the VerticeAttributeTypeAssociations
	?vertice_attribute_type_association a rdbs:VerticeAttributeTypeAssociation ;
#		rdbs:hasAttributeDataType ?attribute_data_type ;
		rdbs:hasAttributeDataType/rdfs:label ?typed_attribute_value_column_label ;
		rdbs:hasAttributeType ?data_type .
	?data_type rdfs:label ?data_type_label .
# Create the Attribute Type columns
	BIND ( rdbs:mintClassifiedColumn(?output, ?typed_attribute_value_column_label, ?data_type ) AS ?typed_attribute_value_per_attribute_type_column )
# Create the Attribute Type column labels
	BIND ( rdbs:mintClassifiedColumnLabel(?typed_attribute_value_column_label, ?data_type ) AS ?typed_attribute_value_per_attribute_type_column_label )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyAggregate(?output) AS ?topology ) .
	BIND ( rdbs:mintTopologyAggregate(?output, \"\", \"\" ) AS ?aggregate ) .
	BIND ( rdbs:mintTopologyAggregate(?output, \"\", \"\", ?object_column_label ) AS ?group_by) .
	BIND ( rdbs:mintTopologyAggregate(?output, \"\", \"\", ?object_column_label, ?typed_attribute_value_column_label ) AS ?collect ) .
}""" ;
  sh:deactivated false ;
  sh:order "5"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:ValueColumn
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Column mapping to a value of interest for the Graph Ontology."@en ;
  rdfs:label "Value Column"@en ;
  rdfs:subClassOf rdbs:Column ;
.
rdbs:VerticeAttributeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that identify attributes in a Graph and the Graph Vertice to which the attribute belong"@en ;
  rdfs:label "Vertice Attribute Table"@en ;
  rdfs:subClassOf rdbs:AttributeTable ;
.
rdbs:VerticeAttributeTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Vertice Attribute Type Schema Association associates one Vertice Attribute Type with an AttributeData"@en ;
  rdfs:label "Vertice Attribute Type Association"@en ;
  rdfs:subClassOf rdbs:GraphSchemaTypeAssociation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAttributeDataType ;
      sh:class rdbs:AttributeDataType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Attribute DataType"@en ;
      sh:node rdbs:AttributeDataType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAttributeType ;
      sh:class rdbs:AttributeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Attribute Type"@en ;
      sh:node rdbs:AttributeType ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:VerticeAttributeWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table containing the Attributes of the Property Graph Vertices and their associated Attribute Types."@en ;
  rdfs:label "Vertice Attribute With Type Table "@en ;
  rdfs:subClassOf rdbs:AttributeWithTypeTable ;
.
rdbs:VerticeCBE
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a CBE Table containing each Type of Vertice of the Property Graph as a Concise Bounded Entity."@en ;
  rdfs:label "VerticeCBE"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasJoin ?membership_join ;
			rdbs:hasJoin ?attribute_type_join .
# The description of the membership join element of the topology
    ?membership_join a rdbs:Join ;
			rdbs:hasTopic ?membership_topic ;
			rdbs:hasKind rdbs:LeftJoin .
# The description of the attribute type join element of the topology
    ?attribute_type_join a rdbs:Join ;
			rdbs:hasTopic ?attribute_type_topic ;
			rdbs:hasKind rdbs:LeftJoin .
# The description of the table or topic resulting from the join
	?table a rdbs:VerticeCBETable ;
			rdbs:createdWith ?topology ;
			rdfs:label ?table_label ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_static_membership_column ;
			rdbs:hasColumn ?dynamic_membership_vertice_container_column ;
			rdbs:hasColumn ?dynamic_membership_vertice_containee_column ;
			rdbs:hasColumn ?dynamic_membership_edge_containee_column ;
			rdbs:hasColumn ?dynamic_attribute_type_column .
# Set up copies of the origin columns
	?copied_static_membership_column rdbs:belongsToTable ?table ;
		?static_membership_predicate ?static_membership_object .
# Set up Vertice Container Id Per Vertice Container Type Columns
	?dynamic_membership_vertice_container_column a rdbs:ContainerVerticeIdPerVerticeTypeColumn ;
		a rdbs:ObjectPropertyColumn ;
#		a rdbs:ForeignKeyColumn ;
#		rdbs:refersToPrimaryKey ?vertice_primary_key_column;
		rdfs:label ?dynamic_membership_vertice_container_column_label ;
		rdbs:hasObjectSemanticName ?container_vertice_type_label ;
		rdbs:hasSemanticName \"isMemberOf\" ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up Vertice Containee Id Per Vertice Containee Type Columns
	?dynamic_membership_vertice_containee_column a rdbs:ContaineeVerticeIdPerVerticeTypeColumn ;
		a rdbs:ObjectPropertyColumn ;
#		a rdbs:ForeignKeyColumn ;
#		rdbs:refersToPrimaryKey ?vertice_primary_key_column;
		rdfs:label ?dynamic_membership_vertice_containee_column_label ;
		rdbs:hasObjectSemanticName ?containee_vertice_type_label ;
		rdbs:hasSemanticName \"contains\" ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up Edge Containee Id Per Edge Containee Type Columns
	?dynamic_membership_edge_containee_column a rdbs:ContaineeEdgeIdPerEdgeTypeColumn ;
		a rdbs:ObjectPropertyColumn ;
#		a rdbs:ForeignKeyColumn ;
#		rdbs:refersToPrimaryKey ?vertice_primary_key_column;
		rdfs:label ?dynamic_membership_edge_containee_column_label ;
		rdbs:hasObjectSemanticName ?containee_edge_type_label ;
		rdbs:hasSemanticName \"contains\" ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up Typed Attribute Value Per Attribute Type Columns
	?dynamic_attribute_type_column a rdbs:TypedAttributeValuePerAttributeTypeColumn ;
		a rdbs:DataPropertyColumn ;
		rdfs:label ?dynamic_attribute_type_column_label ;
		rdbs:hasSemanticName ?attribute_type_label ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType ?dynamic_attribute_type_column_data_type ;
		rdbs:isNullable false .
}
WHERE {
# Fint Input Topic Table
	?this a rdbs:VerticeWithTypeTable ;
		rdfs:label ?origin ;
		rdbs:hasColumn ?vertice_type_column .
	?vertice_type_column a rdbs:ObjectTypeColumn ;
		rdfs:label ?vertice_type_column_label .
# Mint output topic
	BIND ( CONCAT( \"${\", ?vertice_type_column_label, \"}\" ) AS ?output ) .
# Find Membership Topic Table
	?membership_table a rdbs:VerticeWithTypeWithMembershipTable ;
		rdfs:label ?membership_topic ;
		rdbs:hasColumn ?static_membership_column .
# Get only the static data of the membership table
	FILTER NOT EXISTS { ?static_membership_column a rdbs:ContainerVerticeIdPerVerticeTypeColumn }
	FILTER NOT EXISTS { ?static_membership_column a rdbs:ContaineeVerticeIdPerVerticeTypeColumn }
	FILTER NOT EXISTS { ?static_membership_column a rdbs:ContaineeEdgeIdPerEdgeTypeColumn }
# Get the predicates and objects of the static data
?static_membership_column ?static_membership_predicate ?static_membership_object .
# Filter the table belonging
	FILTER ( ?static_membership_predicate != rdbs:belongsToTable )
# Find Typed Attribute Value Per Attribute Type Topics
	?dynamic_attribute_type_table a rdbs:TypedVerticeValuePerAttributeTypeTable ;
		rdfs:label ?attribute_type_topic .
# Create Topology
	BIND ( rdbs:mintTopologyJoin( \"vertice-CBE\" ) AS ?topology ) .
	BIND ( rdbs:mintTopologyJoin( \"vertice-CBE\" , ?membership_topic ) AS ?membership_join ) .
	BIND ( rdbs:mintTopologyJoin( \"vertice-CBE\" , ?attribute_type_topic ) AS ?attribute_type_join ) .
# Get all the Vertice Types
	?vertice_type a rdbs:VerticeType ;
		rdfs:label ?vertice_type_label .
# Mint Vertice CBE IRI
	BIND ( rdbs:mintGraphCBEDescriptionTable( ?vertice_type_label, rdbs:VerticeCBETable ) AS ?table_label ) .
	BIND( rdbs:createIRIFromString( ?table_label, \"base\" ) AS ?table ) .

## Temporary Filter Fix until Kemo Add topology based filter.
	FILTER NOT EXISTS { ?table a rdbs:VerticeCBETable }

# Create the copies of the static data columns
	BIND (  rdbs:mintCopyOfColumn(?static_membership_column, ?table_label) AS ?copied_static_membership_column ) .
# Get the associated Vertice Type Associations and mint related IRIs
    OPTIONAL 
  {
       ?membership_type_association a rdbs:MembershipTypeAssociation .
        {
            ?membership_type_association rdbs:ContainerVerticeType ?vertice_type .                                               
            {	
                ?membership_type_association rdbs:ContaineeVerticeType ?containee_vertice_type .
                ?containee_vertice_type rdfs:label ?containee_vertice_type_label .                
# Create Dynamic Data Column
                ?vertice_type rdfs:label ?vertice_type_label_optional .
                BIND ( rdbs:mintGraphCBEDescriptionTable( ?vertice_type_label_optional, rdbs:VerticeCBETable ) AS ?table_label ) .
                BIND ( rdbs:mintClassifiedColumn( ?table_label, \"contains\", ?containee_vertice_type ) AS ?dynamic_membership_vertice_containee_column ) .
                BIND ( rdbs:mintClassifiedColumnLabel( \"contains\", ?containee_vertice_type ) AS ?dynamic_membership_vertice_containee_column_label ) . 
            }
            UNION
            {	
                ?membership_type_association rdbs:ContaineeEdgeType ?containee_edge_type .
                ?containee_edge_type rdfs:label ?containee_edge_type_label .       
# Create Dynamic Data Column
                ?vertice_type rdfs:label ?vertice_type_label_optional .
                BIND ( rdbs:mintGraphCBEDescriptionTable( ?vertice_type_label_optional, rdbs:VerticeCBETable ) AS ?table_label ) .
                BIND ( rdbs:mintClassifiedColumn( ?table_label, \"contains\", ?containee_edge_type ) AS ?dynamic_membership_edge_containee_column ) .
                BIND ( rdbs:mintClassifiedColumnLabel( \"contains\", ?containee_edge_type ) AS ?dynamic_membership_edge_containee_column_label ) . 
            }
        }
        UNION
        {
            ?membership_type_association rdbs:ContaineeVerticeType ?vertice_type .
            ?membership_type_association rdbs:ContainerVerticeType ?container_vertice_type .
            ?container_vertice_type rdfs:label ?container_vertice_type_label .
# Create Dynamic Data Column
            ?vertice_type rdfs:label ?vertice_type_label_optional .
            BIND ( rdbs:mintGraphCBEDescriptionTable( ?vertice_type_label_optional, rdbs:VerticeCBETable ) AS ?table_label ) .
            BIND ( rdbs:mintClassifiedColumn( ?table_label, \"isMemberOf\", ?container_vertice_type ) AS ?dynamic_membership_vertice_container_column ) .
            BIND ( rdbs:mintClassifiedColumnLabel( \"isMemberOf\", ?container_vertice_type ) AS ?dynamic_membership_vertice_container_column_label ) .
        }
		UNION
		{
			?vertice_type_association a rdbs:VerticeTypeAssociation ;
				rdbs:hasVerticeType ?vertice_type ;
				rdbs:hasAttributeType ?attribute_type ;
				rdbs:hasAttributeDataType ?attribute_data_type .
			?attribute_type rdfs:label ?attribute_type_label .
			?attribute_data_type rdfs:label ?attribute_data_type_label .
# Find Associated Data Type
			?typed_attribute_value_table a rdbs:EdgeTypedAttributeValueTable ;
				rdbs:hasColumn [
					a rdbs:TypedAttributeValueColumn ;
					rdfs:label ?attribute_data_type_label ;
					rdbs:hasDataType ?dynamic_attribute_type_column_data_type 
				] .
# Get the associated Membership Type Associations and mint related IRIs
        ?vertice_type rdfs:label ?vertice_type_label_optional .
        BIND ( rdbs:mintGraphCBEDescriptionTable( ?vertice_type_label_optional, rdbs:VerticeCBETable ) AS ?table_label ) .
		BIND ( rdbs:mintClassifiedColumn( ?table_label, ?attribute_data_type_label, ?attribute_type ) AS ?dynamic_attribute_type_column ) .
		BIND ( rdbs:mintClassifiedColumnLabel( ?attribute_data_type_label, ?attribute_type ) AS ?dynamic_attribute_type_column_label ) .
		}
     }
}""" ;
  sh:deactivated false ;
  sh:order "8"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:VerticeCBETable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents a Concise Bounded Entity of a Vertice of a given Type from the Property Graph."@en ;
  rdfs:label "Vertice By Type"@en ;
  rdfs:subClassOf rdbs:GraphCBE ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee edge Id per edge type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeEdgeIdPerEdgeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee vertice Id per vertice type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeVerticeIdPerVerticeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has container vertice Id per vertice type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContainerVerticeIdPerVerticeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has typed attribute value per attribute type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:TypedAttributeValuePerAttributeTypeColumn ;
        ] ;
    ] ;
.
rdbs:VerticeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that represents a Vertice of the Property Graph. It represents an Entity in the Property Graph Abstraction."@en ;
  rdfs:label "Entity table"@en ;
  rdfs:subClassOf rdbs:ObjectTable ;
.
rdbs:VerticeType
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Type of Vertice in the Schema of a Graph"@en ;
  rdfs:label "Vertice Type"@en ;
  rdfs:subClassOf rdbs:GraphSchemaType ;
.
rdbs:VerticeTypeAssociation
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Vertice Type Schema Association associates a Vertice Type with an Attribute Type and its AttributeDataType"@en ;
  rdfs:label "Vertice Type Association"@en ;
  rdfs:subClassOf rdbs:GraphSchemaTypeAssociation ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAttributeDataType ;
      sh:class rdbs:AttributeDataType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Attribute Data Type {@en}" ;
      sh:node rdbs:AttributeDataType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasAttributeType ;
      sh:class rdbs:AttributeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Attribute Type {@en}" ;
      sh:node rdbs:AttributeType ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasVerticeType ;
      sh:class rdbs:VerticeType ;
      sh:maxCount 1 ;
      sh:minCount 1 ;
      sh:name "has Vertice Type {@en}" ;
      sh:node rdbs:VerticeType ;
      sh:nodeKind sh:IRI ;
    ] ;
.
rdbs:VerticeTypedAttributeValueTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "A Table that contains the Attribute Values of a specific AttributeDataType of a Vertice Attribute of the Property Graph."@en ;
  rdfs:label "Vertice Typed Attribute Value Table"@en ;
  rdfs:subClassOf rdbs:TypedAttributeValueTable ;
.
rdbs:VerticeWithTypeTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:comment "Description Table containing the Vertices of the Property Graph and their associated Object Types."@en ;
  rdfs:label "Vertice With Type Table"@en ;
  rdfs:subClassOf rdbs:ObjectWithTypeTable ;
.
rdbs:VerticeWithTypeWithMembership
  a sh:SPARQLRule ;
  rdfs:comment "Creating the description of a Temporary Table containing the memberships of each Vertice of a property graph with the other Vertices and Edges of that Property Graph."@en ;
  rdfs:label "VerticeWithTypeWithMembership"@en ;
  sh:construct """PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX sh:<http://www.w3.org/ns/shacl#>

CONSTRUCT {
# The base node to describe topologies of temporary topics
	?topology a rdbs:Topology ;
			rdbs:hasOutput ?output ;
			rdbs:hasTopic ?origin ;
			rdbs:hasRelation ?vertice_container_relation ;
			rdbs:hasRelation ?vertice_containee_relation ;
			rdbs:hasRelation ?edge_containee_relation .
# The description of the vertice container relation element of the topology
    ?vertice_container_relation a rdbs:Relation ;
			rdbs:hasTopic ?membership_topic ;
			rdbs:hasGroupBy ?group_by_vertice_container ;
			rdbs:hasCollect ?collect_vertice_container .
# The description of the vertice containee relation element of the topology
    ?vertice_containee_relation a rdbs:Relation ;
			rdbs:hasTopic ?membership_topic ;
			rdbs:hasGroupBy ?group_by_vertice_containee ;
			rdbs:hasCollect ?collect_vertice_containee .
# The description of the edge containee join element of the topology
    ?edge_containee_relation a rdbs:Relation ;
			rdbs:hasTopic ?membership_topic ;
			rdbs:hasGroupBy ?group_by_edge_containee ;
			rdbs:hasCollect ?collect_edge_containee .
# The description of the group by vertice container element of the relation
	?group_by_vertice_container a rdbs:GroupBy ;
		rdbs:hasOrder 0 ;
		rdfs:label ?vertice_containee_key_label .
# The description of the group by vertice containee element of the relation
	?group_by_vertice_containee a rdbs:GroupBy ;
		rdbs:hasOrder 0 ;
		rdfs:label ?vertice_container_key_label .
# The description of the group by edge containee element of the relation
	?group_by_edge_containee a rdbs:GroupBy ;
		rdbs:hasOrder 0 ;
		rdfs:label ?vertice_container_key_label .
# The description of the collect vertice container element of the relation
	?collect_vertice_container a rdbs:Collect ;
		rdbs:hasClassifier ?vertice_container_column_label ;
		rdbs:hasValue ?vertice_container_key_label ;
		rdbs:hasAlias ?vertice_container_column_alias .
# The description of the collect vertice containee element of the relation
	?collect_vertice_containee a rdbs:Collect ;
		rdbs:hasClassifier ?vertice_containee_column_label ;
		rdbs:hasValue ?vertice_containee_key_label ;
		rdbs:hasAlias ?vertice_containee_column_alias .
# The description of the collect edfe containee element of the relation
	?collect_edge_containee a rdbs:Collect ;
		rdbs:hasClassifier ?edge_containee_column_label ;
		rdbs:hasValue ?edge_containee_key_label ;
		rdbs:hasAlias ?edge_containee_column_alias .
# The description of the table or topic resulting from the join
	?table a rdbs:VerticeWithTypeWithMembershipTable ;
			rdbs:createdWith ?topology ;
			rdfs:label ?output ;
# Adding the copies of the origin topic columns and the selected foreign topic columns
			rdbs:hasColumn ?copied_origin_column ;
			rdbs:hasColumn ?vertice_container_id_per_vertice_type_column ;
			rdbs:hasColumn ?vertice_containee_id_per_vertice_type_column ;
			rdbs:hasColumn ?edge_containee_id_per_edge_type_column .
# Set up copies of the origin columns
	?copied_origin_column rdbs:belongsToTable ?table ;
		?origin_predicate ?origin_object .
# Set up Vertice Container Id Per Vertice Container Type Columns
	?vertice_container_id_per_vertice_type_column a rdbs:ContainerVerticeIdPerVerticeTypeColumn ;
		a rdbs:ForeignKeyColumn ;
		rdbs:refersToPrimaryKey ?vertice_primary_key_column;
		rdfs:label ?vertice_container_id_per_vertice_type_column_label ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up Vertice Containee Id Per Vertice Containee Type Columns
	?vertice_containee_id_per_vertice_type_column a rdbs:ContaineeVerticeIdPerVerticeTypeColumn ;
		a rdbs:ForeignKeyColumn ;
		rdbs:refersToPrimaryKey ?vertice_primary_key_column;
		rdfs:label ?vertice_containee_id_per_vertice_type_column_label ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
# Set up Edge Containee Id Per Edge Containee Type Columns
	?edge_containee_id_per_edge_type_column a rdbs:ContaineeEdgeIdPerEdgeTypeColumn ;
		a rdbs:ForeignKeyColumn ;
		rdbs:refersToPrimaryKey ?edge_primary_key_column;
		rdfs:label ?edge_containee_id_per_edge_type_column_label ;
		rdbs:belongsToTable ?table ;
		rdbs:hasDataType rdbs:INT ;
		rdbs:isNullable false .
}
WHERE {
# Pattern to match in order to create join topology
    ?this a rdbs:VerticeWithTypeTable .
# Get Edge and Vertice Table Primary Keys
	?edge_table a rdbs:EdgeTable ;
		rdbs:hasColumn ?edge_primary_key_column .
	?edge_primary_key_column a rdbs:PrimaryKeyColumn .
	?vertice_table a rdbs:EdgeTable ;
		rdbs:hasColumn ?vertice_primary_key_column .
	?vertice_primary_key_column a rdbs:PrimaryKeyColumn .
# Create the new description table and its name as the output
	BIND( rdbs:mintGraphTemporaryDescriptionTable( ?this, rdbs:VerticeWithTypeWithMembershipTable ) AS ?output ) .
	BIND( rdbs:createIRIFromString( ?output, \"base\" ) AS ?table ) .
# Filter topologies already processed
	FILTER NOT EXISTS { ?table a rdbs:VerticeWithTypeWithMembershipTable }
# Identify target foreign column
	?membership_table a rdbs:MembershipWithTypeTable .
# Get Vertice Container Key
	?membership_table rdbs:hasColumn ?vertice_container_key .
	?vertice_container_key	a rdbs:ContainerVerticeIdColumn .
# Get Vertice Containee Key
	?membership_table rdbs:hasColumn ?vertice_containee_key .
	?vertice_containee_key	a rdbs:ContaineeVerticeIdColumn .
# Get Edge Containee Key
	?membership_table rdbs:hasColumn ?edge_containee_key .
	?edge_containee_key	a rdbs:ContaineeEdgeIdColumn .
# Get Vertice Container Column
	?membership_table rdbs:hasColumn ?vertice_container_column .
	?vertice_container_column	a rdbs:ContainerVerticeColumn .
# Get Vertice Containee Column
	?membership_table rdbs:hasColumn ?vertice_containee_column .
	?vertice_containee_column a rdbs:ContaineeVerticeColumn .
# Get Edge Containee Column
	?membership_table rdbs:hasColumn ?edge_containee_column .
	?edge_containee_column	a rdbs:ContaineeEdgeColumn .
# Find the different columns of the origin topic 
	?this rdfs:label ?origin ;
		rdbs:hasColumn ?origin_column .
# Get the label of the foreign keys
	?vertice_container_key rdfs:label ?vertice_container_key_label .
	?vertice_containee_key rdfs:label ?vertice_containee_key_label .
	?edge_containee_key rdfs:label ?edge_containee_key_label .
	?vertice_container_column rdfs:label ?vertice_container_column_label .
	?vertice_containee_column rdfs:label ?vertice_containee_column_label .
	?edge_containee_column rdfs:label ?edge_containee_column_label .
# Get the label of the foreign tables
	?membership_table rdfs:label ?membership_topic .
# Get the labels of the foreign columns
	BIND ( \"isMemberOf\" AS ?vertice_container_column_alias )
	BIND ( \"contains\" AS ?vertice_containee_column_alias )
	BIND ( \"contains\" AS ?edge_containee_column_alias )
# Get the predicates and objects of the copied columns
	?origin_column ?origin_predicate ?origin_object .
# Skip the predicates referencing the belonging of the columns
	FILTER (?origin_predicate != rdbs:belongsToTable )
# Create the different subject nodes for each matched Pattern
	BIND ( rdbs:mintTopologyRelation( ?output ) AS ?topology ) .
	BIND ( rdbs:mintTopologyRelation( ?output, CONCAT( ?membership_topic, \"_0\" ) ) AS ?vertice_container_relation ) .
	BIND ( rdbs:mintTopologyRelation( ?output, CONCAT( ?membership_topic, \"_1\" ) ) AS ?vertice_containee_relation ) .
	BIND ( rdbs:mintTopologyRelation( ?output, CONCAT( ?membership_topic, \"_2\" ) ) AS ?edge_containee_relation ) .
	BIND ( rdbs:mintTopologyRelation( ?output, ?membership_topic, ?vertice_containee_key_label ) AS ?group_by_vertice_container ) .
	BIND ( rdbs:mintTopologyRelation( ?output, ?membership_topic, CONCAT( ?vertice_container_key_label, \"_0\" ) ) AS ?group_by_vertice_containee ) .
	BIND ( rdbs:mintTopologyRelation( ?output, ?membership_topic, CONCAT( ?vertice_container_key_label, \"_1\" ) ) AS ?group_by_edge_containee ) .
	BIND ( rdbs:mintTopologyRelation( ?output, ?membership_topic, ?vertice_containee_key_label, ?vertice_container_column_label, ?vertice_container_column_alias ) AS ?collect_vertice_container ) .
	BIND ( rdbs:mintTopologyRelation( ?output, ?membership_topic, ?vertice_container_key_label, ?vertice_containee_column_label, ?vertice_containee_column_alias ) AS ?collect_vertice_containee ) .
	BIND ( rdbs:mintTopologyRelation( ?output, ?membership_topic, ?vertice_container_key_label, ?edge_containee_column_label, ?edge_containee_column_alias ) AS ?collect_edge_containee ) .
# Create the different columns that are copies of the origin columns
	BIND (rdbs:mintCopyOfColumn(?origin_column, ?output) AS ?copied_origin_column) .
# Get the MembershipTypeAssociations
# Get the Vertice Container
	{
		SELECT DISTINCT ?vertice_container_type 
		WHERE {
			?membership_type_association a rdbs:MembershipTypeAssociation ;
				rdbs:ContainerVerticeType ?vertice_container_type .
		}
	}
# Create Vertice Container Column
	BIND ( rdbs:mintClassifiedColumn(?output, ?vertice_container_column_alias, ?vertice_container_type ) AS ?vertice_container_id_per_vertice_type_column ) .
	BIND ( rdbs:mintClassifiedColumnLabel(?vertice_container_column_alias, ?vertice_container_type ) AS ?vertice_container_id_per_vertice_type_column_label ) .
# Get the Vertice Containee
	{
		SELECT DISTINCT ?vertice_containee_type 
		WHERE {
			?membership_type_association a rdbs:MembershipTypeAssociation ;
				rdbs:ContaineeVerticeType ?vertice_containee_type .
		}
	}
# Create the Vertice Containee Column
	BIND ( rdbs:mintClassifiedColumn(?output, ?vertice_containee_column_alias, ?vertice_containee_type ) AS ?vertice_containee_id_per_vertice_type_column ) .
	BIND ( rdbs:mintClassifiedColumnLabel(?vertice_containee_column_alias, ?vertice_containee_type ) AS ?vertice_containee_id_per_vertice_type_column_label ) .
# Get the Edge Containee Column
	{
		SELECT DISTINCT ?edge_containee_type 
		WHERE {
			?membership_type_association a rdbs:MembershipTypeAssociation ;
				rdbs:ContaineeEdgeType ?edge_containee_type .
		}
	}
# Create the Edge Containee Column
	BIND ( rdbs:mintClassifiedColumn(?output, ?edge_containee_column_alias, ?edge_containee_type ) AS ?edge_containee_id_per_edge_type_column ) .
	BIND ( rdbs:mintClassifiedColumnLabel(?edge_containee_column_alias, ?edge_containee_type ) AS ?edge_containee_id_per_edge_type_column_label ) .
}""" ;
  sh:deactivated false ;
  sh:order "7"^^xsd:decimal ;
  sh:prefixes rdfs: ;
  sh:prefixes owl: ;
  sh:prefixes rdbs: ;
.
rdbs:VerticeWithTypeWithMembershipTable
  a owl:Class ;
  a sh:NodeShape ;
  rdfs:label "A Description Table with the Vertices of the Property Graph and their memberships with other Vertices and Edges. "@en ;
  rdfs:subClassOf rdbs:TemporaryTable ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee edge Id per edge type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeEdgeIdPerEdgeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has containee vertice Id per vertice type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContaineeVerticeIdPerVerticeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has container vertice Id per vertice type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ContainerVerticeIdPerVerticeTypeColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type Id column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeIdColumn ;
        ] ;
    ] ;
  sh:property [
      a sh:PropertyShape ;
      sh:path rdbs:hasColumn ;
      sh:name "has object type column {@en}" ;
      sh:nodeKind sh:IRI ;
      sh:qualifiedMaxCount 1 ;
      sh:qualifiedMinCount 1 ;
      sh:qualifiedValueShape [
          sh:class rdbs:ObjectTypeColumn ;
        ] ;
    ] ;
.
rdbs:belongsToTable
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Column ;
  rdfs:range rdbs:Table ;
.
rdbs:columnNameOp4
  a owl:Property ;
.
rdbs:createIRIFromString
  a sh:SPARQLFunction ;
  rdfs:comment "Create an IRI from a given String that will be the local name, and an optional String that is a prefix (sh:prefix declared with a namespace in a sh:declare). The default prefix is \"schema\", and is replaced by the current schema namespace of the file ontology. This function will not work if the prefix is not declared with a namespace."@en ;
  rdfs:label "Create IRI from String"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterIRILocalName ;
      sh:datatype xsd:string ;
      sh:description "The local name of the IRI"@en ;
      sh:name "Local Name"@en ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterIRIPrefix ;
      sh:datatype xsd:string ;
      sh:description "The prefix that should be used (optional is schema)"@en ;
      sh:name "Prefix"@en ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
OPTIONAL { BIND ( $ParameterIRIPrefix AS ?provided_target) }
BIND ( COALESCE ( ?provided_target, \"schema\" ) AS ?target )
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix ?target
		] .
	BIND(IRI(concat(str(?prefix), $ParameterIRILocalName)) AS ?result)
}""" ;
.
rdbs:createdWith
  a owl:ObjectProperty ;
  rdfs:comment "The Topology that lists the set of Operations to create the current Table."@en ;
  rdfs:domain rdbs:TemporaryTable ;
  rdfs:label "Created With"@en ;
  rdfs:range rdbs:Topology ;
.
rdbs:domainLabelOp2
  a owl:Property ;
.
rdbs:domainLocalNameOp1
  a owl:Property ;
.
rdbs:getInstanceLocalName
  a sh:SPARQLFunction ;
  rdfs:comment "Get the Local Name of an instance of the ontology."@en ;
  rdfs:label "Rule Test Shape"@en ;
  sh:parameter [
      sh:path rdbs:ParameterIRI ;
      sh:datatype xsd:anyURI ;
      sh:description "The item using desired prefix"@en ;
    ] ;
  sh:returnType xsd:string ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix \"base\"
		] .
	BIND(str($ParameterIRI) AS ?str_this)
	BIND(str(?prefix) AS ?str_prefix)
	BIND(strafter(?str_this, ?str_prefix) AS ?result)
}""" ;
.
rdbs:getInstancePrefix
  a sh:SPARQLFunction ;
  rdfs:comment "Get the prefix of an instance"@en ;
  rdfs:label "Get Instance Prefix"@en ;
  sh:parameter [
      sh:path rdbs:ParameterIRI ;
      sh:datatype xsd:anyURI ;
      sh:description "The item using desired prefix"@en ;
    ] ;
  sh:returnType xsd:string ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix \"base\"
		] .
	BIND(?prefix AS ?result)
}""" ;
.
rdbs:hasAggregate
  a owl:ObjectProperty ;
  rdfs:comment "The Aggregate operation of a Topology."@en ;
  rdfs:domain rdbs:Topology ;
  rdfs:label "Has Aggregate"@en ;
  rdfs:range rdbs:Aggregate ;
.
rdbs:hasAlias
  a owl:DatatypeProperty ;
  rdfs:comment "The Alias of a Selected or Collected Column in a Topology Operation."@en ;
  rdfs:label "has Alias"@en ;
  rdfs:range xsd:string ;
.
rdbs:hasAnnotationSourceType
  a owl:ObjectProperty ;
  rdfs:comment "The Vertice Type that is the Source of a Property Graph Annotation."@en ;
  rdfs:label "has Annotation Source Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:hasAnnotationTargetType
  a owl:ObjectProperty ;
  rdfs:comment "The Vertice Type that is the Target of a Property Graph Annotation."@en ;
  rdfs:label "has Annotation Target Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:hasAnnotationType
  a owl:ObjectProperty ;
  rdfs:comment "The Type of the Annotation that binds a Vertice as a Source and another Vertice as a Target in a Property Graph Annotation."@en ;
  rdfs:label "has Annotation Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:hasAssociatedName
  a owl:DatatypeProperty ;
  rdfs:domain rdbs:Association ;
  rdfs:label "has associated name" ;
.
rdbs:hasAssociation
  a owl:ObjectProperty ;
  rdfs:label "has association"@en ;
  rdfs:range rdbs:Association ;
.
rdbs:hasAttributeDataType
  a owl:ObjectProperty ;
  rdfs:comment "The Data Type of an Attribute from the Property Graph."@en ;
  rdfs:label "has Attribute DataType"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:hasAttributeType
  a owl:ObjectProperty ;
  rdfs:comment "The Type of an Attribute of the Property Graph."@en ;
  rdfs:label "has Attribute Type"@en ;
  rdfs:subPropertyOf rdbs:hasParticipantType ;
.
rdbs:hasClassifier
  a owl:DatatypeProperty ;
  rdfs:domain rdbs:Collect ;
  rdfs:range xsd:string ;
.
rdbs:hasClassifyingColumn
  a owl:ObjectProperty ;
  rdfs:comment "Specify that a column is used to classify the containing table into separate entity types."@en ;
  rdfs:domain [
      a owl:Class ;
      owl:unionOf (
          rdbs:EntityClassification
          rdbs:PropertyClassification
        ) ;
    ] ;
  rdfs:label "has classifying column"@en ;
  rdfs:range rdbs:Column ;
.
rdbs:hasClassifyingTable
  a owl:ObjectProperty ;
  rdfs:domain rdbs:PropertyClassification ;
  rdfs:label "has classifying table"@en ;
  rdfs:range rdbs:Table ;
.
rdbs:hasCollect
  a owl:ObjectProperty ;
  rdfs:comment "A collected value in a Join or Aggregate Operation of a Topology."@en ;
  rdfs:domain rdbs:Aggregate ;
  rdfs:label "has Collect"@en ;
  rdfs:range rdbs:Collect ;
.
rdbs:hasColumn
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Table ;
  rdfs:label "has column"@en ;
  rdfs:range rdbs:Column ;
  owl:inverseOf rdbs:belongsToTable ;
.
rdbs:hasDataType
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Column ;
  rdfs:range rdbs:DataType ;
  rdfs:range [
      a owl:Restriction ;
      owl:onClass rdbs:DataType ;
      owl:onProperty rdbs:hasDataType ;
      owl:qualifiedCardinality "1"^^xsd:nonNegativeInteger ;
    ] ;
.
rdbs:hasDistinctValue
  a owl:DatatypeProperty ;
  rdfs:comment "Distinct value for a classifying column in a classification operation. These are collected once a column has been involved into a classification operation."@en ;
  rdfs:domain rdbs:Column ;
  rdfs:label "has distinct value"@en ;
.
rdbs:hasEdgeType
  a owl:ObjectProperty ;
  rdfs:comment "Type of an Edge from the Property Graph."@en ;
  rdfs:label "Type of Edge"@en ;
.
rdbs:hasEntityLocalName
  a owl:DatatypeProperty ;
  rdfs:domain rdbs:EntityTable ;
  rdfs:label "has entity local name" ;
  rdfs:range xsd:string ;
.
rdbs:hasEntityType
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Table ;
  rdfs:label "set the type of an entity."@en ;
  rdfs:range owl:Class ;
.
rdbs:hasForeign
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasForeignColumn
  a owl:ObjectProperty ;
  rdfs:comment "Reference to a foreign column (i.e. a column belonging to a table not target) to import into a target table/entity."@en ;
  rdfs:domain rdbs:ForeignColumn ;
  rdfs:label "has foreign column"@en ;
  rdfs:range rdbs:Column ;
.
rdbs:hasForeignKey
  a owl:DatatypeProperty ;
  rdfs:domain rdbs:Join ;
  rdfs:range xsd:string ;
.
rdbs:hasGroupBy
  a owl:ObjectProperty ;
  rdfs:comment "A Column used to group the others in an Operation from a Topology."@en ;
  rdfs:domain rdbs:Aggregate ;
  rdfs:label "has Group By"@en ;
.
rdbs:hasIDColumn
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasIDTable
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasJoin
  a owl:ObjectProperty ;
  rdfs:comment "A Join Operation listed in the Topology."@en ;
  rdfs:domain rdbs:Topology ;
  rdfs:label "has Join"@en ;
  rdfs:range rdbs:Join ;
.
rdbs:hasKeyColumn
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasKeyTable
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasKind
  a owl:ObjectProperty ;
  rdfs:comment "The Type of Join used in the Topology."@en ;
  rdfs:domain rdbs:Join ;
  rdfs:label "has Kind"@en ;
  rdfs:range rdbs:JoinKind ;
.
rdbs:hasObjectSemanticName
  a owl:DatatypeProperty ;
  rdfs:comment "Contains the semantic name of the Object Type that the Column refers to through identifiers."@en ;
  rdfs:label "has Object Semantic Name"@en ;
  rdfs:range xsd:string ;
.
rdbs:hasOntology
  a owl:ObjectProperty ;
  rdfs:comment "The Type of Ontology that contains the Annotation."@en ;
  rdfs:label "has Ontology"@en ;
.
rdbs:hasOrder
  a owl:DatatypeProperty ;
  rdfs:comment "Order of the respective Topology Operation in the Topology."@en ;
  rdfs:domain rdbs:TopologyOperation ;
  rdfs:label "has Order"@en ;
  rdfs:range xsd:integer ;
.
rdbs:hasOutput
  a owl:DatatypeProperty ;
  rdfs:comment "The label of the Description Table produced by the Topology."@en ;
  rdfs:domain rdbs:Topology ;
  rdfs:label "has Ouput"@en ;
  rdfs:range xsd:string ;
.
rdbs:hasParticipantType
  a owl:ObjectProperty ;
  rdfs:label "has Participant Type"@en ;
.
rdbs:hasParticipatingColumn
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Subentity ;
  rdfs:label "has participating column"@en ;
  rdfs:range rdbs:Column ;
.
rdbs:hasProperty
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Column ;
  rdfs:label "set the property of a column."@en ;
  rdfs:range [
      a owl:Class ;
      owl:unionOf (
          owl:ObjectProperty
          owl:DatatypeProperty
        ) ;
    ] ;
.
rdbs:hasPropertyLocalName
  a owl:DatatypeProperty ;
  rdfs:label "has property local name" ;
.
rdbs:hasRelation
  a owl:DatatypeProperty ;
  rdfs:label "The Relation Join of a Topology. "@en ;
.
rdbs:hasSelect
  a owl:ObjectProperty ;
  rdfs:comment "The Selected Column to fetch in a Topology Operation."@en ;
  rdfs:domain rdbs:Join ;
  rdfs:label "has Select"@en ;
  rdfs:range rdbs:Select ;
.
rdbs:hasSelectedColumn
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasSelectedTable
  a owl:DatatypeProperty ;
  rdfs:range xsd:string ;
.
rdbs:hasSemanticName
  a owl:DatatypeProperty ;
  rdfs:comment "The Semantic Name, carrying actual meaning in English, of a Table or Column used in the Proxy Ontology."@en ;
  rdfs:label "has a semantic name"@en ;
  rdfs:range xsd:string ;
.
rdbs:hasSourceTable
  a owl:ObjectProperty ;
  rdfs:label "has source table"@en ;
  rdfs:range rdbs:Table ;
.
rdbs:hasSubentityType
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Subentity ;
  rdfs:label "set the type of an entity's subentity."@en ;
  rdfs:range owl:Class ;
.
rdbs:hasSuperType
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Table ;
  rdfs:label "set the super type of an entity type."@en ;
  rdfs:range owl:Class ;
.
rdbs:hasTargetTable
  a owl:ObjectProperty ;
  rdfs:domain rdbs:ForeignColumn ;
  rdfs:label "has target table"@en ;
  rdfs:range rdbs:Table ;
.
rdbs:hasTmpType
  a xsd:string ;
  rdfs:domain rdbs:Table ;
  rdfs:label "has temporary table type" ;
.
rdbs:hasTopic
  a owl:DatatypeProperty ;
  rdfs:comment "The Label of the Table from or with which a Topology Operation associates another Table."@en ;
  rdfs:domain rdbs:Join ;
  rdfs:domain rdbs:Topology ;
  rdfs:label "has Topic"@en ;
  rdfs:range xsd:string ;
.
rdbs:hasValue
  a owl:DatatypeProperty ;
  rdfs:comment "When used in a Collect or a Select, contains the label of the Column containing the Values to transfer to the Output Description Table."@en ;
  rdfs:domain rdbs:Association ;
  rdfs:domain rdbs:Collect ;
  rdfs:domain rdbs:Select ;
  rdfs:label "has value"@en ;
  rdfs:range xsd:string ;
.
rdbs:hasVerticeALinkType
  a owl:ObjectProperty ;
  rdfs:comment "Type of the link connecting the first Vertice to an Edge."@en ;
  rdfs:label "has Vertice A Link Type"@en ;
.
rdbs:hasVerticeAType
  a owl:ObjectProperty ;
  rdfs:comment "Type of the first Vertice connected to an Edge."@en ;
  rdfs:label "has Vertice A Type"@en ;
.
rdbs:hasVerticeBLinkType
  a owl:ObjectProperty ;
  rdfs:comment "Type of the link connecting the second Vertice to an Edge."@en ;
  rdfs:label "has Vertice B Link Type"@en ;
.
rdbs:hasVerticeBType
  a owl:ObjectProperty ;
  rdfs:comment "Type of the second Vertice connected to an Edge."@en ;
  rdfs:label "has Vertice B Type"@en ;
.
rdbs:hasVerticeType
  a owl:ObjectProperty ;
  rdfs:comment "Type of a Vertice from a Property Graph."@en ;
  rdfs:label "Type of Vertice"@en ;
.
rdbs:inhibitRelationTo
  a owl:ObjectProperty ;
  rdfs:comment "Used to inhibit the materialisation of relationships between the subject and the object table."@en ;
  rdfs:domain rdbs:Table ;
  rdfs:label "inhibit relation to"@en ;
  rdfs:range rdbs:Table ;
.
rdbs:isCopyOf
  a owl:ObjectProperty ;
  rdfs:comment "The original Column from which this one's predicates and objects have been taken."@en ;
  rdfs:domain rdbs:Column ;
  rdfs:label "is Copy Of"@en ;
  rdfs:range rdbs:Column ;
.
rdbs:isNullable
  a owl:DatatypeProperty ;
  rdfs:comment "If \"true\" the column can have null values."@en ;
  rdfs:domain rdbs:Column ;
  rdfs:label "is nullable"@en ;
  rdfs:range xsd:boolean ;
.
rdbs:labelOp2
  a owl:Property ;
.
rdbs:localNameOp1
  a owl:Property ;
.
rdbs:mapsToColumn
  a owl:ObjectProperty ;
  rdfs:label "maps to column" ;
  rdfs:range rdbs:Column ;
.
rdbs:mergeToTable
  a owl:ObjectProperty ;
  rdfs:domain rdbs:Table ;
  rdfs:label "merge to table" ;
  rdfs:range rdbs:Table ;
.
rdbs:mintClassifiedColumn
  a sh:SPARQLFunction ;
  rdfs:comment "Create the IRI of a column that is the result of a value classification (group by + collect operation) ."@en ;
  rdfs:label "Mint Classified Column"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterClassifier ;
      sh:datatype xsd:string ;
      sh:description "The label of the classifying Column that is the first part of the Column name. {@en}" ;
      sh:name "Parameter classifier {@en}" ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterTable ;
      sh:class rdbs:Table ;
      sh:description "The table that will receive the copy of the column."@en ;
      sh:name "Table Parameter"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterValue ;
      sh:class rdbs:GraphSchemaType ;
      sh:name "Value Parameter"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 2 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the prefix of the new table
	$ParameterValue rdfs:label ?raw_value_type .
	BIND (REPLACE ($ParameterTable, \"\\\\W+\", \"-\") AS ?table)
	BIND (REPLACE ($ParameterClassifier, \"\\\\W*\", \"_\") AS ?classifier_type)
	BIND (REPLACE (?raw_value_type, \"\\\\W*\", \"_\") AS ?value_type)
# Bind the class prefix and name into an URI
	BIND (rdbs:createIRIFromString( CONCAT (?table, ?classifier_type, ?value_type), \"base\" ) AS ?result )
}""" ;
.
rdbs:mintClassifiedColumnLabel
  a sh:SPARQLFunction ;
  rdfs:comment "Create the label of a column that is the result of a value classification (group by + collect operation) ."@en ;
  rdfs:label "Mint Classified Column Label"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterClassifier ;
      sh:datatype xsd:string ;
      sh:description "The label of the classifying Column that is the first part of the Column name. {@en}" ;
      sh:name "Parameter classifier {@en}" ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterValue ;
      sh:class rdbs:GraphSchemaType ;
      sh:name "Value Parameter"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 1 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the prefix of the new table
	$ParameterValue rdfs:label ?raw_value_type .
	BIND (REPLACE ($ParameterClassifier, \"\\\\W+\", \"_\") AS ?classifier_type)
	BIND (REPLACE (?raw_value_type, \"\\\\W*\", \"_\") AS ?value_type)
# Bind the class prefix and name into an URI
	BIND (CONCAT (?classifier_type, ?value_type) AS ?result )
}""" ;
.
rdbs:mintColumn
  a sh:SPARQLFunction ;
  rdfs:comment "Create the IRI of a column of a temporary Description Table."@en ;
  rdfs:label "Mint Column"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterIRIPrefix ;
      sh:datatype xsd:string ;
      sh:name "table name"@en ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterIRISuffix ;
      sh:datatype xsd:string ;
      sh:name "column name"@en ;
      sh:order 1 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>
SELECT ?result
WHERE {
# Get the prefix of the new table
  BIND (REPLACE ($ParameterIRIPrefix, \"\\\\W+\", \"-\") AS ?table)
  BIND (REPLACE ($ParameterIRISuffix, \"\\\\W*\", \"_\") AS ?name)
# Bind the class prefix and name into an URI
  BIND (rdbs:createIRIFromString( CONCAT (?table, ?name), \"base\" ) AS ?result )
}""" ;
.
rdbs:mintCopyOfColumn
  a sh:SPARQLFunction ;
  rdfs:comment "Create the IRI of a copy of a column, base on the original column."@en ;
  rdfs:label "Mint Copy of Column"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterColumn ;
      sh:class rdbs:Column ;
      sh:description "The column that is copied."@en ;
      sh:name "Column Parameter"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterIRISuffix ;
      sh:datatype xsd:string ;
      sh:description "An optional suffix to the column."@en ;
      sh:name "Optional Suffix"@en ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterTable ;
      sh:class rdbs:Table ;
      sh:description "The table that will receive the copy of the column."@en ;
      sh:name "Table Parameter"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 1 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>
SELECT ?result
WHERE {
# Get the prefix of the new table
  $ParameterColumn rdfs:label ?raw_column .
  BIND (REPLACE (?raw_column, \"\\\\W*\", \"_\") AS ?column)
  BIND (REPLACE ($ParameterTable, \"\\\\W+\", \"-\") AS ?table)
  BIND (REPLACE ($ParameterIRISuffix, \"\\\\W+\", \"_\") AS ?raw_suffix)
  BIND (CONCAT(\"-as-\", ?raw_suffix) AS ?suffix)
  BIND (COALESCE ( CONCAT (?column, ?suffix), ?column )AS ?suffixed_column)
# Bind the class prefix and name into an URI
  BIND (rdbs:createIRIFromString( CONCAT (?table, ?suffixed_column), \"base\" ) AS ?result )
}""" ;
.
rdbs:mintDTPropertyURI
  a sh:SPARQLFunction ;
  rdfs:comment "Mint a URI for a Data Type property from its $localName and $label" ;
  sh:parameter [
      sh:path rdbs:columnNameOp4 ;
      sh:datatype xsd:string ;
      sh:description "The column name" ;
      sh:optional true ;
      sh:order 3 ;
    ] ;
  sh:parameter [
      sh:path rdbs:labelOp2 ;
      sh:datatype xsd:string ;
      sh:description "The table label" ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      sh:path rdbs:localNameOp1 ;
      sh:datatype xsd:string ;
      sh:description "The entity local name" ;
      sh:optional true ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      sh:path rdbs:namespaceOp5 ;
      sh:datatype xsd:string ;
      sh:description "The namespace" ;
      sh:optional true ;
      sh:order 4 ;
    ] ;
  sh:parameter [
      sh:path rdbs:propertyLocalNameOp3 ;
      sh:datatype xsd:string ;
      sh:description "The asserted property local name" ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:returnType xsd:string ;
  sh:select """
    PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
    PREFIX sh:<http://www.w3.org/ns/shacl#>
    SELECT ?result
    WHERE {
      BIND(  IF(  BOUND($localNameOp1) , $localNameOp1, $labelOp2)  AS ?localEntityClassName)
      BIND(  IF(  BOUND($propertyLocalNameOp3) , $propertyLocalNameOp3,  CONCAT(\"has_\",  CONCAT($columnNameOp4,  CONCAT(\"_for_\",?localEntityClassName))))  AS ?localPropertyName)
      BIND(  IRI(CONCAT( STR($namespaceOp5), ?localPropertyName))  AS ?result)
    }
    """ ;
.
rdbs:mintEntityURI
  a sh:SPARQLFunction ;
  rdfs:comment "Mint an Entity Type URI from its $localName and $label" ;
  sh:parameter [
      sh:path rdbs:labelOp2 ;
      sh:datatype xsd:string ;
      sh:description "The table label" ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      sh:path rdbs:localNameOp1 ;
      sh:datatype xsd:string ;
      sh:description "The table local name" ;
      sh:optional true ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      sh:path rdbs:namespaceOp3 ;
      sh:datatype xsd:string ;
      sh:description "The namespace" ;
      sh:order 2 ;
    ] ;
  sh:returnType xsd:string ;
  sh:select """
    PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
    PREFIX sh:<http://www.w3.org/ns/shacl#>
    SELECT ?result
    WHERE {
      BIND(  IF(  BOUND($localNameOp1) ,
             IRI(CONCAT(STR($namespaceOp3),$localNameOp1)),
             IRI(CONCAT(STR($namespaceOp3),$labelOp2)))  AS ?result)
    }
    """ ;
.
rdbs:mintGraphCBEDescriptionTable
  a sh:SPARQLFunction ;
  rdfs:comment "Create the label of a new Description Table based on its class."@en ;
  rdfs:label "Mint Graph Description Table (CBE)"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterIRILocalName ;
      sh:datatype xsd:string ;
      sh:name "Parameter IRILocal name {@en}" ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterOutputTable ;
      sh:name "Parameter output table"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 1 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the prefix of the new table
	BIND (REPLACE($ParameterIRILocalName, \"-.*\", \"\") AS ?raw_base) .
	BIND (REPLACE (?raw_base, \"\\\\W+\", \"_\") AS ?base)
# Get the suffix of the new table
	VALUES (?class ?prefix ?suffix) {
		( rdbs:VerticeCBETable \"\" \"\")
		( rdbs:AnnotationCBETable \"Annotations-\" \"\")
		( rdbs:SourceCBETable \"\" \"-Sources\" )
	}
	FILTER (?class = $ParameterOutputTable)
# Bind the class prefix and name into an URI
	BIND (concat(?base, ?suffix ) AS ?result )
}""" ;
.
rdbs:mintGraphClass
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Graph Class."@en ;
  rdfs:label "Mint Graph Class"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterTable ;
      sh:class rdbs:GraphCBE ;
      sh:description "The CBE that corresponds to a Class in our Graph Ontology {@en}." ;
      sh:name "Parameter table {@en}" ;
      sh:node rdbs:GraphCBE ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get new class name (preference for semantic name, label otherwise)
	$ParameterTable rdfs:label ?label .
	OPTIONAL { $ParameterTable rdbs:hasSemanticName ?semantic_name } .
	BIND ( COALESCE (?semantic_name , ?label ) AS ?local_name_raw ) .
	BIND ( REPLACE (?local_name_raw, \"\\\\W+\", \"_\" ) AS ?local_name ) .
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix \"schema\"
		] .
# Bind the class prefix and name into an URI
	BIND( IRI ( concat( str(?prefix), ?local_name ) ) AS ?result )
}""" ;
.
rdbs:mintGraphProperty
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Graph Data Property."@en ;
  rdfs:label "Mint Graph Property"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterColumn ;
      sh:class rdbs:DataPropertyColumn ;
      sh:description "A Data Column which semantic name is used to create a new property."@en ;
      sh:name "Data Column"@en ;
      sh:node rdbs:DataPropertyColumn ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get new class name (preference for semantic name, label otherwise)
	$ParameterColumn rdfs:label ?label .
	OPTIONAL { $ParameterColumn rdbs:hasSemanticName ?semantic_name } .
	BIND ( COALESCE (?semantic_name , ?label ) AS ?local_name_raw ) .
	BIND ( REPLACE (?local_name_raw, \"\\\\W+\", \"_\" ) AS ?local_name ) .
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix \"schema\"
		] .
# check for \"has\"
	BIND ( SUBSTR( ?local_name, 1, 1 ) = LCASE(SUBSTR( ?local_name, 1, 1 )) AS ?bool ) .
	BIND ( IF ( ?bool , \"\", \"has\" ) AS ?has )
# Bind the class prefix and name into an URI
	BIND( IRI ( concat( str(?prefix), ?has, ?local_name ) ) AS ?result )
}""" ;
.
rdbs:mintGraphPropertyObject
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Graph Object Property."@en ;
  rdfs:label "Mint Graph Property Object"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterColumn ;
      sh:class rdbs:ObjectPropertyColumn ;
      sh:description "An Object Column which object semantic name is used to create a new property."@en ;
      sh:name "Object Column"@en ;
      sh:node rdbs:ObjectPropertyColumn ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get new class name (preference for semantic name, label otherwise)
	$ParameterColumn rdfs:label ?label .
	$ParameterColumn rdbs:hasObjectSemanticName ?semantic_name_raw .
	BIND ( REPLACE (?semantic_name_raw, \"\\\\W+\", \"_\" ) AS ?semantic_name ) .
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix \"schema\"
		] .
# Bind the class prefix and name into an URI
	BIND( IRI ( concat( str(?prefix), ?semantic_name ) ) AS ?result )
}""" ;
.
rdbs:mintGraphTemporaryDescriptionTable
  a sh:SPARQLFunction ;
  rdfs:comment "Create the label of a new Description Table based on its class."@en ;
  rdfs:label "Mint Graph Description Table (Temporary Table)"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterInputTable ;
      sh:class rdbs:GraphTable ;
      sh:description "The origin table."@en ;
      sh:name "Input Table"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterOutputTable ;
      sh:description "The Class of the output table."@en ;
      sh:name "Output Table"@en ;
      sh:nodeKind sh:IRI ;
      sh:order 1 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the prefix of the new table
	$ParameterInputTable rdfs:label ?origin .
	BIND (REPLACE(LCASE(?origin), \"-.*\", \"\") AS ?prefix)
# Get the suffix of the new table
	VALUES (?class ?suffix) {
		(rdbs:ObjectWithTypeTable \"-with-types\")
		(rdbs:AttributeWithTypeTable \"-with-types\")
		(rdbs:MembershipWithTypeTable \"-with-types\")
		(rdbs:AnnotationWithTypeTable \"-with-types\")
		(rdbs:VerticeWithTypeWithMembershipTable \"-with-types-with-memberships\")
		(rdbs:TypedAttributeValueWithTypeWithIdObjectTable \"-with-types-with-idObjects\")
		(rdbs:TypedVerticeValuePerAttributeTypeTable \"-by-nodes\")
   		(rdbs:TypedEdgeValuePerAttributeTypeTable \"-by-sources\")
	}
	FILTER (?class = $ParameterOutputTable)
# Bind the class prefix and name into an URI
	BIND (concat(?prefix, ?suffix ) AS ?result )
}""" ;
.
rdbs:mintKeyColumn
  a sh:SPARQLFunction ;
  rdfs:comment "Create the IRI of the Key column of a temporary Description Table."@en ;
  rdfs:label "Mint Copy of Column"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterTable ;
      sh:class rdbs:Table ;
      sh:description "The table that will receive the copy of the column."@en ;
      sh:name "Table Parameter"@en ;
      sh:nodeKind sh:IRI ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the prefix of the new table
	BIND (REPLACE ($ParameterTable, \"\\\\W+\", \"-\") AS ?table)
# Bind the class prefix and name into an URI
	BIND (rdbs:createIRIFromString( CONCAT (?table, \"_Key\"), \"base\" ) AS ?result )
}""" ;
.
rdbs:mintOBJPropertyURI
  a sh:SPARQLFunction ;
  rdfs:comment "Mint a URI for a Object Type property from its $localName and $label" ;
  sh:parameter [
      sh:path rdbs:domainLabelOp2 ;
      sh:datatype xsd:string ;
      sh:description "The domain table label" ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      sh:path rdbs:domainLocalNameOp1 ;
      sh:datatype xsd:string ;
      sh:description "The domain entity local name" ;
      sh:optional true ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      sh:path rdbs:namespaceOp6 ;
      sh:datatype xsd:string ;
      sh:description "The namespace" ;
      sh:optional true ;
      sh:order 5 ;
    ] ;
  sh:parameter [
      sh:path rdbs:propertyLocalNameOp5 ;
      sh:datatype xsd:string ;
      sh:description "The asserted property local name" ;
      sh:optional true ;
      sh:order 4 ;
    ] ;
  sh:parameter [
      sh:path rdbs:rangeLabelOp4 ;
      sh:datatype xsd:string ;
      sh:description "The range table label" ;
      sh:optional true ;
      sh:order 3 ;
    ] ;
  sh:parameter [
      sh:path rdbs:rangeLocalNameOp3 ;
      sh:datatype xsd:string ;
      sh:description "The range entity local name" ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:returnType xsd:string ;
  sh:select """
    PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
    PREFIX sh:<http://www.w3.org/ns/shacl#>
    SELECT ?result
    WHERE {
      BIND(  IF(  BOUND($domainLocalNameOp1) , $domainLocalNameOp1, $domainLabelOp2)  AS ?domainEntityClassName)
      BIND(  IF(  BOUND($rangeLocalNameOp3) , $rangeLocalNameOp3, $rangeLabelOp4)  AS ?targetEntityClassName)

      BIND(  IF(  BOUND($propertyLocalNameOp5) , $propertyLocalNameOp5,  CONCAT(\"has_\",  CONCAT(?targetEntityClassName,  CONCAT(\"_for_\",?domainEntityClassName))))  AS ?localPropertyName)
      BIND(  IRI(CONCAT( STR($namespaceOp6), ?localPropertyName))  AS ?result)
    }
    """ ;
.
rdbs:mintOBJSubPropertyURI
  a sh:SPARQLFunction ;
  rdfs:comment "Mint a URI for a Object Type sub-property from its $localName and $label" ;
  sh:parameter [
      sh:path rdbs:domainLabelOp2 ;
      sh:datatype xsd:string ;
      sh:description "The domain table label" ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      sh:path rdbs:domainLocalNameOp1 ;
      sh:datatype xsd:string ;
      sh:description "The domain entity local name" ;
      sh:optional true ;
      sh:order 0 ;
    ] ;
  sh:parameter [
      sh:path rdbs:modifierNameOp6 ;
      sh:datatype xsd:string ;
      sh:description "The sub-property local modifier" ;
      sh:optional true ;
      sh:order 5 ;
    ] ;
  sh:parameter [
      sh:path rdbs:namespaceOp7 ;
      sh:datatype xsd:string ;
      sh:description "The namespace" ;
      sh:optional true ;
      sh:order 6 ;
    ] ;
  sh:parameter [
      sh:path rdbs:propertyLocalNameOp5 ;
      sh:datatype xsd:string ;
      sh:description "The asserted property local name" ;
      sh:optional true ;
      sh:order 4 ;
    ] ;
  sh:parameter [
      sh:path rdbs:rangeLabelOp4 ;
      sh:datatype xsd:string ;
      sh:description "The range table label" ;
      sh:optional true ;
      sh:order 3 ;
    ] ;
  sh:parameter [
      sh:path rdbs:rangeLocalNameOp3 ;
      sh:datatype xsd:string ;
      sh:description "The range entity local name" ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:returnType xsd:string ;
  sh:select """
    PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
    PREFIX sh:<http://www.w3.org/ns/shacl#>
    SELECT ?result
    WHERE {
      BIND(  IF(  BOUND($domainLocalNameOp1) , $domainLocalNameOp1, $domainLabelOp2)  AS ?domainEntityClassName)
      BIND(  IF(  BOUND($rangeLocalNameOp3) , $rangeLocalNameOp3, $rangeLabelOp4)  AS ?targetEntityClassName)
      BIND(  IF(  BOUND($propertyLocalNameOp5) , $propertyLocalNameOp5,  CONCAT(\"has_\",  CONCAT(?targetEntityClassName,  CONCAT(\"_for_\",?domainEntityClassName))))  AS ?localPropertyName)
      BIND(  CONCAT( ?localPropertyName , CONCAT( \"_\" , ?modifierNameOp6)) AS ?localSubPropertyName)
      BIND(  IRI(CONCAT( STR($namespaceOp7), ?localSubPropertyName))  AS ?result)
    }
    """ ;
.
rdbs:mintSemanticName
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Graph Property."@en ;
  rdfs:label "Mint Semantic Name"@en ;
  sh:parameter [
      sh:path rdbs:ParameterIRI ;
      sh:datatype xsd:anyURI ;
      sh:description "Any instance with a label."@en ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Get the entity prefix
	?ontology a owl:Ontology ;
		sh:declare [
			sh:namespace ?prefix ;
			sh:prefix \"schema\"
		] .
# Bind the class prefix and name into an URI
	BIND( IRI ( concat( str(?prefix), $ParameterIRI ) ) AS ?result )
}""" ;
.
rdbs:mintTopologyAggregate
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Aggregate Topology Element."@en ;
  rdfs:label "Mint Topology Aggregate"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterAggregateAggregate ;
      sh:datatype xsd:string ;
      sh:description "The Aggregate's name. {@en}" ;
      sh:name "Aggregate Aggregate {@en}" ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterAggregateAlias ;
      sh:datatype xsd:string ;
      sh:description "The alias of the Aggregate {@en}" ;
      sh:name "Aggregate Alias {@en}" ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterAggregateAs ;
      sh:datatype xsd:string ;
      sh:description "The Alias of a vallue collected by the Aggregate. {@en}" ;
      sh:name "Aggregate As {@en}" ;
      sh:optional true ;
      sh:order 5 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterAggregateCollect ;
      sh:datatype xsd:string ;
      sh:description "A collected value of the Aggregate. {@en}" ;
      sh:name "Aggregate Collect {@en}" ;
      sh:optional true ;
      sh:order 4 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterAggregateGroupBy ;
      sh:datatype xsd:string ;
      sh:description "The value on which to group the aggregated rows" ;
      sh:name "Aggregate Group By"@en ;
      sh:optional true ;
      sh:order 3 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterAggregateTopology ;
      sh:datatype xsd:string ;
      sh:name "Parameter aggregate topology {@en}" ;
      sh:order 0 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
	BIND (IF($ParameterAggregateAlias = \"\", \"\", CONCAT (\"-as-\", $ParameterAggregateAlias) ) AS ?optional_alias )
# Build the full local name of the object depending on the numbers of parameters
	BIND (CONCAT ($ParameterAggregateTopology,\"-topology\") AS ?length_1)
	BIND (CONCAT (?length_1, \"-aggregate\",     $ParameterAggregateAggregate) AS ?length_2)
	BIND (CONCAT (?length_2, ?optional_alias)  AS ?length_3)
	BIND (CONCAT (?length_3, \"-group-by-\",     $ParameterAggregateGroupBy) AS ?length_4)
	BIND (CONCAT (?length_4, \"-collect-\",          $ParameterAggregateCollect) AS ?length_5)
	BIND (CONCAT (?length_5, \"-as-\",                 $ParameterAggregateAs) AS ?length_6) 
	BIND ( COALESCE (?length_6, ?length_5, ?length_4, ?length_3, ?length_2, ?length_1) AS ?local_name )
# Bind the class prefix and name into an URI
	BIND( rdbs:createIRIFromString(?local_name, \"base\") AS ?result )
}""" ;
.
rdbs:mintTopologyJoin
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Join Topology Element."@en ;
  rdfs:label "Mint Topology Join"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterJoinAs ;
      sh:datatype xsd:string ;
      sh:description "The alias of the value selected" ;
      sh:name "Join As {@en}" ;
      sh:optional true ;
      sh:order 3 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterJoinJoin ;
      sh:datatype xsd:string ;
      sh:description "The name of the Join. {@en}" ;
      sh:name "Join Join {@en}" ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterJoinSelect ;
      sh:datatype xsd:string ;
      sh:description "A value Selected in the Join. {@en}" ;
      sh:name "Join Select {@en}" ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterJoinTopology ;
      sh:datatype xsd:string ;
      sh:name "Parameter join topology {@en}" ;
      sh:order 0 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Build the full local name of the object depending on the numbers of parameters
	BIND (CONCAT ($ParameterJoinTopology,\"-topology\") AS ?length_1)
	BIND (CONCAT (?length_1, \"-join-with-\", $ParameterJoinJoin) AS ?length_2)
	BIND (CONCAT (?length_2, \"-select-\",      $ParameterJoinSelect) AS ?length_3)
	BIND (CONCAT (?length_3, \"-as-\",            $ParameterJoinAs) AS ?length_4) 
	BIND ( COALESCE (?length_4, ?length_3, ?length_2, ?length_1) AS ?local_name )
# Bind the class prefix and name into an URI
	BIND( rdbs:createIRIFromString(?local_name, \"base\") AS ?result )
}""" ;
.
rdbs:mintTopologyRelation
  a sh:SPARQLFunction ;
  rdfs:comment "Create an URI for a new Relation Topology Element."@en ;
  rdfs:label "Mint Topology Relation"@en ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterRelationAs ;
      sh:datatype xsd:string ;
      sh:name "Parameter relation as {@en}" ;
      sh:optional true ;
      sh:order 4 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterRelationCollect ;
      sh:datatype xsd:string ;
      sh:name "Parameter relation collect {@en}" ;
      sh:optional true ;
      sh:order 3 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterRelationGroupBy ;
      sh:datatype xsd:string ;
      sh:name "Parameter relation group by {@en}" ;
      sh:optional true ;
      sh:order 2 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterRelationRelation ;
      sh:datatype xsd:string ;
      sh:name "Parameter relation relation {@en}" ;
      sh:optional true ;
      sh:order 1 ;
    ] ;
  sh:parameter [
      a sh:Parameter ;
      sh:path rdbs:ParameterRelationTopology ;
      sh:datatype xsd:string ;
      sh:name "Parameter relation topology {@en}" ;
      sh:order 0 ;
    ] ;
  sh:returnType xsd:anyURI ;
  sh:select """PREFIX rdbs:<https://data.elsevier.com/lifescience/schema/rdbs/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX sh: <http://www.w3.org/ns/shacl#>

SELECT ?result
WHERE {
# Build the full local name of the object depending on the numbers of parameters
	BIND (CONCAT ($ParameterRelationTopology,\"-topology\") AS ?length_1)
	BIND (CONCAT (?length_1, \"-relate-with-\", $ParameterRelationRelation) AS ?length_2)
	BIND (CONCAT (?length_2, \"-group-by-\",      $ParameterRelationGroupBy) AS ?length_3)
	BIND (CONCAT (?length_3, \"-collect-\",            $ParameterRelationCollect) AS ?length_4)
	BIND (CONCAT (?length_4, \"-as-\",            $ParameterRelationAs) AS ?length_5) 
	BIND ( COALESCE (?length_5, ?length_4, ?length_3, ?length_2, ?length_1) AS ?local_name )
# Bind the class prefix and name into an URI
	BIND( rdbs:createIRIFromString(?local_name, \"base\") AS ?result )
}""" ;
.
rdbs:modifierNameOp6
  a owl:Property ;
.
rdbs:namespaceOp3
  a owl:Property ;
.
rdbs:namespaceOp5
  a owl:Property ;
.
rdbs:namespaceOp6
  a owl:Property ;
.
rdbs:namespaceOp7
  a owl:Property ;
.
rdbs:paramCamelize
  a owl:DatatypeProperty ;
  rdfs:label "paramCamelize"@en ;
.
rdbs:positionInCompositeKey
  a owl:DatatypeProperty ;
  rdfs:comment "If a primary key is a composite one, this refers to the order of the column within the primary key."@en ;
  rdfs:domain rdbs:PrimaryKeyColumn ;
  rdfs:label "position in composite key"@en ;
  rdfs:range xsd:integer ;
.
rdbs:propertyLocalNameOp3
  a owl:Property ;
.
rdbs:propertyLocalNameOp5
  a owl:Property ;
.
rdbs:rangeLabelOp4
  a owl:Property ;
.
rdbs:rangeLocalNameOp3
  a owl:Property ;
.
rdbs:refersToColumn
  a owl:ObjectProperty ;
  rdfs:domain rdbs:PrimaryKeyColumn ;
  rdfs:label "refers to column"@en ;
  rdfs:range rdbs:Column ;
.
rdbs:refersToPrimaryKey
  a owl:ObjectProperty ;
  rdfs:domain rdbs:ForeignKeyColumn ;
  rdfs:label "Refers to primary key in a referenced table"@en ;
  rdfs:range rdbs:PrimaryKeyColumn ;
.
rdbs:toCamelCase
  a sh:JSFunction ;
  rdfs:label "toCamelCase"@en ;
  sh:jsFunctionName "toCamelCase" ;
  sh:jsLibrary rdbs:DCGJSLibrary ;
  sh:parameter [
      sh:path rdbs:paramCamelize ;
      sh:datatype xsd:string ;
      sh:name "paramCamelize"@en ;
      sh:order 0 ;
    ] ;
  sh:returnType xsd:string ;
.
rdbs:toPascalCase
  a sh:JSFunction ;
  rdfs:label "toPascalCase"@en ;
  sh:jsFunctionName "toPascalCase" ;
  sh:jsLibrary rdbs:DCGJSLibrary ;
  sh:parameter [
      sh:path rdbs:paramCamelize ;
      sh:datatype xsd:string ;
      sh:name "paramCamelize"@en ;
      sh:order 0 ;
    ] ;
  sh:returnType xsd:string ;
.
rdbs:viaForeignKeyColumn
  a owl:ObjectProperty ;
  rdfs:comment "When specifying a number of foreign columns to add to a target table, the foreign key column reference is used to specify the identity when this is ambiguous (e.g. more than one foreign key pointing to the table containing the foreign columns)."@en ;
  rdfs:domain rdbs:ForeignColumn ;
  rdfs:label "via foreign key column"@en ;
  rdfs:range rdbs:ForeignKeyColumn ;
.
